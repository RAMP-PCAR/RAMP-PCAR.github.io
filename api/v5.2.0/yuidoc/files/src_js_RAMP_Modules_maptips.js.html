<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\js\RAMP\Modules\maptips.js - ramp-pcar</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="..\..\..\assets\images\bobcat_logo_sharp_smaller_s.png" title="ramp-pcar">Reusable Accessible Mapping Platform</h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 5.2.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AdvancedToolbar.html">AdvancedToolbar</a></li>
                                <li><a href="../classes/AreaTool.html">AreaTool</a></li>
                                <li><a href="../classes/Array.html">Array</a></li>
                                <li><a href="../classes/BaseMapSelector.html">BaseMapSelector</a></li>
                                <li><a href="../classes/BaseTool.html">BaseTool</a></li>
                                <li><a href="../classes/BookmarkLink.html">BookmarkLink</a></li>
                                <li><a href="../classes/Bootstrapper.html">Bootstrapper</a></li>
                                <li><a href="../classes/Brick.html">Brick</a></li>
                                <li><a href="../classes/Bricks.html">Bricks</a></li>
                                <li><a href="../classes/BufferTool.html">BufferTool</a></li>
                                <li><a href="../classes/ButtonBrick.html">ButtonBrick</a></li>
                                <li><a href="../classes/Checkbox.html">Checkbox</a></li>
                                <li><a href="../classes/CheckboxGroup.html">CheckboxGroup</a></li>
                                <li><a href="../classes/ChoiceBrick.html">ChoiceBrick</a></li>
                                <li><a href="../classes/ColorPickerBrick.html">ColorPickerBrick</a></li>
                                <li><a href="../classes/Datagrid.html">Datagrid</a></li>
                                <li><a href="../classes/DatagridClickHandler.html">DatagridClickHandler</a></li>
                                <li><a href="../classes/DataLoader.html">DataLoader</a></li>
                                <li><a href="../classes/DataLoaderGui.html">DataLoaderGui</a></li>
                                <li><a href="../classes/Decorator.html">Decorator</a></li>
                                <li><a href="../classes/Dictionary.html">Dictionary</a></li>
                                <li><a href="../classes/DistanceTool.html">DistanceTool</a></li>
                                <li><a href="../classes/DropDownBrick.html">DropDownBrick</a></li>
                                <li><a href="../classes/EventManager.html">EventManager</a></li>
                                <li><a href="../classes/FeatureClickHandler.html">FeatureClickHandler</a></li>
                                <li><a href="../classes/FeatureHighlighter.html">FeatureHighlighter</a></li>
                                <li><a href="../classes/FileInputBrick.html">FileInputBrick</a></li>
                                <li><a href="../classes/FilterManager.html">FilterManager</a></li>
                                <li><a href="../classes/FunctionMangler.html">FunctionMangler</a></li>
                                <li><a href="../classes/GlobalStorage.html">GlobalStorage</a></li>
                                <li><a href="../classes/GraphicExtension.html">GraphicExtension</a></li>
                                <li><a href="../classes/GUI.html">GUI</a></li>
                                <li><a href="../classes/ImageExport.html">ImageExport</a></li>
                                <li><a href="../classes/LayerGroup.html">LayerGroup</a></li>
                                <li><a href="../classes/LayerItem.html">LayerItem</a></li>
                                <li><a href="../classes/LayerLoader.html">LayerLoader</a></li>
                                <li><a href="../classes/LayoutController.html">LayoutController</a></li>
                                <li><a href="../classes/Map.html">Map</a></li>
                                <li><a href="../classes/MapClickHandler.html">MapClickHandler</a></li>
                                <li><a href="../classes/Maptips.html">Maptips</a></li>
                                <li><a href="../classes/MultiBrick.html">MultiBrick</a></li>
                                <li><a href="../classes/Navigation.html">Navigation</a></li>
                                <li><a href="../classes/OkCancelButtonBrick.html">OkCancelButtonBrick</a></li>
                                <li><a href="../classes/PopulationTool.html">PopulationTool</a></li>
                                <li><a href="../classes/Popup.html">Popup</a></li>
                                <li><a href="../classes/PopupBase.html">PopupBase</a></li>
                                <li><a href="../classes/PopupBaseSettings.html">PopupBaseSettings</a></li>
                                <li><a href="../classes/PopupManager.html">PopupManager</a></li>
                                <li><a href="../classes/Prototype.html">Prototype</a></li>
                                <li><a href="../classes/QuickZoom.html">QuickZoom</a></li>
                                <li><a href="../classes/RAMP.html">RAMP</a></li>
                                <li><a href="../classes/RampMap.html">RampMap</a></li>
                                <li><a href="../classes/RAMPStarter.html">RAMPStarter</a></li>
                                <li><a href="../classes/SimpleInputBrick.html">SimpleInputBrick</a></li>
                                <li><a href="../classes/StepItem.html">StepItem</a></li>
                                <li><a href="../classes/SubPanel.html">SubPanel</a></li>
                                <li><a href="../classes/SubPanelSettings.html">SubPanelSettings</a></li>
                                <li><a href="../classes/Theme.html">Theme</a></li>
                                <li><a href="../classes/TmplHelper.html">TmplHelper</a></li>
                                <li><a href="../classes/TmplUtil.html">TmplUtil</a></li>
                                <li><a href="../classes/Url.html">Url</a></li>
                                <li><a href="../classes/Util.html">Util</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/BookmarkLink.html">BookmarkLink</a></li>
                                <li><a href="../modules/Bricks.html">Bricks</a></li>
                                <li><a href="../modules/Datagrid.html">Datagrid</a></li>
                                <li><a href="../modules/DataLoader.html">DataLoader</a></li>
                                <li><a href="../modules/FilterManager.html">FilterManager</a></li>
                                <li><a href="../modules/GlobalStorage.html">GlobalStorage</a></li>
                                <li><a href="../modules/Map.html">Map</a></li>
                                <li><a href="../modules/Maptips.html">Maptips</a></li>
                                <li><a href="../modules/Navigation.html">Navigation</a></li>
                                <li><a href="../modules/QuickZoom.html">QuickZoom</a></li>
                                <li><a href="../modules/RAMP.html">RAMP</a></li>
                                <li><a href="../modules/Theme.html">Theme</a></li>
                                <li><a href="../modules/Tools.html">Tools</a></li>
                                <li><a href="../modules/UI.html">UI</a></li>
                                <li><a href="../modules/Utils.html">Utils</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src\js\RAMP\Modules\maptips.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
﻿/*global define, $, window, Modernizr, tmpl */
/*jslint white: true */

/**
*
*
* @module Map
* @submodule Maptips
*/

/**
* Maptips class.
*
* The map tip module provides functions to create a small popup window as the mouse hovers over a feature on the map (point, polygon, line, etc.).
* NOTE: This module uses global config object. featureLayers-&gt;mapTipSettings
*
* ####Imports RAMP Modules:
* {{#crossLink &quot;RAMP&quot;}}{{/crossLink}}  
* {{#crossLink &quot;EventManager&quot;}}{{/crossLink}}  
* {{#crossLink &quot;TmplHelper&quot;}}{{/crossLink}}  
* 
* ####Uses RAMP Templates:
* {{#crossLink &quot;templates/feature_hovertip_template.json&quot;}}{{/crossLink}}
* {{#crossLink &quot;templates/feature_anchortip_template.json&quot;}}{{/crossLink}}
* 
* @class Maptips
* @static
* @uses dojo/topic

* @uses templates/feature_hovertip_template.json
* @uses templates/feature_anchortip_template.json
*/

define([
/* Dojo */
        &quot;dojo/topic&quot;,

/* Ramp */
        &quot;ramp/ramp&quot;, &quot;ramp/eventManager&quot;,

/*tmplHelper */
        &quot;utils/tmplHelper&quot;,

/* json hover template file */
        &quot;dojo/text!./templates/feature_hovertip_template.json&quot;,
/* json archor template file*/
        &quot;dojo/text!./templates/feature_anchortip_template.json&quot;
],

    function (
    /* Dojo */
        topic,
    /* Ramp */
        Ramp, EventManager,

    /*tmplHelper */
        TmplHelper, hovertips_template, anchortips_template
    ) {
        &quot;use strict&quot;;

        var hovertips_template_json = JSON.parse(TmplHelper.stringifyTemplate(hovertips_template)),
            anchortips_template_json = JSON.parse(TmplHelper.stringifyTemplate(anchortips_template)),
            maptipPrototype = {
                node: null,
                handle: null,
                graphic: null
            },

            speed = 150,
            tolerance = 0,

            highTooltip = Object.create(maptipPrototype),

            subPanelOffset;

        /**
        * Returns the position of the sub-panel relative to the leftmost edge of the screen.
        *
        * @method getSubPanelLeftOffset
        * @private
        * @return {Number} position of the sub-panel relative to the leftmost edge of the screen
        */
        function getSubPanelLeftOffset() {
            return $(window).width() - subPanelOffset;
        }

        /**
        * Returns the position of the maptip relative to the leftmost edge of the screen.
        *
        * @method getToolTipOffset
        * @private
        * @return {Number} the position of the maptip relative to the leftmost edge of the screen
        */
        function getToolTipOffset() {
            var offset = 0;

            if (highTooltip.handle !== null &amp;&amp; highTooltip.node !== null) {
                offset = parseInt(highTooltip.node.css(&quot;left&quot;), 10) + highTooltip.node.width() / 2 - 20;
            }

            return offset;
        }

        /**
        * Checks if the maptip is hidden by the sub-panel and publishes a center-at event to pan the map, moving maptip into view.
        *
        * @method checkMaptipPosition
        * @private
        * @param  {jObject} target a node to which the tooltip will be attached
        * @param  {Object} graphic [description]
        */
        function checkMaptipPosition(target, graphic) {
            graphic = graphic || highTooltip.graphic || null;
            target = target || highTooltip.handle || null;

            if (target &amp;&amp; graphic &amp;&amp;
                target.offset().left &gt; getSubPanelLeftOffset()) {
                //console.log(&quot;offsets&quot;, target.offset().left, getSubPanelLeftOffset());
                topic.publish(EventManager.Map.CENTER_AT, {
                    point: graphic._extent.getCenter()
                });

                topic.publish(EventManager.Maptips.EXTENT_CHANGE, {
                    scroll: false
                });
            } else {
                topic.publish(EventManager.Maptips.EXTENT_CHANGE, {
                    scroll: true
                });
            }
        }

        /**
        * Generates content for a maptip.
        *
        * @method getMaptipContent
        * @private
        * @param  {Object} graphic map graphic the tip is describing
        * @param  {String} interactive indicates whether the maptip should have a close button
        */
        function getMaptipContent(graphic, interactive) {
            //the graphic might be in a highlight layer, if so we need the source layer id
            var layerId = graphic.getLayer().sourceLayerId;
            if (!layerId) {
                //graphic was not in a highlight layer
                layerId = graphic.getLayer().id;
            }

            var layerConfig = Ramp.getLayerConfigWithId(layerId),
               templateKey = &quot;&quot;,
               datawrapper,
               maptipContent;

            tmpl.cache = {};

            if (interactive === true) {
                templateKey = layerConfig.templates.anchor;
                tmpl.templates = anchortips_template_json;
            } else {
                templateKey = layerConfig.templates.hover;
                tmpl.templates = hovertips_template_json;
            }

            datawrapper = TmplHelper.dataBuilder(graphic, layerConfig);
            maptipContent = tmpl(templateKey, datawrapper);

            return maptipContent;
        }

        /**
        * Creates a maptip on the map.
        *
        * @method showMapTip
        * @private
        * @param  {jObject} target      a node the user hovered over
        * @param  {Object} graphic     the graphic belonging to the target
        * @param  {Boolean} interactive indicates whether the maptip should have a close button
        */
        function showMapTip(target, graphic, interactive) {
            var maptipContent = getMaptipContent(graphic, interactive);

            if (maptipContent == null) {
                return;
            }
            target.tooltipster({
                offsetX: $(target)[0].getBBox().width / 2,
                content: $(maptipContent),
                interactive: true,
                arrow: true,
                updateAnimation: Modernizr.csstransitions, // known bug in tooltipster when browsers not supporting CSS animation don&#x27;t display tooltips at all
                autoClose: interactive !== true,
                onlyOne: true,
                interactiveTolerance: tolerance,
                speed: speed,
                theme: (interactive === true) ? &#x27;.tooltipster-noir&#x27; : &#x27;.tooltipster-shadow&#x27;
            });

            if (!interactive) {
                target
                    .tooltipster(&quot;offsetX&quot;, $(target)[0].getBBox().width / 2) // ?
                    .mouseover();
            } else {
                // add a close button
                target
                        .tooltipster(&quot;show&quot;)
                        .tooltipster(&quot;content&quot;, $(maptipContent).append(&#x27;&lt;button class=&quot;button-none button-close&quot;&gt;&lt;span class=&quot;wb-invisible&quot;&gt;Close&lt;/span&gt;&lt;/button&gt;&#x27;));

                // set a listener to that close button
                $(target.tooltipster(&quot;elementTooltip&quot;))
                        .find(&quot;.button-close&quot;)
                        .on(&quot;click&quot;, function () {
                            topic.publish(EventManager.GUI.SUBPANEL_CLOSE, { origin: &quot;all&quot; });
                        });

                // keep pointers to the tooltip parts
                highTooltip.node = $(target.tooltipster(&quot;elementTooltip&quot;));
                highTooltip.handle = target.tooltipster();
                highTooltip.graphic = graphic;
            }
        }

        /**
        * Initialize event listeners for the maptip events
        *
        * @method initListeners
        * @private
        *
        */
        function initListeners() {
            topic.subscribe(EventManager.Maptips.SHOW, function (event) {
                //console.log(EventManager.Maptips.SHOW);
                showMapTip($(event.target), event.graphic);
            });

            topic.subscribe(EventManager.Maptips.SHOW_INTERACTIVE, function (obj) {
                //console.log(EventManager.Maptips.SHOW_INTERACTIVE);
                checkMaptipPosition(obj.target, obj.graphic);
                showMapTip(obj.target, obj.graphic, true);
            });

            topic.subscribe(EventManager.Maptips.REPOSITION_INTERACTIVE, function (obj) {
                //console.log(EventManager.Maptips.REPOSITION_INTERACTIVE);

                if (highTooltip.handle !== null &amp;&amp; highTooltip.node !== null) {
                    var localOffset = obj.offset || 0;

                    highTooltip.handle
                            .tooltipster(&quot;offsetX&quot;, localOffset)
                            .tooltipster(&quot;reposition&quot;);

                    // check if the tooltip is &quot;hidden&quot; under the sub-panel; if so, hide it for real;
                    window.setTimeout(function () {
                        if (getToolTipOffset() &gt; getSubPanelLeftOffset()) {
                            highTooltip.node.hide();
                        } else {
                            highTooltip.node.show();
                        }
                    }, speed + 10);
                }
            });

            topic.subscribe(EventManager.GUI.SUBPANEL_CHANGE, function (obj) {
                //console.log(&quot;subPanelChange&quot;, obj);
                if (obj.isComplete) {
                    if (obj.visible) {
                        subPanelOffset = obj.offsetLeft;
                        checkMaptipPosition();
                    } else {
                        subPanelOffset = 0;
                    }
                }
            });
        }

        return {
            /**
            * Calls the event handling initialization function
            * @method init
            * @constructor
            *
            */
            init: function () {
                initListeners();
            }
        };
    });
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
