<!DOCTYPE html>

<html>
<head>
  <title>graphicExtension.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="advancedToolbar.html">
                advancedToolbar.js
              </a>
            
              
              <a class="source" href="attributeLoader.html">
                attributeLoader.js
              </a>
            
              
              <a class="source" href="basemapSelector.html">
                basemapSelector.js
              </a>
            
              
              <a class="source" href="bookmarkLink.html">
                bookmarkLink.js
              </a>
            
              
              <a class="source" href="dataLoader.html">
                dataLoader.js
              </a>
            
              
              <a class="source" href="dataLoaderGui.html">
                dataLoaderGui.js
              </a>
            
              
              <a class="source" href="datagrid.html">
                datagrid.js
              </a>
            
              
              <a class="source" href="datagridClickHandler.html">
                datagridClickHandler.js
              </a>
            
              
              <a class="source" href="eventManager.html">
                eventManager.js
              </a>
            
              
              <a class="source" href="featureClickHandler.html">
                featureClickHandler.js
              </a>
            
              
              <a class="source" href="featureHighlighter.html">
                featureHighlighter.js
              </a>
            
              
              <a class="source" href="filterManager.html">
                filterManager.js
              </a>
            
              
              <a class="source" href="geoSearch.html">
                geoSearch.js
              </a>
            
              
              <a class="source" href="globalStorage.html">
                globalStorage.js
              </a>
            
              
              <a class="source" href="graphicExtension.html">
                graphicExtension.js
              </a>
            
              
              <a class="source" href="gui.html">
                gui.js
              </a>
            
              
              <a class="source" href="imageExport.html">
                imageExport.js
              </a>
            
              
              <a class="source" href="layerGroup.html">
                layerGroup.js
              </a>
            
              
              <a class="source" href="layerItem.html">
                layerItem.js
              </a>
            
              
              <a class="source" href="layerLoader.html">
                layerLoader.js
              </a>
            
              
              <a class="source" href="map.html">
                map.js
              </a>
            
              
              <a class="source" href="mapClickHandler.html">
                mapClickHandler.js
              </a>
            
              
              <a class="source" href="maptips.html">
                maptips.js
              </a>
            
              
              <a class="source" href="metadataHandler.html">
                metadataHandler.js
              </a>
            
              
              <a class="source" href="navigation.html">
                navigation.js
              </a>
            
              
              <a class="source" href="quickzoom.html">
                quickzoom.js
              </a>
            
              
              <a class="source" href="stepItem.html">
                stepItem.js
              </a>
            
              
              <a class="source" href="theme.html">
                theme.js
              </a>
            
              
              <a class="source" href="RAMP-starter.html">
                RAMP-starter.js
              </a>
            
              
              <a class="source" href="areaTool.html">
                areaTool.js
              </a>
            
              
              <a class="source" href="baseTool.html">
                baseTool.js
              </a>
            
              
              <a class="source" href="bufferTool.html">
                bufferTool.js
              </a>
            
              
              <a class="source" href="distanceTool.html">
                distanceTool.js
              </a>
            
              
              <a class="source" href="populationTool.html">
                populationTool.js
              </a>
            
              
              <a class="source" href="array.html">
                array.js
              </a>
            
              
              <a class="source" href="bricks.html">
                bricks.js
              </a>
            
              
              <a class="source" href="checkbox.html">
                checkbox.js
              </a>
            
              
              <a class="source" href="checkboxGroup.html">
                checkboxGroup.js
              </a>
            
              
              <a class="source" href="decorator.html">
                decorator.js
              </a>
            
              
              <a class="source" href="dictionary.html">
                dictionary.js
              </a>
            
              
              <a class="source" href="functionMangler.html">
                functionMangler.js
              </a>
            
              
              <a class="source" href="popupManager.html">
                popupManager.js
              </a>
            
              
              <a class="source" href="prototype.html">
                prototype.js
              </a>
            
              
              <a class="source" href="tmplHelper.html">
                tmplHelper.js
              </a>
            
              
              <a class="source" href="tmplUtil.html">
                tmplUtil.js
              </a>
            
              
              <a class="source" href="url.html">
                url.js
              </a>
            
              
              <a class="source" href="util.html">
                util.js
              </a>
            
              
              <a class="source" href="bootstrapper.html">
                bootstrapper.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>graphicExtension.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>﻿<span class="hljs-comment">/*global define, tmpl, RAMP */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>the “use strict” forces the ECMA Script 5 interpretation of the code</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-comment">/**
*
*
* @module RAMP
* @submodule Map
*/</span>

<span class="hljs-comment">/**
* GraphicExtension class containing helper functions for graphic objects, data attribute objects, and the bridging between the two
*
* ####Imports RAMP Modules:
* {{#crossLink "Dictionary"}}{{/crossLink}}
* {{#crossLink "TmplHelper"}}{{/crossLink}}
* {{#crossLink "Util"}}{{/crossLink}}
* {{#crossLink "Array"}}{{/crossLink}}
*
* ####Uses RAMP Templates:
* {{#crossLink "templates/point_details_list_Template.json"}}{{/crossLink}}
* {{#crossLink "templates/point_details_list_item_Template.json"}}{{/crossLink}}

* @class GraphicExtension
* @static
*/</span>

define([</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Utils</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-string">'utils/array'</span>, <span class="hljs-string">'utils/dictionary'</span>, <span class="hljs-string">'utils/util'</span>, <span class="hljs-string">'utils/tmplHelper'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>details template</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-string">'dojo/text!./templates/feature_details_template.json'</span>],

    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">
</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Utils</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    UtilArray, UtilDict, UtilMisc, TmplHelper,</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>json details template</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    feature_details_template) {
        <span class="hljs-string">'use strict'</span>;

        <span class="hljs-keyword">return</span> {
            <span class="hljs-comment">/**
            * Returns the object id of the given graphic object
            *
            * @param {esri/Graphic} graphic
            * @method getGraphicOid
            * @return {Integer} object id for the graphic
            */</span>
            getGraphicOid: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">graphic</span>) </span>{
                <span class="hljs-keyword">var</span> objectIdField = graphic.getLayer().objectIdField;
                <span class="hljs-keyword">return</span> graphic.attributes[objectIdField];
            },

            <span class="hljs-comment">/**
            * Returns the object id of the given feature data object
            *
            * @param {Object} fData a feature data object
            * @method getFDataOid
            * @return {Integer} object id for data attribute
            */</span>
            getFDataOid: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fData</span>) </span>{
                <span class="hljs-keyword">return</span> fData.attributes[fData.parent.idField];
            },

            <span class="hljs-comment">/**
            * Returns the feature data object of the given graphic object
            *
            * @param {esri/Graphic} graphic
            * @method getFDataForGraphic
            * @return {Object} feature data object of the given graphic object. undefined if feature data object doesn't exist
            */</span>
            getFDataForGraphic: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">graphic</span>) </span>{
                <span class="hljs-keyword">var</span> idx, ret,
                    data = RAMP.data[graphic.getLayer().id];  <span class="hljs-comment">//the data parent for the layer the graphic belongs to</span>

                <span class="hljs-keyword">if</span> (data) {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>use graphic object id as key in index to get position of data object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    idx = data.index[<span class="hljs-keyword">this</span>.getGraphicOid(graphic).toString()];
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> idx !== <span class="hljs-literal">undefined</span>) {
                        ret = data.features[idx];
                    }
                }
                <span class="hljs-keyword">return</span> ret;
            },

            <span class="hljs-comment">/**
            * Returns the layer config node for a feature data object
            *
            * @param {Object} fData a feature data object
            * @method getConfigForFData
            * @return {Object} layer config node
            */</span>
            getConfigForFData: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fData</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>DOJO circular reference nonsense not letting us use the Ramp module.  will duplicate the function locally :’(
return Ramp.getLayerConfigWithId(fData.parent.layerId);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                <span class="hljs-keyword">return</span> UtilArray.find(RAMP.config.layers.wms.concat(RAMP.config.layers.feature),
                    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">layerConfig</span>) </span>{
                        <span class="hljs-keyword">return</span> layerConfig.id === fData.parent.layerId;
                    });
            },

            <span class="hljs-comment">/**
            * Get details popup content for a graphic (i.e. a point)
            *
            * @method getGraphicTextContent
            * @private
            * @param {esri/Graphic} graphic
            * @return {Object} popup content for graphic
            */</span>
            getGraphicTextContent: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">graphic</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>TODO investigate ways to merge this logic with getFDataTextContent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> templateName = graphic.getLayer().ramp.config.templates.detail;

                tmpl.cache = {};
                tmpl.templates = <span class="hljs-built_in">JSON</span>.parse(TmplHelper.stringifyTemplate(feature_details_template));</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>grab the attribute data bound to this graphic</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> fData = <span class="hljs-keyword">this</span>.getFDataForGraphic(graphic);
                <span class="hljs-keyword">if</span> (fData) {
                    <span class="hljs-keyword">var</span> datawrapper = TmplHelper.dataBuilder(fData, graphic.getLayer().ramp.config);
                    <span class="hljs-keyword">return</span> tmpl(templateName, datawrapper);
                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>rare case where graphic has no current feature data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
                }
            },

            <span class="hljs-comment">/**
            * Get popup content for a feature data object
            *
            * @method getFDataTextContent
            * @private
            * @param {Object} fData a feature data object
            * @return {Object} popup content for feature data object
            */</span>
            getFDataTextContent: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fData</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>TODO investigate ways to merge this logic with getGraphicTextContent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> lConfig = <span class="hljs-keyword">this</span>.getConfigForFData(fData),
                    templateName = lConfig.templates.detail;

                tmpl.cache = {};
                tmpl.templates = <span class="hljs-built_in">JSON</span>.parse(TmplHelper.stringifyTemplate(feature_details_template));</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>grab the attribute data bound to this graphic</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> datawrapper = TmplHelper.dataBuilder(fData, lConfig);

                <span class="hljs-keyword">return</span> tmpl(templateName, datawrapper);
            },

            <span class="hljs-comment">/**
            * Returns the content of the name field of the provided graphic object
            *
            * @method getGraphicTitle
            * @param {esri/Graphic} graphic a graphic object or a feature object
            * @return {}
            */</span>
            getGraphicTitle: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">graphic</span>) </span>{
                <span class="hljs-keyword">var</span> fData = <span class="hljs-keyword">this</span>.getFDataForGraphic(graphic);
                <span class="hljs-keyword">if</span> (fData) {
                    <span class="hljs-keyword">return</span> fData.attributes[graphic.getLayer().ramp.config.nameField];
                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>rare case where graphic has no current feature data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
                }
            },

            <span class="hljs-comment">/**
            * Returns the content of the name field of the provided feature data object
            *
            * @method getFDataTitle
            * @param {Object} fData a feature data object
            * @return {}
            */</span>
            getFDataTitle: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fData</span>) </span>{
                <span class="hljs-keyword">return</span> fData.attributes[<span class="hljs-keyword">this</span>.getConfigForFData(fData).nameField];
            },

            <span class="hljs-comment">/**
            * Will find a graphic in a feature layer
            *
            * @method findGraphic
            * @param {Integer} objectId an object id to find
            * @param {String} layerId a feature layer id containing the graphic
            * @return {esri/Graphic} graphic in the layer with the object id
            */</span>
            findGraphic: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">objectId, layerId</span>) </span>{
                <span class="hljs-keyword">var</span> layer = RAMP.layerRegistry[layerId];</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>with ondemand layers, graphics arrays are no longer guaranteed to be sorted by objectid.  we can no longer use binaryFind.
we only use this to find graphics when clicking the details / zoom button, so speed loss isn’t felt often</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">return</span> UtilArray.find(layer.graphics, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a_graphic</span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getGraphicOid(a_graphic) === objectId;
                }, <span class="hljs-keyword">this</span>);
            }
        };
    });</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
