<!DOCTYPE html>

<html>
<head>
  <title>bootstrapper.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="basemapSelector.html">
                basemapSelector.js
              </a>
            
              
              <a class="source" href="bookmarkLink.html">
                bookmarkLink.js
              </a>
            
              
              <a class="source" href="datagrid.html">
                datagrid.js
              </a>
            
              
              <a class="source" href="datagridClickHandler.html">
                datagridClickHandler.js
              </a>
            
              
              <a class="source" href="eventManager.html">
                eventManager.js
              </a>
            
              
              <a class="source" href="featureClickHandler.html">
                featureClickHandler.js
              </a>
            
              
              <a class="source" href="featureHighlighter.html">
                featureHighlighter.js
              </a>
            
              
              <a class="source" href="filterManager.html">
                filterManager.js
              </a>
            
              
              <a class="source" href="globalStorage.html">
                globalStorage.js
              </a>
            
              
              <a class="source" href="graphicExtension.html">
                graphicExtension.js
              </a>
            
              
              <a class="source" href="gui.html">
                gui.js
              </a>
            
              
              <a class="source" href="map.html">
                map.js
              </a>
            
              
              <a class="source" href="maptips.html">
                maptips.js
              </a>
            
              
              <a class="source" href="navigation.html">
                navigation.js
              </a>
            
              
              <a class="source" href="quickzoom.html">
                quickzoom.js
              </a>
            
              
              <a class="source" href="ramp.html">
                ramp.js
              </a>
            
              
              <a class="source" href="RAMP-starter.html">
                RAMP-starter.js
              </a>
            
              
              <a class="source" href="theme.html">
                theme.js
              </a>
            
              
              <a class="source" href="theme.html">
                theme.js
              </a>
            
              
              <a class="source" href="theme.html">
                theme.js
              </a>
            
              
              <a class="source" href="array.html">
                array.js
              </a>
            
              
              <a class="source" href="decorator.html">
                decorator.js
              </a>
            
              
              <a class="source" href="dictionary.html">
                dictionary.js
              </a>
            
              
              <a class="source" href="functionMangler.html">
                functionMangler.js
              </a>
            
              
              <a class="source" href="popupManager.html">
                popupManager.js
              </a>
            
              
              <a class="source" href="prototype.html">
                prototype.js
              </a>
            
              
              <a class="source" href="tmplHelper.html">
                tmplHelper.js
              </a>
            
              
              <a class="source" href="tmplUtil.html">
                tmplUtil.js
              </a>
            
              
              <a class="source" href="url.html">
                url.js
              </a>
            
              
              <a class="source" href="util.html">
                util.js
              </a>
            
              
              <a class="source" href="bootstrapper.html">
                bootstrapper.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>bootstrapper.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>﻿<span class="hljs-comment">/*global require, window, esri */</span>

<span class="hljs-comment">/**
* Ramp module
*
* @module RAMP
* @main RAMP
*/</span>

<span class="hljs-comment">/**
* Bootstrapper class.
* Starting point of RAMP, RAMP modules are loaded here and mapped to a function parameter
* Phase X?: For mobile support, there can be a different mobileBootstrapper with only the mobile modules loaded
*
* @class Bootstrapper
* @static
*
* @uses dojo/parser
* @uses dojo/on
* @uses dojo/topic
* @uses dojo/request/script
* @uses dojo/request/xhr
*
* @uses Map
* @uses Basemapselector
* @uses Maptips
* @uses Datagrid
* @uses Navigation
* @uses FilterManager
* @uses BookmarkLink
* @uses Url
* @uses FeatureHighlighter
* @uses Ramp
* @uses GlobalStorage
* @uses GUI
* @uses EventManager
*

* @uses Util
* @uses Prototype
* @uses FunctionMangler
*/</span>

<span class="hljs-built_in">require</span>([
<span class="hljs-comment">/* Dojo */</span>
    <span class="hljs-string">"dojo/parser"</span>, <span class="hljs-string">"dojo/on"</span>, <span class="hljs-string">"dojo/topic"</span>,
    <span class="hljs-string">"dojo/request/script"</span>,
    <span class="hljs-string">"dojo/request/xhr"</span>,

<span class="hljs-comment">/* RAMP */</span>
    <span class="hljs-string">"ramp/map"</span>, <span class="hljs-string">"ramp/basemapSelector"</span>, <span class="hljs-string">"ramp/maptips"</span>, <span class="hljs-string">"ramp/datagrid"</span>,
    <span class="hljs-string">"ramp/navigation"</span>, <span class="hljs-string">"ramp/filterManager"</span>, <span class="hljs-string">"ramp/bookmarkLink"</span>,
    <span class="hljs-string">"utils/url"</span>, <span class="hljs-string">"ramp/featureHighlighter"</span>,
    <span class="hljs-string">"ramp/ramp"</span>, <span class="hljs-string">"ramp/globalStorage"</span>, <span class="hljs-string">"ramp/gui"</span>, <span class="hljs-string">"ramp/eventManager"</span>,
    <span class="hljs-string">"themes/theme"</span>,

<span class="hljs-comment">/* Utils */</span>
    <span class="hljs-string">"utils/util"</span>,

<span class="hljs-comment">/* Plugins */</span>
    <span class="hljs-string">"utils/prototype!"</span>, <span class="hljs-string">"utils/functionMangler!"</span>],

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    <span class="hljs-comment">/* Dojo */</span>
    parser, dojoOn, topic, requestScript, xhr,

    <span class="hljs-comment">/* RAMP */</span>
    RampMap, BasemapSelector, Maptips, Datagrid, NavWidget, FilterManager,
    BookmarkLink, Url, FeatureHighlighter,
    ramp, globalStorage, gui, EventManager, theme,

    <span class="hljs-comment">/* Utils */</span>
    utilMisc)</span> {</span><span class="hljs-pi">
        "use strict"</span>;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initializeMap</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-comment">/* Start - RAMP Events, after map is loaded */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>dojoOn.once(RampMap.getMap(), “update-end”, function () {</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            topic.subscribe(EventManager.Map.ALL_LAYERS_LOADED, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                console.log(<span class="hljs-string">"map - &gt;&gt; first update-end; init the rest"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Only initialize the bookmark link after all the UI events of all other modules have
finished loading
IMPORTANT: for now, only basemapselector and filtermanager have a UI complete event
but in the future, if other modules start publishing their own UI complete events, it needs
to be subscribe to here so BookmarkLink will not attempt to call the module before its GUI
has finished rendering</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                utilMisc.subscribeAll([EventManager.BasemapSelector.UI_COMPLETE, EventManager.FilterManager.UI_COMPLETE], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    BookmarkLink.init(window.location.pathname.split(<span class="hljs-string">"/"</span>).last());
                });</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Added current level so slider will know how to adjust the position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> currentLevel = (RampMap.getMap().__LOD.level) ? RampMap.getMap().__LOD.level : <span class="hljs-number">0</span>;

                NavWidget.init(currentLevel);
                FeatureHighlighter.init();

                Maptips.init();</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Apply listeners for basemap gallery</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                BasemapSelector.init();</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>initialize the filter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                FilterManager.init();

                theme.tooltipster();
            });
            RampMap.init();

            Datagrid.init();</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>init only creates the grid, does not populate it with data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-comment">/* End - RAMP Events */</span>
        }
        <span class="hljs-comment">/* End - Bootstrapper functions */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Check to make sure the console exists, redefines it to the no-op function
if it does not (e.g. in IE when the debugger is not on)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        utilMisc.checkConsole();</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Once all of our modules are loaded and the DOM is ready:</p>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>call the parser to create the dijit layout dijits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        parser.parse();</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>turn off cors detection to stop cross domain error from happening.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        esri.config.defaults.io.corsDetection = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>To hold values from RAMP service</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">var</span>   <span class="hljs-comment">//siteURL = new Url(require.toUrl(document.location)),</span>
            lang = $(<span class="hljs-string">"html"</span>).attr(<span class="hljs-string">"lang"</span>), <span class="hljs-comment">// window.location.href.split("/").last().substring(5, 7); // siteURL.queryObject.lang || window.navigator.userLanguage || window.navigator.language || "en";</span>
            configFile,
            defJson;

        <span class="hljs-keyword">if</span> (lang !== <span class="hljs-string">"en"</span> &amp;&amp; lang !== <span class="hljs-string">"fr"</span>) {
            lang = <span class="hljs-string">"en"</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>loading config object from JSON file</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        configFile = (lang === <span class="hljs-string">"fr"</span>) ? <span class="hljs-string">"config.fr.json"</span> : <span class="hljs-string">"config.en.json"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Request the JSON config file</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        defJson = xhr(configFile, {
            handleAs: <span class="hljs-string">"json"</span>
        });

        defJson.then(
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fileContent)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>there is no need to convert the result to an object.  it comes through pre-parsed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                globalStorage.config = fileContent;

                gui.load(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> });

                initializeMap();
                ramp.loadStrings();
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(error)</span> {</span>
                console.log(<span class="hljs-string">"An error occurred when retrieving the JSON Config: "</span> + error);
            }
        );</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>loading config object from web service</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-comment">/*
        var serviceUrl = globalStorage.getConfigUrl() + "getConfig/" + $("html").attr("lang") + "/?keys=" + smallkeys;

</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Request the JSON config file
NOTE: XHR cannot be used here for cross domain purposes (primarily when running thru visual studio).
     we use request/script instead to get the config as jsonp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">var</span> defJson = requestScript.get(serviceUrl, { jsonp: <span class="hljs-string">"callback"</span> });

        defJson.then(
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fileContent)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>there is no need to convert the result to an object.  it comes through pre-parsed
Global config object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        gui.load(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> });</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>NOTE: ECDMP service has the json config file stored in an object property called “json” in string format.
     This is to avoid strongly typing the JSON config in the VB.Net Service.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        globalStorage.config = json.fromJson(fileContent.json);
        initializeMap();
        ramp.loadStrings();

        <span class="hljs-keyword">var</span> handle = window.setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        }, <span class="hljs-number">2000</span>);
        },
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(error)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>console.log(“An error occurred: “ + error);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        }
        );

        */
    });</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
