<!DOCTYPE html>

<html>
<head>
  <title>gui.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="basemapSelector.html">
                basemapSelector.js
              </a>
            
              
              <a class="source" href="bookmarkLink.html">
                bookmarkLink.js
              </a>
            
              
              <a class="source" href="datagrid.html">
                datagrid.js
              </a>
            
              
              <a class="source" href="datagridClickHandler.html">
                datagridClickHandler.js
              </a>
            
              
              <a class="source" href="eventManager.html">
                eventManager.js
              </a>
            
              
              <a class="source" href="featureClickHandler.html">
                featureClickHandler.js
              </a>
            
              
              <a class="source" href="featureHighlighter.html">
                featureHighlighter.js
              </a>
            
              
              <a class="source" href="filterManager.html">
                filterManager.js
              </a>
            
              
              <a class="source" href="globalStorage.html">
                globalStorage.js
              </a>
            
              
              <a class="source" href="graphicExtension.html">
                graphicExtension.js
              </a>
            
              
              <a class="source" href="gui.html">
                gui.js
              </a>
            
              
              <a class="source" href="map.html">
                map.js
              </a>
            
              
              <a class="source" href="maptips.html">
                maptips.js
              </a>
            
              
              <a class="source" href="navigation.html">
                navigation.js
              </a>
            
              
              <a class="source" href="quickzoom.html">
                quickzoom.js
              </a>
            
              
              <a class="source" href="ramp.html">
                ramp.js
              </a>
            
              
              <a class="source" href="RAMP-starter.html">
                RAMP-starter.js
              </a>
            
              
              <a class="source" href="theme.html">
                theme.js
              </a>
            
              
              <a class="source" href="theme.html">
                theme.js
              </a>
            
              
              <a class="source" href="theme.html">
                theme.js
              </a>
            
              
              <a class="source" href="array.html">
                array.js
              </a>
            
              
              <a class="source" href="decorator.html">
                decorator.js
              </a>
            
              
              <a class="source" href="dictionary.html">
                dictionary.js
              </a>
            
              
              <a class="source" href="functionMangler.html">
                functionMangler.js
              </a>
            
              
              <a class="source" href="popupManager.html">
                popupManager.js
              </a>
            
              
              <a class="source" href="prototype.html">
                prototype.js
              </a>
            
              
              <a class="source" href="tmplHelper.html">
                tmplHelper.js
              </a>
            
              
              <a class="source" href="tmplUtil.html">
                tmplUtil.js
              </a>
            
              
              <a class="source" href="url.html">
                url.js
              </a>
            
              
              <a class="source" href="util.html">
                util.js
              </a>
            
              
              <a class="source" href="bootstrapper.html">
                bootstrapper.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>gui.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>﻿<span class="hljs-comment">/*global define, $, window, TweenLite, TimelineLite, tmpl */</span>
<span class="hljs-comment">/*jslint white: true */</span>

<span class="hljs-comment">/**
* UI submodule
*
* @module RAMP
* @submodule UI
* @main UI
*/</span>

<span class="hljs-comment">/**
* A class for handling most of the GUI on the page.
*
* @class GUI
* @static
* @uses dojo/_base/array
* @uses dojo/topic
* @uses dojo/_base/lang
* @uses dojo/Deferred
* @uses dojo/domReady!
* @uses GlobalStorage
* @uses EventManager
* @uses Theme
* @uses templates/sub_panel_Template.html
* @uses templates/sub_panel_template.json
* @uses templates/sub_panel_content_Template.html
* @uses Util
* @uses Dictionary
* @uses PopupManager
* @uses TmplHelper
* @uses dojo/domReady!
*/</span>
define([</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Dojo</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"dojo/_base/array"</span>, <span class="hljs-string">"dojo/topic"</span>, <span class="hljs-string">"dojo/_base/lang"</span>, <span class="hljs-string">"dojo/Deferred"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Ramp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"ramp/globalStorage"</span>, <span class="hljs-string">"ramp/eventManager"</span>,

        <span class="hljs-string">"themes/theme"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"dojo/text!./templates/sub_panel_Template.html"</span>,
        <span class="hljs-string">"dojo/text!./templates/sub_panel_template.json"</span>,
        <span class="hljs-string">"dojo/text!./templates/sub_panel_content_Template.html"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Util</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"utils/util"</span>, <span class="hljs-string">"utils/dictionary"</span>, <span class="hljs-string">"utils/popupManager"</span>, <span class="hljs-string">"utils/tmplHelper"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Dom Ready</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"dojo/domReady!"</span>
],

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Dojo</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dojoArray, topic, dojoLang, Deferred,</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Ramp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        GlobalStorage, EventManager,

        Theme,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        subPanelTemplate2,
        subPanelTemplate,
        subPanelContentTemplate,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Util</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        UtilMisc, utilDict, popupManager, tmplHelper) {
        <span class="hljs-string">"use strict"</span>;

        <span class="hljs-keyword">var</span> jWindow = $(window),

            panelTabs = $(<span class="hljs-string">"ul#tabs"</span>),

            mapContent = $(<span class="hljs-string">"#mapContent"</span>),
            loadIndicator = mapContent.find(<span class="hljs-string">"#map-load-indicator"</span>),

            subPanels = {},</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>subPanelAttribute definition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-comment">/**
        * A class holding properties of the SubPanel.
        *
        * @class SubPanelSettings
        * @for SubPanel
        */</span>
            subPanelAttr = {
                <span class="hljs-comment">/**
                * A name used to identify the subpanel being opened (e.g. "Details", "Metadata")
                *
                * @property panelName
                * @for SubPanelSettings
                * @type {String}
                * @default ""
                */</span>

                panelName: <span class="hljs-string">""</span>,
                <span class="hljs-comment">/**
                * Title of the content to be displayed on the SubPanel (e.g. "CESI Water Quality Indicators")
                *
                * @property title
                * @type {String}
                * @default ""
                */</span>

                title: <span class="hljs-string">""</span>,
                <span class="hljs-comment">/**
                * The text inside the subpanel. Can be String or a jQuery object. All nodes sporting CSS class
                * ".shorten-candidate" are treated to the shortening procedure - long strings are curtailed, and [more/less] links are placed at their ends.
                *
                * @property content
                * @type {String | jObject}
                * @default null
                */</span>

                content: <span class="hljs-literal">null</span>,

                templateKey: <span class="hljs-string">"summary_sub_panel_container"</span>,
                <span class="hljs-comment">/**
                * The node after which the panel will be inserted (e.g. node.find(".layer-details")).
                *
                * @property target
                * @type {jObject}
                * @default null
                */</span>

                target: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The name of the module that requested to open the SubPanel (e.g. "filterManager"). Used for identification of the panel's loyalty.
                *
                * @property origin
                * @type {String}
                * @default ""
                */</span>

                origin: <span class="hljs-string">""</span>,
                <span class="hljs-comment">/**
                * A unique id of the SubPanel. If none provided, a random one is generated. It is used to determine the animation and update function
                * to run on content update.
                *
                * @property guid
                * @type {String}
                * @default ""
                */</span>

                guid: <span class="hljs-string">""</span>,
                <span class="hljs-comment">/**
                * Indicates that the open SubPanel request is a content update to the already opened SubPanel.
                * Does not trigger any of the `doOn-` or `doAfter-` functions.
                *
                * __Use case:__ the uses clicks on the metadata button.
                * 1. A request to open a SubPanel is sent with only the title since the metadata content is not yet available
                * 2. Metadata is fetched from the server
                * 3. A second request to open a SubPanel is sent having `update` set to `true` and featuring the __same__ `guid` as the first request
                * 4. Only the content of the SubPanel is updated; no extra animations are triggered
                *
                * @property update
                * @type {Boolean}
                * @default false
                */</span>

                update: <span class="hljs-literal">false</span>,
                <span class="hljs-comment">/**
                * The callback function when the panel starts the opening animation; also triggered by updating panel content; can be triggered many times.
                *
                * @property doOnOpen
                * @type {Function}
                * @default null
                */</span>

                doOnOpen: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The callback function when the panel finishes the opening animation; also triggered by updating panel content; can be triggered many times.
                *
                * @property doAfterOpen
                * @type {Function}
                * @default null
                */</span>

                doAfterOpen: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The callback function when the panel starts the closing animation; also triggered by updating panel content; can be triggered many times.
                *
                * @property doOnHide
                * @type {Function}
                * @default null
                */</span>

                doOnHide: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The callback function when the panel becomes hidden; also triggered by updating panel content; can be triggered many times.
                *
                * @property doAfterHide
                * @type {Function}
                * @default null
                */</span>

                doAfterHide: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The callback function when the panel is completely closed, its nodes destroyed; can be triggered only once in a lifespan of the panel.
                *
                * @property doOnDestroy
                * @type {Function}
                * @default null
                */</span>

                doOnDestroy: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The callback function executed after the SubPanel content is updated.
                * __Doesn't work correctly yet.__
                *
                * @property doAfterUpdate
                * @type {Function}
                * @default null
                */</span>

                doAfterUpdate: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The target number of chars after which a content text node will be shortened.
                *
                * @property showChars
                * @type {Number}
                * @default 170
                */</span>

                showChars: <span class="hljs-number">170</span>
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Panel Prototype</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-comment">/**
        * [subPanelPrototype description]
        *
        * @class SubPanel
        * @constructor
        * @for GUI
        */</span>
            subPanelPrototype = {
                <span class="hljs-comment">/**
                * Indicates if the closing animation is under way.
                *
                * @property _closing
                * @private
                * @for SubPanel
                * @type {Boolean}
                * @default false
                */</span>

                _closing: <span class="hljs-literal">false</span>,
                <span class="hljs-comment">/**
                * Holds a deferred that would destroy the panel after the closing animation completes. May be interrupted.
                *
                * @property _destroyDeferred
                * @type {Deferred}
                * @private
                * @default null
                */</span>

                _destroyDeferred: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * SubPanel attributes
                *
                * @property _attr
                * @private
                * @default null
                * @type {SubPanelSettings}
                */</span>

                _attr: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * Indicates if the SubPanel is visible at the moment. Doesn't make the panel visible or invisible, just prevents animations on the content
                * to run when it is set to `true`.
                *
                * @property _visible
                * @private
                * @default false
                * @type {Boolean}
                */</span>

                _visible: <span class="hljs-literal">false</span>,
                <span class="hljs-comment">/**
                * The outermost `div` of the SubPanel.
                *
                * @property container
                * @default null
                * @type {jObject}
                */</span>

                container: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The inner `div` of the SubPanel. Closing and opening animations are run on this `div`.
                *
                * @property panel
                * @default null
                * @type {jQobject}
                */</span>

                panel: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * `div` housing the content of the SubPanel, including its title.
                *
                * @property _subPanelContentDiv
                * @private
                * @default null
                * @type {jObject}
                */</span>

                _subPanelContentDiv: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * Heading of the content in the SubPanel.
                *
                * @property _panelTitle
                * @private
                * @default null
                * @type {jObject}
                */</span>

                _panelTitle: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * `div` housing the content of the SubPanel, excluding its title.
                *
                * @property _panelContentDiv
                * @private
                * @default null
                * @type {jObject}
                */</span>

                _panelContentDiv: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * Default duration of the SubPanel animation in milliseconds.
                *
                * @property _animatePanelDuration
                * @private
                * @default 400
                * @type {Number}
                */</span>

                _animatePanelDuration: <span class="hljs-number">500</span>, <span class="hljs-comment">//400,</span>

                timeLine: <span class="hljs-literal">null</span>,

                <span class="hljs-comment">/**
                * Apply the shortening plugin to the panel data
                *
                * @method parseContent
                * @param  {jObject} data Content to be shortened
                * @return {jObject} Content with after shortening long text nodes
                */</span>
                parseContent: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>console.log(this._attr.showChars, jQuery.type(data), data);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">return</span> (jQuery.type(data) === <span class="hljs-string">"object"</span> ? data : $(data))
                        .find(<span class="hljs-string">".shorten-candidate"</span>).shorten({
                            showChars: <span class="hljs-keyword">this</span>._attr.showChars
                        })
                        .removeClass(<span class="hljs-string">"shorten-candidate"</span>).end();
                },
                <span class="hljs-comment">/**
                * Returns this SubPanel's settings object.
                *
                * @method getAttributes
                * @return {SubPanelSettings} This SubPanel's settings
                */</span>
                getAttributes: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._attr;
                },
                <span class="hljs-comment">/**
                * Returns this SubPanel's container `div`.
                *
                * @method getContainer
                * @return {jobject} This SubPanel's `div`
                */</span>
                getContainer: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.container;
                },
                <span class="hljs-comment">/**
                * Returns the inner `div` of the SubPanel
                *
                * @method getPanel
                * @return {jObject} The inner `div` of the SubPanel
                */</span>
                getPanel: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.panel;
                },
                <span class="hljs-comment">/**
                * Returns the `origin` of this SubPanel.
                *
                * @method getOrigin
                * @return {String} The `origin` of this SubPanel
                */</span>
                getOrigin: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._attr.origin;
                },
                <span class="hljs-comment">/**
                * Returns the `guid` of this SubPanel.
                *
                * @method getOrigin
                * @return {String} The `guid` of this SubPanel
                */</span>
                getGuid: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._attr.guid;
                },
                <span class="hljs-comment">/**
                * Destroys this SubPanel.
                *
                * @method destroy
                * @param  {Number} speed    The duration of the animation in milliseconds
                * @param  {Deferred} deferred The deferred to be resolved after the SubPanel is destroyed
                */</span>
                destroy: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(speed, deferred)</span> {</span>
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doOnHide) {
                        <span class="hljs-keyword">this</span>._attr.doOnHide();
                    }

                    <span class="hljs-keyword">this</span>._closing = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">this</span>._destroyDeferred = deferred;</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>remove CSS animation class to prevent flickering</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">this</span>._subPanelContentDiv.find(<span class="hljs-string">".fadeInDown"</span>).removeClass(<span class="hljs-string">"fadeInDown"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>sidePanel.getContainer().after(this.container);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    layoutController.getPanelContainer().before(<span class="hljs-keyword">this</span>.container);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>adjutSubPanelDimensions(this);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                    layoutController.subPanelChange(<span class="hljs-literal">false</span>, <span class="hljs-keyword">this</span>._attr.origin, <span class="hljs-keyword">this</span>.container, <span class="hljs-literal">false</span>);

                    <span class="hljs-keyword">this</span>.timeLine.eventCallback(<span class="hljs-string">"onReverseComplete"</span>,
                        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doAfterHide) {
                                <span class="hljs-keyword">this</span>._attr.doAfterHide();
                            }
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doOnDestroy) {
                                <span class="hljs-keyword">this</span>._attr.doOnDestroy();
                            }
                            <span class="hljs-keyword">this</span>._visible = <span class="hljs-literal">false</span>;
                            layoutController.subPanelChange(<span class="hljs-literal">false</span>, <span class="hljs-keyword">this</span>._attr.origin, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);

                            <span class="hljs-keyword">this</span>.container.remove();

                            <span class="hljs-keyword">if</span> (deferred) {
                                deferred.resolve(<span class="hljs-literal">true</span>);
                            }
                        }, [], <span class="hljs-keyword">this</span>);

                    <span class="hljs-keyword">this</span>.timeLine.reverse();
                },

                <span class="hljs-comment">/**
                * Reopens the SubPanel - stops the closing animation and initiates the opening animation.
                *
                * @method reopen
                */</span>
                reopen: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>this.panel.stop();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">this</span>.timeLine.pause();
                    <span class="hljs-keyword">this</span>._closing = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._destroyDeferred) {
                        <span class="hljs-keyword">this</span>._destroyDeferred.cancel();
                        <span class="hljs-keyword">this</span>._destroyDeferred = <span class="hljs-literal">null</span>;
                    }

                    <span class="hljs-keyword">this</span>.open();
                },

                <span class="hljs-comment">/**
                * Opens the SubPanel. Sends out `EventManager.GUI.SUBPANEL_CHANGE` event.
                *
                * @method open
                */</span>
                open: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doOnOpen) {
                        <span class="hljs-keyword">this</span>._attr.doOnOpen();
                    }
                    <span class="hljs-keyword">this</span>._visible = <span class="hljs-literal">true</span>;
                    layoutController.subPanelChange(<span class="hljs-literal">true</span>, <span class="hljs-keyword">this</span>._attr.origin, <span class="hljs-keyword">this</span>.container, <span class="hljs-literal">false</span>);

                    <span class="hljs-keyword">this</span>.timeLine.play();
                },

                <span class="hljs-comment">/**
                * Assigns a new origin to the SubPanel.
                *
                * @method changeOrigin
                * @param  {String} newOrigin The new origin of the SubPanel.
                */</span>
                changeOrigin: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newOrigin)</span> {</span>
                    <span class="hljs-keyword">this</span>._attr.origin = newOrigin;
                },

                <span class="hljs-comment">/**
                * Shifts the SubPanel to the new node in the DOM.
                *
                * @method shiftTarget
                * @param  {jObject} newTarget A node in the DOM to shift the SubPanel to
                */</span>
                shiftTarget: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newTarget)</span> {</span>
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.target !== newTarget) {</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>remove animation class to prevent flickering of data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">this</span>._subPanelContentDiv.find(<span class="hljs-string">".fadeInDown"</span>).removeClass(<span class="hljs-string">"fadeInDown"</span>);
                        newTarget.after(<span class="hljs-keyword">this</span>.container);
                        <span class="hljs-keyword">this</span>._attr.target = newTarget;
                    }
                },

                <span class="hljs-comment">/**
                * Creates a new instance of SubPanel.
                *
                * @method create
                * @param  {SubPanelSettings} a Settings for the SubPanel
                */</span>
                create: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(a)</span> {</span>
                    <span class="hljs-keyword">var</span> <span class="hljs-comment">//subPanelContent,</span>
                        subPanelString,
                        parsedContent;

                    console.log(<span class="hljs-string">"create panel, "</span>, a.origin);

                    a.guid = a.guid || UtilMisc.guid();

                    dojoLang.mixin(<span class="hljs-keyword">this</span>._attr, a);

                    tmpl.cache = {};
                    tmpl.templates = subPanelTemplate;

                    subPanelString = tmpl(<span class="hljs-keyword">this</span>._attr.templateKey,
                        dojoLang.mixin(
                            <span class="hljs-keyword">this</span>._attr,
                            {
                                closeTitle: GlobalStorage.config.stringResources.txtClose
                            }
                        )
                    );</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>subPanelContent = String.format(subPanelContentTemplate, this._attr.panelName, this._attr.title);
subPanelString = String.format(subPanelTemplate2, this._attr.containerClass, subPanelContent);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                    <span class="hljs-keyword">this</span>.container = <span class="hljs-keyword">this</span>._attr.target.after(subPanelString).parent().find(<span class="hljs-string">".sub-panel-container"</span>);
                    <span class="hljs-keyword">this</span>.panel = <span class="hljs-keyword">this</span>.container.find(<span class="hljs-string">".sub-panel"</span>);

                    <span class="hljs-keyword">this</span>._subPanelContentDiv = <span class="hljs-keyword">this</span>.panel.find(<span class="hljs-string">".sub-panel-content"</span>);
                    <span class="hljs-keyword">this</span>._panelTitle = <span class="hljs-keyword">this</span>.panel.find(<span class="hljs-string">".panel-title"</span>);
                    <span class="hljs-keyword">this</span>._panelContentDiv = <span class="hljs-keyword">this</span>.panel.find(<span class="hljs-string">".panel-content-div"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>set content</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    parsedContent = <span class="hljs-keyword">this</span>.parseContent(<span class="hljs-keyword">this</span>._attr.content);
                    <span class="hljs-keyword">this</span>._panelContentDiv.empty().append(parsedContent);

                    <span class="hljs-keyword">this</span>.timeLine = <span class="hljs-keyword">new</span> TimelineLite(
                        {
                            paused: <span class="hljs-literal">true</span>,
                            onComplete: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doAfterOpen) {
                                    <span class="hljs-keyword">this</span>._attr.doAfterOpen();
                                }

                                layoutController.subPanelChange(<span class="hljs-literal">true</span>, <span class="hljs-keyword">this</span>._attr.origin, <span class="hljs-keyword">this</span>.container, <span class="hljs-literal">true</span>);
                            },
                            onCompleteScope: <span class="hljs-keyword">this</span>
                        })
                        .to(<span class="hljs-keyword">this</span>.panel, <span class="hljs-keyword">this</span>._animatePanelDuration / <span class="hljs-number">1000</span>,
                            {
                                left: <span class="hljs-number">0</span>,
                                ease: <span class="hljs-string">"easeOutCirc"</span>
                            });

                    Theme.tooltipster(<span class="hljs-keyword">this</span>.container);

                    <span class="hljs-keyword">this</span>.update(<span class="hljs-keyword">this</span>._attr);
                },

                <span class="hljs-comment">/**
                * Performs an update of the content and title of the SubPanel, running appropriate animation and `doOn-` / `doAfter-` functions.
                *
                * @method update
                * @param  {SubPanelSettings} a New settings for the SubPanel
                */</span>
                update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(a)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>helper functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> animateContentDuration = <span class="hljs-number">300</span>,
                        sOut = <span class="hljs-string">'&lt;ul class="loadingAnimation"&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;/ul&gt;'</span>,

                        updateDefered = [<span class="hljs-keyword">new</span> Deferred(), <span class="hljs-keyword">new</span> Deferred()],

                        animateContent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(node, newData, d)</span> {</span>
                            <span class="hljs-keyword">if</span> (newData) {
                                node.addClass(<span class="hljs-string">'animated fadeOutDown'</span>);
                                window.setTimeout(dojoLang.hitch(<span class="hljs-keyword">this</span>,
                                        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                            node</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>.html(newData)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                            .empty().append(newData)
                                                .removeClass(<span class="hljs-string">"fadeOutDown"</span>)
                                                .addClass(<span class="hljs-string">'animated fadeInDown'</span>); <span class="hljs-comment">//.find(".shorten-candidate").shorten();</span>

                                            d.resolve();
                                        }),
                                    animateContentDuration);
                            }
                        },

                        setContent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(node, oldData, newData, parsedData, visible, d)</span> {</span>
                            newData = (newData === <span class="hljs-literal">null</span>) ? parsedData = sOut : newData;
                            <span class="hljs-keyword">if</span> (newData) {
                                <span class="hljs-keyword">if</span> (newData !== oldData) {
                                    <span class="hljs-keyword">if</span> (visible) {</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>ideally, need to wait until the animation completes before proceeding?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                        animateContent(node, parsedData, d);
                                    } <span class="hljs-keyword">else</span> {
                                        node.empty().append(parsedData);
                                        d.resolve();
                                    }
                                } <span class="hljs-keyword">else</span> {
                                    d.resolve();
                                }
                            } <span class="hljs-keyword">else</span> {
                                d.resolve();
                            }
                        },

                        updateContent = dojoLang.hitch(<span class="hljs-keyword">this</span>,
                            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(a)</span> {</span>
                                <span class="hljs-keyword">this</span>._subPanelContentDiv.animate({
                                    scrollTop: <span class="hljs-number">0</span>
                                }, animateContentDuration, <span class="hljs-string">"easeOutCirc"</span>);

                                setContent(<span class="hljs-keyword">this</span>._panelTitle, <span class="hljs-keyword">this</span>._attr.title, a.title, a.title, <span class="hljs-keyword">this</span>._visible, updateDefered[<span class="hljs-number">0</span>]);
                                setContent(<span class="hljs-keyword">this</span>._panelContentDiv, <span class="hljs-keyword">this</span>._attr.content, a.content, <span class="hljs-keyword">this</span>.parseContent(a.content), <span class="hljs-keyword">this</span>._visible, updateDefered[<span class="hljs-number">1</span>]);

                                dojoLang.mixin(<span class="hljs-keyword">this</span>._attr, a);
                            }
                        );</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>doAfterUpdate should be called AFTER update (animation) completes…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    UtilMisc.afterAll(updateDefered, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        <span class="hljs-keyword">if</span> (a.doAfterUpdate) {
                            a.doAfterUpdate();
                        }
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>panel is closing; new data is not an update</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._closing &amp;&amp; !a.update) {</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.guid !== a.guid) {
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doOnHide) {
                                <span class="hljs-keyword">this</span>._attr.doOnHide();
                            }
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doAfterHide) {
                                <span class="hljs-keyword">this</span>._attr.doAfterHide();
                            }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>move panel to the new target</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            a.target.after(<span class="hljs-keyword">this</span>.container);
                            updateContent(a);
                        }

                        <span class="hljs-keyword">this</span>.reopen();</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>panel is not closing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._closing) {</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>data is not an update</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (!a.update &amp;&amp; <span class="hljs-keyword">this</span>._attr.guid !== a.guid) {
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doOnHide) {
                                <span class="hljs-keyword">this</span>._attr.doOnHide();
                            }
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doAfterHide) {
                                <span class="hljs-keyword">this</span>._attr.doAfterHide();
                            }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>move panel to the new target</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            a.target.after(<span class="hljs-keyword">this</span>.container);
                            updateContent(a);

                            <span class="hljs-keyword">if</span> (a.doOnOpen) {
                                a.doOnOpen();
                            }
                            <span class="hljs-keyword">if</span> (a.doAfterOpen) {
                                a.doAfterOpen();
                            }
                        }</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>guid is the same - data can update or not (should be an update)
if (a.update &amp;&amp; attr.guid === a.guid) {</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.guid === a.guid) {
                            updateContent(a);
                        }
                    }
                }
            },

            helpToggle = $(<span class="hljs-string">"#helpToggle"</span>),
            helpSectionContainer = $(<span class="hljs-string">"#help-section-container"</span>),
            helpSection = $(<span class="hljs-string">"#help-section"</span>),

            addLayerToggle = $(<span class="hljs-string">"#addLayer-toggle"</span>),
            addLayerSectionContainer = $(<span class="hljs-string">"#addLayer-section-container"</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>AddLayerSection = $(“#addLayer-section”),</p>

            </div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>viewPortHeight,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            cssButtonPressedClass = <span class="hljs-string">"button-pressed"</span>,
            cssExpandedClass = <span class="hljs-string">"state-expanded"</span>,

            helpPanelPopup,
            addLayerPanelPopup,

            transitionDuration = <span class="hljs-number">0.5</span>,

            layoutController;

        layoutController = (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> viewport = $(<span class="hljs-string">".viewport"</span>),
                mapDiv = $(<span class="hljs-string">"#map-div"</span>),
                mapContent = $(<span class="hljs-string">"#mapContent"</span>),
                fullScreenToggle = $(<span class="hljs-string">"#fullScreenToggle"</span>),

                mapToolbar = $(<span class="hljs-string">"#map-toolbar"</span>),
                basemapControls = $(<span class="hljs-string">"#basemapControls"</span>),

                panelDiv = $(<span class="hljs-string">"#panel-div"</span>),
                panelToggle = $(<span class="hljs-string">"#panel-toggle"</span>),
                panelPopup,
                panelWidthDefault,

                duration = <span class="hljs-number">0.5</span>,

                layoutChange,

                _isFullScreen = <span class="hljs-literal">false</span>,

                _isFullData = <span class="hljs-literal">false</span>,
                fullDataTimeLine = <span class="hljs-keyword">new</span> TimelineLite({
                    paused: <span class="hljs-literal">true</span>,
                    onComplete: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        adjustHeight();
                        layoutChange();
                        console.log(<span class="hljs-string">"finished"</span>, EventManager.Datagrid.APPLY_EXTENT_FILTER);</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>topic.publish(EventManager.Datagrid.APPLY_EXTENT_FILTER);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    },
                    onReverseComplete: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        adjustHeight();
                        layoutChange();
                        console.log(<span class="hljs-string">"reverse finished"</span>, EventManager.Datagrid.APPLY_EXTENT_FILTER);</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>topic.publish(EventManager.Datagrid.APPLY_EXTENT_FILTER);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    }
                }),

                panelToggleTimeLine = <span class="hljs-keyword">new</span> TimelineLite({ paused: <span class="hljs-literal">true</span> }),
                fullDataSubpanelChangeTimeLine = <span class="hljs-keyword">new</span> TimelineLite({ paused: <span class="hljs-literal">true</span> });

            <span class="hljs-comment">/**
            * Fires an event when the layout of the page changes.
            *
            * @method layoutChange
            * @private
            */</span>
            layoutChange = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">if</span> (!_isFullData) {
                    console.log(<span class="hljs-string">"GUI --&gt; EventManager.GUI.LAYOUT_CHANGE"</span>);
                    topic.publish(EventManager.GUI.LAYOUT_CHANGE);
                }
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">adjustHeight</span><span class="hljs-params">()</span> {</span>
                helpSection.css({
                    <span class="hljs-string">"max-height"</span>: jWindow.height() - (_isFullData ? jWindow.height() * <span class="hljs-number">0.2</span> : mapToolbar.offset().top) - <span class="hljs-number">90</span> <span class="hljs-comment">// 56 is an arbitrary-wide gap between the help panel and the upper toolbar</span>
                });
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onFullScreenComplete</span><span class="hljs-params">()</span> {</span>
                adjustHeight();
                layoutChange();
            }

            <span class="hljs-comment">/**
            * Return the default width of the SidePanel.
            *
            * @method getPanelWidthDefault
            * @private
            * @return {Number} The default width of the SidePanel
            */</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPanelWidthDefault</span><span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">if</span> (!panelWidthDefault) {
                    panelWidthDefault = panelDiv.width();
                }

                <span class="hljs-keyword">return</span> panelWidthDefault;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>fullDataTransition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            fullDataTimeLine
                .set(viewport, { className: <span class="hljs-string">"+=full-data-mode"</span> })
                .fromTo(mapDiv, transitionDuration, { width: <span class="hljs-string">"auto"</span> }, { right: <span class="hljs-string">"auto"</span>, width: <span class="hljs-number">35</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)

                .fromTo(mapContent, transitionDuration, { opacity: <span class="hljs-number">1</span> }, { opacity: <span class="hljs-number">0</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)
                .set(mapContent, { top: <span class="hljs-string">"500px"</span> })

                .to(panelToggle, transitionDuration, { right: -<span class="hljs-number">13</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)
                .set(panelToggle, { display: <span class="hljs-string">"none"</span> })

                .to(basemapControls, transitionDuration / <span class="hljs-number">2</span>, { opacity: <span class="hljs-number">0</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)
                .to(basemapControls, <span class="hljs-number">0</span>, { display: <span class="hljs-string">"none"</span> }, transitionDuration / <span class="hljs-number">2</span>)
                .fromTo(mapToolbar, transitionDuration / <span class="hljs-number">2</span>,
                    { width: <span class="hljs-string">"100%"</span>, height: <span class="hljs-string">"31px"</span> },
                    { width: <span class="hljs-number">31</span>, height: $(<span class="hljs-string">"#map-div"</span>).height(), ease: <span class="hljs-string">"easeOutCirc"</span> }, duration / <span class="hljs-number">2</span>)

                .to(mapToolbar.find(<span class="hljs-string">".map-toolbar-item-button span"</span>), transitionDuration / <span class="hljs-number">2</span>, { width: <span class="hljs-number">0</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)
                .set(mapToolbar.find(<span class="hljs-string">".map-toolbar-item-button span"</span>), { display: <span class="hljs-string">"none"</span> }, transitionDuration / <span class="hljs-number">2</span>)

                .fromTo(panelDiv.find(<span class="hljs-string">".tabs li:first"</span>), transitionDuration, { width: <span class="hljs-string">"50%"</span> }, { width: <span class="hljs-string">"0%"</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)
                .fromTo(panelDiv.find(<span class="hljs-string">".tabs li:last"</span>), transitionDuration, { width: <span class="hljs-string">"50%"</span> }, { width: <span class="hljs-string">"100%"</span>, className: <span class="hljs-string">"+=font-large"</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>panelToggleTransition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            panelToggleTimeLine
                .fromTo(panelDiv, transitionDuration, { right: <span class="hljs-number">0</span> }, { right: -getPanelWidthDefault(), ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)
                .set(panelDiv, { display: <span class="hljs-string">"none"</span> }, transitionDuration)
                .fromTo(mapDiv, transitionDuration, { right: getPanelWidthDefault() }, { right: <span class="hljs-number">0</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>);

            fullDataSubpanelChangeTimeLine.fromTo(panelDiv, transitionDuration, { right: <span class="hljs-string">"0px"</span>, left: <span class="hljs-string">"35px"</span> }, { left: <span class="hljs-string">"35px"</span>, right: <span class="hljs-string">"430px"</span>, ease: <span class="hljs-string">"easeOutCirc"</span> });

            <span class="hljs-comment">/*function _toggleFullScreenMode_(fullscreen) {
            megaMenu.css({
            position: "static"
            });
            subTitleText.css({
            position: "static"
            });

            toggleSubPanelContainer();
            toggleFooter();

            wbCore.animate({
            height: viewPortHeight + fullScreenDelta2
            }, "slow");

            titleBanner.animate({
            height: titleBanner.height() - titleBannerHalfHeight
            }, "slow");

            if (UtilMisc.isUndefined(fullscreen)) {
</span></pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>If expand is undefined, we toggle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            titleBannerHalfHeight *= -<span class="hljs-number">1</span>;
            fullScreenDelta2 *= -<span class="hljs-number">1</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fullscreen) {
            titleBannerHalfHeight = -<span class="hljs-number">1</span>;
            fullScreenDelta2 = -<span class="hljs-built_in">Math</span>.abs(fullScreenDelta2);
            } <span class="hljs-keyword">else</span> {
            titleBannerHalfHeight = <span class="hljs-number">1</span>;
            fullScreenDelta2 = <span class="hljs-built_in">Math</span>.abs(fullScreenDelta2);
            }

            <span class="hljs-keyword">var</span> strings = GlobalStorage.config.stringResources;
            fullScreenToggle.text(fullScreenDelta2 &lt; <span class="hljs-number">0</span> ? strings.txtShowHeaders : strings.txtFullScreen);

            navigation.slideToggle(<span class="hljs-string">"slow"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>subTitleText.slideToggle(“fast”);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            megaMenuDiv.slideToggle(<span class="hljs-string">"slow"</span>,
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            megaMenu.removeAttr(<span class="hljs-string">'style'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>needed to prevent “disappearing toolbar” effect</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            megamenuBar.css({
            "min-height": "32px"
            });

            adjustHeight();
            adjutSubPanelDimensions();
            });
            }*/

            /**
            * Publishes `PANEL_CHANGE` event when the visibility of the SidePanel changes.
            *
            * @method panelChange
            * @param  {Boolean} visible Indicates whether the SidePanel is visible or not
            * @for SidePanel
            * @private
            */
            function panelChange(visible) {
                topic.publish(EventManager.GUI.PANEL_CHANGE, {
                    visible: visible
                });
            }

            /**
            * Slides the SidePanel open.
            *
            * @method openPanel
            * @private
            * @param  {Deferred} d A deferred to be resolved upon completion of the animation
            */
            function openPanel(d) {
                /*jshint validthis: true */
                panelToggleTimeLine.eventCallback("onReverseComplete",
                        function () {
                            layoutChange();
                            panelChange(true);

                            panelToggle
                                .tooltipster("content", GlobalStorage.config.stringResources.txtClose)
                                .find("span.wb-invisible").text(GlobalStorage.config.stringResources.txtClose);

                            d.resolve();
                        }, [], this);

                panelToggleTimeLine.reverse();
            }

            /**
            * Slide the SidePanel close
            *
            * @method closePanel
            * @private
            * @param  {Deferred} d A deferred to be resolved upon completion of the animation
            */
            function closePanel(d) {
                /*jshint validthis: true */
                panelToggleTimeLine.eventCallback("onComplete",
                        function () {
                            UtilMisc.subscribeOnce("map/update-end", function () {
                                console.log("GUI &lt;-- map/update-end from gui");
                                panelChange(false);
                            });
                            layoutChange();

                            panelToggle
                                .tooltipster("content", GlobalStorage.config.stringResources.txtOpen)
                                .find("span.wb-invisible").text(GlobalStorage.config.stringResources.txtOpen);

                            d.resolve();
                        }, [], this);

                panelToggleTimeLine.play();
            }

            function _toggleFullDataMode(fullData) {
                _isFullData = UtilMisc.isUndefined(fullData) ? !_isFullData : _isFullData;

                if (_isFullData) {
                    TweenLite.fromTo(panelDiv, transitionDuration,
                        { width: 430, right: 0, left: "auto" },
                        { left: 35, right: 0, width: "auto", ease: "easeOutCirc" });

                    fullDataTimeLine.play();
                } else {
                    TweenLite.fromTo(panelDiv, transitionDuration,
                        { left: 35, width: "auto", right: panelDiv.css("right") },
                        { right: 0, width: 430, ease: "easeInCirc" });

                    fullDataTimeLine.reverse();
                }

                utilDict.forEachEntry(subPanels, function (key) {
                    hideSubPanel({
                        origin: key
                    });
                });
            }

            return {
                init: function () {</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>jWindow.on(“resize”, adjustWidth);</p>

            </div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>initialize the panel popup</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    panelPopup = popupManager.registerPopup(panelToggle, <span class="hljs-string">"click"</span>,
                        openPanel, {
                            activeClass: cssExpandedClass,
                            closeHandler: closePanel
                        }
                    );</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>set listener to the panel toggle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    topic.subscribe(EventManager.GUI.PANEL_TOGGLE, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        panelPopup.toggle();
                    });

                    Theme
                        .fullScreenCallback(<span class="hljs-string">"onComplete"</span>, onFullScreenComplete)
                        .fullScreenCallback(<span class="hljs-string">"onReverseComplete"</span>, onFullScreenComplete);</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>if the vertical space is too small, trigger the full-screen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (mapContent.height() &lt; jWindow.height() * <span class="hljs-number">0.6</span>) {
                        Theme.toggleFullScreenMode(<span class="hljs-literal">true</span>);
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>set listener to the full-screen toggle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    fullScreenToggle.click(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        Theme.toggleFullScreenMode();
                    });

                    adjustHeight();
                },

                isFullScreen: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> _isFullScreen;
                },

                <span class="hljs-comment">/**
                * Toggles the FullScreen mode of the application
                *
                * @method toggleFullScreenMode
                * @private
                * @param  {boolean} fullscreen true - expand; false - collapse; undefined - toggle;
                */</span>
                toggleFullScreenMode: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fullscreen)</span> {</span>
                    Theme.toggleFullScreenMode(fullscreen);
                },

                isFullData: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> _isFullData;
                },

                toggleFullDataMode: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fullData)</span> {</span>
                    _toggleFullDataMode(fullData);
                },

                <span class="hljs-comment">/**
                * Fires an event when the subpanel closes or opens.
                *
                * @method subPanelChange
                * @private
                * @param {Boolean} visible indicates whether the panel is visible or not
                * @param {String} origin origin of the subpanel
                * @param {JObject} container subpanel container
                * @param {Boolean} isComplete indicates if subPanel transition has completed or just started
                */</span>
                subPanelChange: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(visible, origin, container, isComplete)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>check if the fullData transition is already underway</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (!fullDataTimeLine.isActive() &amp;&amp; _isFullData &amp;&amp; !isComplete) {</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>adjust the sidePanel position shifting the right edge to the left, making space for the subpanel to open at</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (visible) {
                            fullDataSubpanelChangeTimeLine.play(<span class="hljs-number">0</span>);
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!visible) {
                            fullDataSubpanelChangeTimeLine.reverse();
                        }
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>hide the sidepanel toggle when a subpanel is opened to prevent the user from closing sidepanel with subpanel still opened</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (!isComplete) {
                        <span class="hljs-keyword">if</span> (visible) {
                            panelToggle.hide();
                        } <span class="hljs-keyword">else</span> {
                            panelToggle.show();
                        }
                    }

                    topic.publish(EventManager.GUI.SUBPANEL_CHANGE, {
                        visible: visible,
                        origin: origin,
                        container: container,
                        offsetLeft: (container) ? container.width() + <span class="hljs-number">25</span> + layoutController.getPanelWidth() : layoutController.getPanelWidth(),
                        isComplete: isComplete
                    });
                },

                <span class="hljs-comment">/**
                * Returns the outer most `div` of this SidePanel.
                *
                * @method getContainer
                * @return {jObject} The outer most `div` of this SidePanel
                */</span>
                getPanelContainer: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> panelDiv;
                },

                <span class="hljs-comment">/**
                * Gets the width of this SidePanel.
                *
                * @method width
                * @return {Number} The width of this SidePanel
                */</span>
                getPanelWidth: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> panelDiv.filter(<span class="hljs-string">":visible"</span>).width();
                }
            };
        }());

        <span class="hljs-comment">/**
        * Create a new SubPanel with the settings provided.
        *
        * @private
        * @method newSubPanel
        * @param  {SubPanelSettings} attr SubPanel settings
        * @return {SubPanel}      A newly created SubPanel
        * @for GUI
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newSubPanel</span><span class="hljs-params">(attr)</span> {</span>
            <span class="hljs-keyword">var</span> subPanel = <span class="hljs-built_in">Object</span>.create(subPanelPrototype);
            subPanel._attr = <span class="hljs-built_in">Object</span>.create(subPanelAttr);
            subPanel.create(attr);</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>adjutSubPanelDimensions(subPanel);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">return</span> subPanel;
        }

        <span class="hljs-comment">/**
        * Adjusts dimensions of the help panel relative to the mapContent `div`.
        *
        * @method adjustHelpDimensions
        * @private
        */</span>
        <span class="hljs-comment">/*function adjustHelpDimensions() {
        helpSection.css({
        "max-height": mapContent.height() - 56 // 56 is an arbitrary-wide gap between the help panel and the upper toolbar
        });
        }*/</span>

        <span class="hljs-comment">/**
        * Adjusts the dimensions and position of the SubPanel when layout of the page is changing.
        *
        * @method adjutSubPanelDimensions
        * @private
        * @param  {SubPanel} subPanel SubPanel whose dimensions and position need to be adjusted
        */</span>
        <span class="hljs-comment">/*function adjutSubPanelDimensions(subPanel) {
        function adjust(p, d) {
        if (p) {
        p.getContainer()
        .height(viewPortHeight - $("#map-toolbar").height()); //mapToolbar.height());

</span></pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>.position({
my: “right top”,
at: “right top+32”,
of: “#map-div” // mapContent
});</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        if (d) {
        d.resolve(true);
        }
        }
        }

        if (subPanel) {
        adjust(subPanel);
        } else {
        UtilMisc.executeOnDone(subPanels, adjust);
        }
        }*/

        /**
        * Creates and opens a new SubPanel with given settings.
        * If the SubPanel with the requested `origin` is already present, updates its content.
        *
        * @method showSubPanel
        * @private
        * @param  {SubPanelSettings} attr Settings for the SubPanel instance
        */
        function showSubPanel(attr) {
            var deferred = new Deferred(),
                subPanel;

            deferred.then(function () {
                attr = subPanel.getAttributes();
                subPanel = subPanels[attr.origin];

                subPanel.open();
                subPanel.getPanel().find(".sub-panel-toggle")
                    .on("click", dojoLang.hitch(this, function () {
                        hideSubPanel(attr);
                    }));

                loadIndicator.animate({
                    right: subPanel.getPanel().width() + 6
                }, "easeOutCirc");
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>take over the panel spawned by other components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (attr.consumeOrigin &amp;&amp; subPanels[attr.consumeOrigin]) {
                subPanel = subPanels[attr.consumeOrigin];
                subPanel.changeOrigin(attr.origin);
                subPanel.shiftTarget(attr.target);

                <span class="hljs-keyword">delete</span> subPanels[attr.consumeOrigin];
                subPanels[attr.origin] = subPanel;
            }

            <span class="hljs-keyword">if</span> (subPanels[attr.origin]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>if the panel exists, just update it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                subPanels[attr.origin].update(attr);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!attr.update) {</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>create if doesn’t</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                subPanel = newSubPanel(attr);
                subPanels[attr.origin] = subPanel;</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>close all other panels; and open the newly created one after all others are closed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                UtilMisc.executeOnDone(subPanels,
                    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(p, d)</span> {</span>
                        <span class="hljs-keyword">if</span> (p &amp;&amp; p.getOrigin() !== attr.origin) {
                            hideSubPanel({
                                origin: p.getOrigin()
                            }, <span class="hljs-number">200</span>, d);
                        } <span class="hljs-keyword">else</span> {
                            d.resolve(<span class="hljs-literal">true</span>);
                        }
                    },
                    deferred);
            }
        }

        <span class="hljs-comment">/**
        * Closes the SubPanel whose `origin` is specified in the `attr` parameter.
        *
        * @method hideSubPanel
        * @private
        * @param  {SubPanelSettings} attr  only `origin` attribute is required here
        * @param  {Number} speed Duration of the closing animation
        * @param  {Deferred} d     The deferred object to be resolved upon successful closing of the panel
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hideSubPanel</span><span class="hljs-params">(attr, speed, d)</span> {</span>
            <span class="hljs-keyword">var</span> deferred = <span class="hljs-keyword">new</span> Deferred(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">if</span> (d) {
                    d.cancel();
                }
            });

            deferred.then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>remove the panel from the object after it closes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">delete</span> subPanels[attr.origin]; <span class="hljs-comment">// more on delete: http://perfectionkills.com/understanding-delete/</span>
                <span class="hljs-keyword">if</span> (d) {
                    d.resolve(<span class="hljs-literal">true</span>);
                }
            });

            <span class="hljs-keyword">if</span> (subPanels[attr.origin]) {
                subPanels[attr.origin].destroy(speed, deferred);

                loadIndicator.animate({
                    right: <span class="hljs-number">3</span>
                }, <span class="hljs-string">"easeOutCirc"</span>);
            }
        }

        <span class="hljs-comment">/**
        * Moves the SubPanel with the specified `origin` in the DOM hierarchy to the new specified `target`; if `target` is not specified, the SubPanel is attached to the SidePanel.
        *
        * @method dockSubPanel
        * @private
        * @param  {SubPanelSettings} attr Settings for the SubPanel; only `target` and `origin` are required here
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dockSubPanel</span><span class="hljs-params">(attr)</span> {</span>
            <span class="hljs-keyword">var</span> target = attr.target || layoutController.getPanelContainer(),
                subPanel = subPanels[attr.origin];

            <span class="hljs-keyword">if</span> (subPanel) {</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>console.log(“docking subpanel”);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                subPanel.shiftTarget(target);
            }
        }

        <span class="hljs-comment">/**
        * Finds a SubPanel with `origin` equal to the supplied `consumeOrigin` and
        * + changes its `origin` to the supplied `origin`
        * + moves the SubPanel in the DOM hierarchy and attaches it to the specified target
        *
        * @method captureSubPanel
        * @private
        * @param  {SubPanelSettings} attr Settings for the SubPanel; only `origin`, `consumeOrigin` and `target` are required here
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">captureSubPanel</span><span class="hljs-params">(attr)</span> {</span>
            <span class="hljs-keyword">var</span> subPanel;

            <span class="hljs-keyword">if</span> (attr.consumeOrigin === attr.origin &amp;&amp; subPanels[attr.consumeOrigin]) {
                subPanel = subPanels[attr.origin];
                subPanel.shiftTarget(attr.target);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (attr.consumeOrigin &amp;&amp; subPanels[attr.consumeOrigin]) {
                subPanel = subPanels[attr.consumeOrigin];
                subPanel.changeOrigin(attr.origin);
                subPanel.shiftTarget(attr.target);

                <span class="hljs-keyword">delete</span> subPanels[attr.consumeOrigin];
                subPanels[attr.origin] = subPanel;
            }
        }

        <span class="hljs-keyword">return</span> {
            <span class="hljs-comment">/**
            * Call load to initialize the GUI module.
            *
            * @method load
            * @param  {Number} id   ID of this module
            * @param  {?} req  ???
            * @param  {Function} load The callback function
            */</span>
            load: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(id, req, load)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>measure available space on every page resize</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                subPanelTemplate = <span class="hljs-built_in">JSON</span>.parse(tmplHelper.stringifyTemplate(subPanelTemplate));

                layoutController.init();</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>registering help popup</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                helpPanelPopup = popupManager.registerPopup(helpToggle, <span class="hljs-string">"click"</span>,
                    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> {</span>
                        topic.publish(EventManager.GUI.HELP_PANEL_CHANGE, { visible: <span class="hljs-literal">true</span> });
                        topic.publish(EventManager.GUI.TOOLBAR_SECTION_OPEN, { id: <span class="hljs-string">"help-section"</span> });
                        console.log(EventManager.GUI.HELP_PANEL_CHANGE + <span class="hljs-string">"; visible:"</span>, <span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>close this panel if any other panel is opened</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        UtilMisc.subscribeOnce(EventManager.GUI.TOOLBAR_SECTION_OPEN, dojoLang.hitch(<span class="hljs-keyword">this</span>,
                            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isOpen()) {
                                    <span class="hljs-keyword">this</span>.close();
                                }
                            })
                        );

                        helpSectionContainer.slideToggle(<span class="hljs-string">"fast"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                            d.resolve();
                        });
                    }, {
                        activeClass: cssButtonPressedClass,
                        target: helpSectionContainer,
                        closeHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> {</span>
                            topic.publish(EventManager.GUI.HELP_PANEL_CHANGE, { visible: <span class="hljs-literal">false</span> });
                            topic.publish(EventManager.GUI.TOOLBAR_SECTION_CLOSE, { id: <span class="hljs-string">"help-section"</span> });
                            console.log(EventManager.GUI.HELP_PANEL_CHANGE + <span class="hljs-string">"; visible:"</span>, <span class="hljs-literal">false</span>);

                            helpSectionContainer.slideToggle(<span class="hljs-string">"fast"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                d.resolve();
                            });
                        }
                    }
                );</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Start AddLayer popup controller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                addLayerPanelPopup = popupManager.registerPopup(addLayerToggle, <span class="hljs-string">"click"</span>,
                    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> {</span>
                        topic.publish(EventManager.GUI.ADD_LAYER_PANEL_CHANGE, { visible: <span class="hljs-literal">true</span> });
                        topic.publish(EventManager.GUI.TOOLBAR_SECTION_OPEN, { id: <span class="hljs-string">"add-layer-section"</span> });
                        console.log(EventManager.GUI.ADD_LAYER_PANEL_CHANGE + <span class="hljs-string">" visible:"</span>, <span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>close this panel if any other panel is opened</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        UtilMisc.subscribeOnce(EventManager.GUI.TOOLBAR_SECTION_OPEN, dojoLang.hitch(<span class="hljs-keyword">this</span>,
                            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isOpen()) {
                                    <span class="hljs-keyword">this</span>.close();
                                }
                            })
                        );

                        addLayerSectionContainer.slideToggle(<span class="hljs-string">"fast"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                            d.resolve();
                        });
                    }, {
                        activeClass: cssButtonPressedClass,
                        target: addLayerSectionContainer,
                        closeHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> {</span>
                            topic.publish(EventManager.GUI.ADD_LAYER_PANEL_CHANGE, { visible: <span class="hljs-literal">false</span> });
                            topic.publish(EventManager.GUI.TOOLBAR_SECTION_CLOSE, { id: <span class="hljs-string">"add-layer-section"</span> });
                            console.log(EventManager.GUI.ADD_LAYER_PANEL_CHANGE + <span class="hljs-string">" visible:"</span>, <span class="hljs-literal">false</span>);

                            addLayerSectionContainer.slideToggle(<span class="hljs-string">"fast"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                d.resolve();
                            });
                        }
                    }
                );

                $(<span class="hljs-string">"#addLayer-add"</span>).on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    topic.publish(EventManager.Map.ADD_LAYER, <span class="hljs-literal">null</span>);

                    addLayerSectionContainer.slideToggle(<span class="hljs-string">"fast"</span>);
                });</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>End Add Layer</p>

            </div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>start extended grid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                topic.subscribe(<span class="hljs-string">"gui/grid/expand"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    layoutController.toggleFullDataMode();
                });</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>end extended grid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                topic.subscribe(EventManager.GUI.TOGGLE_FULLSCREEN, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(evt)</span> {</span>
                    layoutController.toggleFullScreenMode(evt.expand);
                });

                topic.subscribe(EventManager.GUI.SUBPANEL_OPEN, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(attr)</span> {</span>
                    showSubPanel(attr);
                });

                topic.subscribe(EventManager.GUI.SUBPANEL_CLOSE, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(attr)</span> {</span>
                    <span class="hljs-keyword">if</span> (attr.origin === <span class="hljs-string">"all"</span>) {
                        utilDict.forEachEntry(subPanels, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>attr.origin = key;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            hideSubPanel({
                                origin: key
                            });
                        });
                    } <span class="hljs-keyword">else</span> {
                        dojoArray.forEach(attr.origin.split(<span class="hljs-string">","</span>), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(element)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>attr.origin = element;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            hideSubPanel({
                                origin: element
                            });
                        });
                    }
                });

                topic.subscribe(EventManager.GUI.SUBPANEL_DOCK, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(attr)</span> {</span>
                    <span class="hljs-keyword">var</span> na;
                    <span class="hljs-keyword">if</span> (attr.origin === <span class="hljs-string">"all"</span>) {
                        utilDict.forEachEntry(subPanels, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span>
                            na = <span class="hljs-built_in">Object</span>.create(attr);
                            na.origin = key;
                            dockSubPanel(na);
                        });
                    } <span class="hljs-keyword">else</span> {
                        dojoArray.forEach(attr.origin.split(<span class="hljs-string">","</span>), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(element)</span> {</span>
                            na = <span class="hljs-built_in">Object</span>.create(attr);
                            na.origin = element;
                            dockSubPanel(na);
                        });
                    }
                    console.log(EventManager.GUI.SUBPANEL_DOCK);
                });

                topic.subscribe(EventManager.GUI.SUBPANEL_CAPTURE, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(attr)</span> {</span>
                    <span class="hljs-keyword">var</span> na;
                    <span class="hljs-keyword">if</span> (attr.consumeOrigin === <span class="hljs-string">"all"</span>) {
                        utilDict.forEachEntry(subPanels, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span>
                            na = <span class="hljs-built_in">Object</span>.create(attr);
                            na.consumeOrigin = key;
                            captureSubPanel(na);
                        });
                    } <span class="hljs-keyword">else</span> {
                        dojoArray.forEach(attr.consumeOrigin.split(<span class="hljs-string">","</span>), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(element)</span> {</span>
                            na = <span class="hljs-built_in">Object</span>.create(attr);
                            na.consumeOrigin = element;
                            captureSubPanel(na);
                        });
                    }
                    console.log(EventManager.GUI.SUBPANEL_CAPTURE);
                });

                panelTabs.find(<span class="hljs-string">"li a"</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    topic.publish(EventManager.GUI.TAB_SELECTED, {
                        id: <span class="hljs-keyword">this</span>.id,
                        tabName: <span class="hljs-keyword">this</span>.attributes[<span class="hljs-string">"data-panel-name"</span>].value
                    });

                    panelTabs.find(<span class="hljs-string">"li:not(.active) a"</span>).each(
                        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                            topic.publish(EventManager.GUI.TAB_DESELECTED, {
                                id: <span class="hljs-keyword">this</span>.id,
                                tabName: <span class="hljs-keyword">this</span>.attributes[<span class="hljs-string">"data-panel-name"</span>].value
                            });
                        });
                });</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>return the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                load();
            }
        };
    }
);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
