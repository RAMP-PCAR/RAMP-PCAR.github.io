<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\js\RAMP\Modules\layerGroup.js - ramp-pcar</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..\..\..\assets\images\bobcat_logo_sharp_smaller_s.png" title="ramp-pcar">Reusable Accessible Mapping Platform</h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 5.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AdvancedToolbar.html">AdvancedToolbar</a></li>
            
                <li><a href="../classes/Array.html">Array</a></li>
            
                <li><a href="../classes/BaseMapSelector.html">BaseMapSelector</a></li>
            
                <li><a href="../classes/BaseTool.html">BaseTool</a></li>
            
                <li><a href="../classes/BookmarkLink.html">BookmarkLink</a></li>
            
                <li><a href="../classes/Bootstrapper.html">Bootstrapper</a></li>
            
                <li><a href="../classes/BufferTool.html">BufferTool</a></li>
            
                <li><a href="../classes/Checkbox.html">Checkbox</a></li>
            
                <li><a href="../classes/CheckboxGroup.html">CheckboxGroup</a></li>
            
                <li><a href="../classes/Datagrid.html">Datagrid</a></li>
            
                <li><a href="../classes/DatagridClickHandler.html">DatagridClickHandler</a></li>
            
                <li><a href="../classes/Decorator.html">Decorator</a></li>
            
                <li><a href="../classes/Dictionary.html">Dictionary</a></li>
            
                <li><a href="../classes/EventManager.html">EventManager</a></li>
            
                <li><a href="../classes/FeatureClickHandler.html">FeatureClickHandler</a></li>
            
                <li><a href="../classes/FeatureHighlighter.html">FeatureHighlighter</a></li>
            
                <li><a href="../classes/FilterManager.html">FilterManager</a></li>
            
                <li><a href="../classes/FunctionMangler.html">FunctionMangler</a></li>
            
                <li><a href="../classes/GlobalStorage.html">GlobalStorage</a></li>
            
                <li><a href="../classes/GraphicExtension.html">GraphicExtension</a></li>
            
                <li><a href="../classes/GUI.html">GUI</a></li>
            
                <li><a href="../classes/LayerGroup.html">LayerGroup</a></li>
            
                <li><a href="../classes/LayerItem.html">LayerItem</a></li>
            
                <li><a href="../classes/LayerLoader.html">LayerLoader</a></li>
            
                <li><a href="../classes/LayoutController.html">LayoutController</a></li>
            
                <li><a href="../classes/Map.html">Map</a></li>
            
                <li><a href="../classes/MapClickHandler.html">MapClickHandler</a></li>
            
                <li><a href="../classes/Maptips.html">Maptips</a></li>
            
                <li><a href="../classes/MeasureTool.html">MeasureTool</a></li>
            
                <li><a href="../classes/Navigation.html">Navigation</a></li>
            
                <li><a href="../classes/PopulationTool.html">PopulationTool</a></li>
            
                <li><a href="../classes/Popup.html">Popup</a></li>
            
                <li><a href="../classes/PopupBase.html">PopupBase</a></li>
            
                <li><a href="../classes/PopupBaseSettings.html">PopupBaseSettings</a></li>
            
                <li><a href="../classes/PopupManager.html">PopupManager</a></li>
            
                <li><a href="../classes/Prototype.html">Prototype</a></li>
            
                <li><a href="../classes/QuickZoom.html">QuickZoom</a></li>
            
                <li><a href="../classes/RAMP.html">RAMP</a></li>
            
                <li><a href="../classes/RampMap.html">RampMap</a></li>
            
                <li><a href="../classes/RAMPStarter.html">RAMPStarter</a></li>
            
                <li><a href="../classes/SubPanel.html">SubPanel</a></li>
            
                <li><a href="../classes/SubPanelSettings.html">SubPanelSettings</a></li>
            
                <li><a href="../classes/Theme.html">Theme</a></li>
            
                <li><a href="../classes/TmplHelper.html">TmplHelper</a></li>
            
                <li><a href="../classes/TmplUtil.html">TmplUtil</a></li>
            
                <li><a href="../classes/Url.html">Url</a></li>
            
                <li><a href="../classes/Util.html">Util</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/BookmarkLink.html">BookmarkLink</a></li>
            
                <li><a href="../modules/Datagrid.html">Datagrid</a></li>
            
                <li><a href="../modules/DataLoader.html">DataLoader</a></li>
            
                <li><a href="../modules/FilterManager.html">FilterManager</a></li>
            
                <li><a href="../modules/GlobalStorage.html">GlobalStorage</a></li>
            
                <li><a href="../modules/Map.html">Map</a></li>
            
                <li><a href="../modules/Maptips.html">Maptips</a></li>
            
                <li><a href="../modules/MeasureTool.html">MeasureTool</a></li>
            
                <li><a href="../modules/Navigation.html">Navigation</a></li>
            
                <li><a href="../modules/QuickZoom.html">QuickZoom</a></li>
            
                <li><a href="../modules/RAMP.html">RAMP</a></li>
            
                <li><a href="../modules/Theme.html">Theme</a></li>
            
                <li><a href="../modules/TmplUtil.html">TmplUtil</a></li>
            
                <li><a href="../modules/Tools.html">Tools</a></li>
            
                <li><a href="../modules/UI.html">UI</a></li>
            
                <li><a href="../modules/Utils.html">Utils</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\js\RAMP\Modules\layerGroup.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
ï»¿/* global define, tmpl, $, console */

/**
* @module RAMP
* @submodule FilterManager
* @main FilterManager
*/

/**
* 
* ####Imports RAMP Modules:
* {{#crossLink &quot;TmplHelper&quot;}}{{/crossLink}}  
* {{#crossLink &quot;Array&quot;}}{{/crossLink}}  
* {{#crossLink &quot;LayerItem&quot;}}{{/crossLink}}  
*  
* ####Uses RAMP Templates:
* {{#crossLink &quot;templates/layer_selector_template.json&quot;}}{{/crossLink}}
* 
* @class LayerGroup
* @constructor
* @uses dojo/Evented
* @uses dojo/_base/declare
* @uses dojo/_base/lang
* @uses dojo/_base/array
*
* @param {Array} layers an array of layer config definitions to be added to the group
* @param {Object} [options] Additional options
* 
* @param {String} [options.groupType] Specifies type of this LayerGroup and the name of the layer group template to use
* @param {String} [options.layerState] Specifies the initial state of any LyerItem added to this group; must be one of the &#x60;LayerItem.state&#x60; defaults
* @param {String} [options.layerType] Specifies type of any LayerItem added to this group and the name of the layer item template to use
* 
* @param {Object} [options.stateMatrix] additional state matrix records to be mixed into the default
* @param {Object} [options.transitionMatrix] additional state transition matrix records to be mixed into the default

*
* @return {LayerGroup} A control object representing a group of layers allowing to dynamically change their states.
*/

define([
    &quot;dojo/Evented&quot;, &quot;dojo/_base/declare&quot;, &quot;dojo/_base/lang&quot;, &quot;dojo/_base/array&quot;,

    /* Text */
    &quot;dojo/text!./templates/layer_selector_template.json&quot;,

    /* Util */
    &quot;utils/tmplHelper&quot;, &quot;utils/array&quot;, &quot;utils/dictionary&quot;,

    /* RAMP */
    &quot;ramp/layerItem&quot;
],
    function (
        Evented, declare, lang, dojoArray,
        layer_selector_template,
        TmplHelper, UtilArray, UtilDict,
        LayerItem) {
        &quot;use strict&quot;;

        return declare([Evented], {
            constructor: function (layers, options) {
                var that = this;

                // declare individual properties inside the constructor: http://dojotoolkit.org/reference-guide/1.9/dojo/_base/declare.html#id6
                lang.mixin(this,
                    {
                        /**
                         * A node of the LayerGroup.
                         *
                         * @property node
                         * @type JObject
                         * @default null
                         */
                        node: null,

                        /**
                         * A node of the list in the LayerGroup.
                         *
                         * @property node
                         * @private
                         * @type JObject
                         * @default null
                         */
                        _listNode: null,

                        /**
                         * Templates to be used in construction of the layer nodes.
                         *
                         * @property templates
                         * @type Object
                         * @default layer_selector_template.json
                         */
                        templates: JSON.parse(TmplHelper.stringifyTemplate(layer_selector_template)),

                        /**
                         * Specifies type of this LayerGroup and the name of the layer group template to use; is set by &#x60;groupType&#x60; value;
                         *
                         * @property groupType
                         * @type String
                         * @default &quot;layer_group&quot;
                         */
                        groupType: &quot;layer_group&quot;,

                        /**
                         * Specifies type of any LayerItem added to this group during initialization and the name of the layer item template to use; is set by &#x60;layerType&#x60; value;; can be overwritten when adding individual layers by &#x60;options.type&#x60;.
                         *
                         * @property type
                         * @type String
                         * @default null
                         */
                        layerType: null,

                        /**
                         * State of any LayerItem added to this group during its initialization; is set by &#x60;layerSate&#x60; value; can be overwritten when adding individual layers by &#x60;options.state&#x60;.
                         *
                         * @property state
                         * @type String
                         * @default LayerItem.state.DEFAULT
                         */
                        layerState: LayerItem.state.DEFAULT,

                        /**
                         * An array of layer config definitions to be added to the group during initialization; is set to &#x60;layers&#x60; value.
                         *
                         * @property layers
                         * @type Array
                         * @default []
                         */
                        layers: [],

                        /**
                         * An array of resulting LayerItem objects.
                         *
                         * @property layerItems
                         * @type Array
                         * @default []
                         */
                        layerItems: []
                    },
                    options,
                    {
                        layers: layers
                    }
                );

                // create group node from the template
                this.node = $(this._template(this.groupType));
                this._listNode = this.node.find(&quot;ul&quot;);

                console.debug(LayerItem.state);

                this.layers.forEach(function (layer) {
                    that.addLayerItem(layer);
                });
            },

            /**
             * Constructs and adds a LayerItem to the LayerGroup.
             *
             * @param {Object} layer config of the layer to be added
             * @param {Object} options additional options allowing for customization
             * @method addLayerItem
             * @return {Object} the item that was added
             */
            addLayerItem: function (layer, options) {
                var layerItem,
                    layerItemOptions = {
                        stateMatrix: this._constructStateMatrix(layer)
                    };

                lang.mixin(layerItemOptions,
                    {
                        state: this.layerState,
                        type: this.layerType
                    },
                    options
                );

                layerItem = new LayerItem(layer, layerItemOptions);

                this.layerItems.push(layerItem);
                this._listNode.prepend(layerItem.node);

                if (this.layerItems.length === 1) {
                    this.node.show();
                }

                return layerItem;
            },

            /**
             * Removes the specified LayerItem from the LayerGroup.
             *
             * @param {String} layerId id of the layer to be removed
             * @method removeLayerItem
             * @return {Object} this LayerGroup for chaining
             */
            removeLayerItem: function (layerId) {
                var layerItem = this.getLayerItem(layerId);

                // remove layerItem from DOM
                layerItem.node.remove();

                // remove layerItem from the list
                UtilArray.remove(this.layerItems, layerItem, function (l) {
                    return l.id === layerItem.id;
                });

                if (this.layerItems.length === 0) {
                    this.node.hide();
                }

                return this;
            },

            /**
             * Modifies the state matrix of the layer to accommodate types of layers that might not use/have all the default controls or have extra controls.
             *
             * @param {Object} layerConfig layer config
             * @method _constructStateMatrix
             * @private
             * @return {Object} modified layer state matrix
             */
            _constructStateMatrix: function (layerConfig) {
                var stateMatrix = lang.clone(LayerItem.stateMatrix);

                if (!layerConfig.settings.panelEnabled) {
                    this._removeStateMatrixPart(stateMatrix, &quot;controls&quot;, LayerItem.controls.SETTINGS);
                }

                // remove bounding box toggle if there is no layer extent property - layer is a wms layer
                if (!layerConfig.layerExtent || layerConfig.isStatic) {
                    this._removeStateMatrixPart(stateMatrix, &quot;toggles&quot;, LayerItem.toggles.BOX);
                    this._addStateMatrixPart(stateMatrix, &quot;toggles&quot;, LayerItem.toggles.PLACEHOLDER);
                }

                return stateMatrix;
            },

            /**
             * Modifies the state matrix by adding specified partKey to the specified partType collection
             *
             * @param {Object} stateMatrix matrix to modify
             * @param {String} partType type of the parts to modify: &#x60;controls&#x60;, &#x60;toggles&#x60;, &#x60;notices&#x60;
             * @param {String} partKey part key to be inserted into the collection
             * @method _addStateMatrixPart
             * @private
             */
            _addStateMatrixPart: function (stateMatrix, partType, partKey) {
                UtilDict.forEachEntry(stateMatrix, function (state, data) {
                    data[partType].push(partKey);
                });
            },

            /**
             * Modifies the state matrix by removing specified partKey to the specified partType collection
             *
             * @param {Object} stateMatrix matrix to modify
             * @param {String} partType type of the parts to modify: &#x60;controls&#x60;, &#x60;toggles&#x60;, &#x60;notices&#x60;
             * @param {String} partKey part key to be removed into the collection
             * @method _addStateMatrixPart
             * @private
             */
            _removeStateMatrixPart: function (stateMatrix, partType, partKey) {
                UtilDict.forEachEntry(stateMatrix, function (state, data) {
                    UtilArray.remove(data[partType], partKey);
                });
            },

            /**
             * Constructs and adds a LayerItem to the LayerGroup.
             *
             * @param {String} layerId an id of the LayerItem to set the state on
             * @param {String} state state to be set; must be one of the &#x60;LayerItem.state&#x60; defaults
             * @param {Object} options additional options allowing for customization
             * @method setState
             */
            setState: function (layerId, state, options) {
                var layerItem = this.getLayerItem(layerId);

                if (layerItem) {
                    layerItem.setState(state, options);
                }
            },

            /**
             * Finds and returns a LayerItem object with the specified id. If none found, returns null.
             *
             * @param {String} layerId an id of the LayerItem to return
             * @return {LayerItem} a LayerItem with the specified id
             * @method getLayerItem
             */
            getLayerItem: function (layerId) {
                var layerItem;

                layerItem = UtilArray.find(this.layerItems, function (li) {
                    return li.id === layerId;
                });

                return layerItem;
            },

            /**
             * Populates a template specified by the key with the supplied data.
             *
             * @param {String} key template name
             * @param {Object} data data to be inserted into the template
             * @method _template
             * @private
             * @return {String} a string template filled with supplied data
             */
            _template: function (key, data) {
                tmpl.cache = {};
                tmpl.templates = this.templates;

                data = data || {};

                return tmpl(key, data);
            }
        });
    });
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
