<!DOCTYPE html>

<html>
<head>
  <title>gui.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="advancedToolbar.html">
                advancedToolbar.js
              </a>
            
              
              <a class="source" href="attributeLoader.html">
                attributeLoader.js
              </a>
            
              
              <a class="source" href="basemapSelector.html">
                basemapSelector.js
              </a>
            
              
              <a class="source" href="bookmarkLink.html">
                bookmarkLink.js
              </a>
            
              
              <a class="source" href="dataLoader.html">
                dataLoader.js
              </a>
            
              
              <a class="source" href="dataLoaderGui.html">
                dataLoaderGui.js
              </a>
            
              
              <a class="source" href="datagrid.html">
                datagrid.js
              </a>
            
              
              <a class="source" href="datagridClickHandler.html">
                datagridClickHandler.js
              </a>
            
              
              <a class="source" href="eventManager.html">
                eventManager.js
              </a>
            
              
              <a class="source" href="featureClickHandler.html">
                featureClickHandler.js
              </a>
            
              
              <a class="source" href="featureHighlighter.html">
                featureHighlighter.js
              </a>
            
              
              <a class="source" href="filterManager.html">
                filterManager.js
              </a>
            
              
              <a class="source" href="geoSearch.html">
                geoSearch.js
              </a>
            
              
              <a class="source" href="globalStorage.html">
                globalStorage.js
              </a>
            
              
              <a class="source" href="graphicExtension.html">
                graphicExtension.js
              </a>
            
              
              <a class="source" href="gui.html">
                gui.js
              </a>
            
              
              <a class="source" href="imageExport.html">
                imageExport.js
              </a>
            
              
              <a class="source" href="layerGroup.html">
                layerGroup.js
              </a>
            
              
              <a class="source" href="layerItem.html">
                layerItem.js
              </a>
            
              
              <a class="source" href="layerLoader.html">
                layerLoader.js
              </a>
            
              
              <a class="source" href="map.html">
                map.js
              </a>
            
              
              <a class="source" href="mapClickHandler.html">
                mapClickHandler.js
              </a>
            
              
              <a class="source" href="maptips.html">
                maptips.js
              </a>
            
              
              <a class="source" href="metadataHandler.html">
                metadataHandler.js
              </a>
            
              
              <a class="source" href="navigation.html">
                navigation.js
              </a>
            
              
              <a class="source" href="quickzoom.html">
                quickzoom.js
              </a>
            
              
              <a class="source" href="stepItem.html">
                stepItem.js
              </a>
            
              
              <a class="source" href="theme.html">
                theme.js
              </a>
            
              
              <a class="source" href="RAMP-starter.html">
                RAMP-starter.js
              </a>
            
              
              <a class="source" href="areaTool.html">
                areaTool.js
              </a>
            
              
              <a class="source" href="baseTool.html">
                baseTool.js
              </a>
            
              
              <a class="source" href="bufferTool.html">
                bufferTool.js
              </a>
            
              
              <a class="source" href="distanceTool.html">
                distanceTool.js
              </a>
            
              
              <a class="source" href="populationTool.html">
                populationTool.js
              </a>
            
              
              <a class="source" href="array.html">
                array.js
              </a>
            
              
              <a class="source" href="bricks.html">
                bricks.js
              </a>
            
              
              <a class="source" href="checkbox.html">
                checkbox.js
              </a>
            
              
              <a class="source" href="checkboxGroup.html">
                checkboxGroup.js
              </a>
            
              
              <a class="source" href="decorator.html">
                decorator.js
              </a>
            
              
              <a class="source" href="dictionary.html">
                dictionary.js
              </a>
            
              
              <a class="source" href="functionMangler.html">
                functionMangler.js
              </a>
            
              
              <a class="source" href="popupManager.html">
                popupManager.js
              </a>
            
              
              <a class="source" href="prototype.html">
                prototype.js
              </a>
            
              
              <a class="source" href="tmplHelper.html">
                tmplHelper.js
              </a>
            
              
              <a class="source" href="tmplUtil.html">
                tmplUtil.js
              </a>
            
              
              <a class="source" href="url.html">
                url.js
              </a>
            
              
              <a class="source" href="util.html">
                util.js
              </a>
            
              
              <a class="source" href="bootstrapper.html">
                bootstrapper.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>gui.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>ï»¿<span class="hljs-comment">/* global define, $, window, TweenLite, TimelineLite, i18n, console, jQuery, RAMP */</span>
<span class="hljs-comment">/*jslint white: true */</span>

<span class="hljs-comment">/**
* UI submodule
*
* @module RAMP
* @submodule UI
* @main UI
*/</span>

<span class="hljs-comment">/**
* A class for handling most of the GUI on the page.
*
* ####Imports RAMP Modules:
* {{#crossLink "GlobalStorage"}}{{/crossLink}}  
* {{#crossLink "EventManager"}}{{/crossLink}}  
* {{#crossLink "Theme"}}{{/crossLink}}  
* {{#crossLink "Util"}}{{/crossLink}}  
* {{#crossLink "Dictionary"}}{{/crossLink}}  
* {{#crossLink "PopupManager"}}{{/crossLink}}  
* {{#crossLink "TmplHelper"}}{{/crossLink}}  
* 
* ####Uses RAMP Templates:
* {{#crossLink "templates/sub_panel_template.json"}}{{/crossLink}}
* 
* @class GUI
* @static
* @uses dojo/_base/array
* @uses dojo/topic
* @uses dojo/_base/lang
* @uses dojo/Deferred
* @uses dojo/domReady!
* @uses dojo/domReady!
*/</span>
define([</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Dojo</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"dojo/topic"</span>, <span class="hljs-string">"dojo/_base/lang"</span>, <span class="hljs-string">"dojo/Deferred"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Ramp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"ramp/globalStorage"</span>, <span class="hljs-string">"ramp/eventManager"</span>,

        <span class="hljs-string">"ramp/theme"</span>, <span class="hljs-string">"ramp/imageExport"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"dojo/text!./templates/sub_panel_template.json"</span>,
        <span class="hljs-string">"dojo/text!./templates/datagrid_template.json"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Util</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"utils/util"</span>, <span class="hljs-string">"utils/dictionary"</span>, <span class="hljs-string">"utils/popupManager"</span>, <span class="hljs-string">"utils/tmplHelper"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Dom Ready</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"dojo/domReady!"</span>
],

    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">
</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Dojo</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        topic, dojoLang, Deferred,</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Ramp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        GlobalStorage, EventManager,

        Theme, ImageExport,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        subPanelTemplate,
        datagridTemplate,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Util</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        UtilMisc, utilDict, popupManager, TmplHelper) {
        <span class="hljs-string">"use strict"</span>;

        <span class="hljs-keyword">var</span> jWindow = $(<span class="hljs-built_in">window</span>),

            sidePanelWbTabs = $(<span class="hljs-string">"#panel-div &gt; .wb-tabs"</span>),
            sidePanelTabList = sidePanelWbTabs.find(<span class="hljs-string">" &gt; ul[role=tablist]"</span>),
            sidePanelTabPanels = sidePanelWbTabs.find(<span class="hljs-string">" &gt; .tabpanels"</span>),

            mapContent = $(<span class="hljs-string">"#mapContent"</span>),
            loadIndicator = mapContent.find(<span class="hljs-string">"#map-load-indicator"</span>),

            subPanels = {},
            subPanelLoadingAnimation,</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>subPanelAttribute definition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-comment">/**
        * A class holding properties of the SubPanel.
        *
        * @class SubPanelSettings
        * @for SubPanel
        */</span>
            subPanelAttr = {
                <span class="hljs-comment">/**
                * A name used to identify the subpanel being opened (e.g. "Details", "Metadata")
                *
                * @property panelName
                * @for SubPanelSettings
                * @type {String}
                * @default ""
                */</span>

                panelName: <span class="hljs-string">""</span>,
                <span class="hljs-comment">/**
                * Title of the content to be displayed on the SubPanel (e.g. "CESI Water Quality Indicators")
                *
                * @property title
                * @type {String}
                * @default ""
                */</span>

                title: <span class="hljs-string">""</span>,
                <span class="hljs-comment">/**
                * The text inside the subpanel. Can be String or a jQuery object. All nodes sporting CSS class
                * ".shorten-candidate" are treated to the shortening procedure - long strings are curtailed, and [more/less] links are placed at their ends.
                *
                * @property content
                * @type {String | jObject}
                * @default null
                */</span>

                content: <span class="hljs-literal">null</span>,

                templateKey: <span class="hljs-string">"summary_sub_panel_container"</span>,
                <span class="hljs-comment">/**
                * The node after which the panel will be inserted (e.g. node.find(".layer-details")).
                *
                * @property target
                * @type {jObject}
                * @default null
                */</span>

                target: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The name of the module that requested to open the SubPanel (e.g. "filterManager"). Used for identification of the panel's loyalty.
                *
                * @property origin
                * @type {String}
                * @default ""
                */</span>

                origin: <span class="hljs-string">""</span>,
                <span class="hljs-comment">/**
                * A unique id of the SubPanel. If none provided, a random one is generated. It is used to determine the animation and update function
                * to run on content update.
                *
                * @property guid
                * @type {String}
                * @default ""
                */</span>

                guid: <span class="hljs-string">""</span>,
                <span class="hljs-comment">/**
                * Indicates that the open SubPanel request is a content update to the already opened SubPanel.
                * Does not trigger any of the `doOn-` or `doAfter-` functions.
                *
                * __Use case:__ the uses clicks on the metadata button.
                * 1. A request to open a SubPanel is sent with only the title since the metadata content is not yet available
                * 2. Metadata is fetched from the server
                * 3. A second request to open a SubPanel is sent having `update` set to `true` and featuring the __same__ `guid` as the first request
                * 4. Only the content of the SubPanel is updated; no extra animations are triggered
                *
                * @property update
                * @type {Boolean}
                * @default false
                */</span>

                update: <span class="hljs-literal">false</span>,
                <span class="hljs-comment">/**
                * The callback function when the panel starts the opening animation; also triggered by updating panel content; can be triggered many times.
                *
                * @property doOnOpen
                * @type {Function}
                * @default null
                */</span>

                doOnOpen: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The callback function when the panel finishes the opening animation; also triggered by updating panel content; can be triggered many times.
                *
                * @property doAfterOpen
                * @type {Function}
                * @default null
                */</span>

                doAfterOpen: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The callback function when the panel starts the closing animation; also triggered by updating panel content; can be triggered many times.
                *
                * @property doOnHide
                * @type {Function}
                * @default null
                */</span>

                doOnHide: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The callback function when the panel becomes hidden; also triggered by updating panel content; can be triggered many times.
                *
                * @property doAfterHide
                * @type {Function}
                * @default null
                */</span>

                doAfterHide: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The callback function when the panel is completely closed, its nodes destroyed; can be triggered only once in a lifespan of the panel.
                *
                * @property doOnDestroy
                * @type {Function}
                * @default null
                */</span>

                doOnDestroy: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The callback function executed after the SubPanel content is updated.
                * __Doesn't work correctly yet.__
                *
                * @property doAfterUpdate
                * @type {Function}
                * @default null
                */</span>

                doAfterUpdate: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The target number of chars after which a content text node will be shortened.
                *
                * @property showChars
                * @type {Number}
                * @default 170
                */</span>

                showChars: <span class="hljs-number">170</span>
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Panel Prototype</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-comment">/**
        * [subPanelPrototype description]
        *
        * @class SubPanel
        * @constructor
        * @for GUI
        */</span>
            subPanelPrototype = {
                <span class="hljs-comment">/**
                * Indicates if the closing animation is under way.
                *
                * @property _closing
                * @private
                * @for SubPanel
                * @type {Boolean}
                * @default false
                */</span>

                _closing: <span class="hljs-literal">false</span>,
                <span class="hljs-comment">/**
                * Holds a deferred that would destroy the panel after the closing animation completes. May be interrupted.
                *
                * @property _destroyDeferred
                * @type {Deferred}
                * @private
                * @default null
                */</span>

                _destroyDeferred: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * SubPanel attributes
                *
                * @property _attr
                * @private
                * @default null
                * @type {SubPanelSettings}
                */</span>

                _attr: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * Indicates if the SubPanel is visible at the moment. Doesn't make the panel visible or invisible, just prevents animations on the content
                * to run when it is set to `true`.
                *
                * @property _visible
                * @private
                * @default false
                * @type {Boolean}
                */</span>

                _visible: <span class="hljs-literal">false</span>,
                <span class="hljs-comment">/**
                * The outermost `div` of the SubPanel.
                *
                * @property container
                * @default null
                * @type {jObject}
                */</span>

                container: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The inner `div` of the SubPanel. Closing and opening animations are run on this `div`.
                *
                * @property panel
                * @default null
                * @type {jQobject}
                */</span>

                panel: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * `div` housing the content of the SubPanel, including its title.
                *
                * @property _subPanelContentDiv
                * @private
                * @default null
                * @type {jObject}
                */</span>

                _subPanelContentDiv: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * Heading of the content in the SubPanel.
                *
                * @property _panelTitle
                * @private
                * @default null
                * @type {jObject}
                */</span>

                _panelTitle: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * `div` housing the content of the SubPanel, excluding its title.
                *
                * @property _panelContentDiv
                * @private
                * @default null
                * @type {jObject}
                */</span>

                _panelContentDiv: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * Default duration of the SubPanel animation in milliseconds.
                *
                * @property _animatePanelDuration
                * @private
                * @default 0.5
                * @type {Number}
                */</span>

                _animatePanelDuration: <span class="hljs-number">0.5</span>, <span class="hljs-comment">//0.4,</span>

                timeLine: <span class="hljs-literal">null</span>,

                <span class="hljs-comment">/**
                * Apply the shortening plugin to the panel data
                *
                * @method parseContent
                * @param  {jObject} data Content to be shortened
                * @return {jObject} Content with after shortening long text nodes
                */</span>
                parseContent: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>console.log(this._attr.showChars, jQuery.type(data), data);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">return</span> (jQuery.type(data) === <span class="hljs-string">"object"</span> ? data : $(data))
                        .find(<span class="hljs-string">".shorten-candidate"</span>).shorten({
                            showChars: <span class="hljs-keyword">this</span>._attr.showChars
                        })
                        .removeClass(<span class="hljs-string">"shorten-candidate"</span>).end();
                },
                <span class="hljs-comment">/**
                * Returns this SubPanel's settings object.
                *
                * @method getAttributes
                * @return {SubPanelSettings} This SubPanel's settings
                */</span>
                getAttributes: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._attr;
                },
                <span class="hljs-comment">/**
                * Returns this SubPanel's container `div`.
                *
                * @method getContainer
                * @return {jObject} This SubPanel's `div`
                */</span>
                getContainer: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.container;
                },
                <span class="hljs-comment">/**
                * Returns the inner `div` of the SubPanel
                *
                * @method getPanel
                * @return {jObject} The inner `div` of the SubPanel
                */</span>
                getPanel: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.panel;
                },
                <span class="hljs-comment">/**
                * Returns the `origin` of this SubPanel.
                *
                * @method getOrigin
                * @return {String} The `origin` of this SubPanel
                */</span>
                getOrigin: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._attr.origin;
                },
                <span class="hljs-comment">/**
                * Returns the `guid` of this SubPanel.
                *
                * @method getOrigin
                * @return {String} The `guid` of this SubPanel
                */</span>
                getGuid: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._attr.guid;
                },
                <span class="hljs-comment">/**
                * Destroys this SubPanel.
                *
                * @method destroy
                * @param  {Number} speed    The duration of the animation in milliseconds
                * @param  {Deferred} deferred The deferred to be resolved after the SubPanel is destroyed
                */</span>
                destroy: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">speed, deferred</span>) </span>{
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doOnHide) {
                        <span class="hljs-keyword">this</span>._attr.doOnHide();
                    }

                    <span class="hljs-keyword">this</span>._closing = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">this</span>._destroyDeferred = deferred;</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>remove CSS animation class to prevent flickering</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">this</span>._subPanelContentDiv.find(<span class="hljs-string">".fadeInDown"</span>).removeClass(<span class="hljs-string">"fadeInDown"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>sidePanel.getContainer().after(this.container);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    layoutController.getPanelContainer().before(<span class="hljs-keyword">this</span>.container);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>adjutSubPanelDimensions(this);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                    layoutController.subPanelChange(<span class="hljs-literal">false</span>, <span class="hljs-keyword">this</span>._attr.origin, <span class="hljs-keyword">this</span>.container, <span class="hljs-literal">false</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>do after closing animation completes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">this</span>.timeLine.eventCallback(<span class="hljs-string">"onReverseComplete"</span>,
                        <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doAfterHide) {
                                <span class="hljs-keyword">this</span>._attr.doAfterHide();
                            }
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doOnDestroy) {
                                <span class="hljs-keyword">this</span>._attr.doOnDestroy();
                            }
                            <span class="hljs-keyword">this</span>._visible = <span class="hljs-literal">false</span>;
                            layoutController.subPanelChange(<span class="hljs-literal">false</span>, <span class="hljs-keyword">this</span>._attr.origin, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);

                            <span class="hljs-keyword">this</span>.container.remove();

                            <span class="hljs-keyword">if</span> (deferred) {
                                deferred.resolve(<span class="hljs-literal">true</span>);
                            }
                        }, [], <span class="hljs-keyword">this</span>);

                    <span class="hljs-keyword">this</span>.timeLine.reverse();
                },

                <span class="hljs-comment">/**
                * Reopens the SubPanel - stops the closing animation and initiates the opening animation.
                *
                * @method reopen
                */</span>
                reopen: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>this.panel.stop();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">this</span>.timeLine.pause();
                    <span class="hljs-keyword">this</span>._closing = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._destroyDeferred) {
                        <span class="hljs-keyword">this</span>._destroyDeferred.cancel();
                        <span class="hljs-keyword">this</span>._destroyDeferred = <span class="hljs-literal">null</span>;
                    }

                    <span class="hljs-keyword">this</span>.open();
                },

                <span class="hljs-comment">/**
                * Opens the SubPanel. Sends out `EventManager.GUI.SUBPANEL_CHANGE` event.
                *
                * @method open
                */</span>
                open: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doOnOpen) {
                        <span class="hljs-keyword">this</span>._attr.doOnOpen();
                    }
                    <span class="hljs-keyword">this</span>._visible = <span class="hljs-literal">true</span>;
                    layoutController.subPanelChange(<span class="hljs-literal">true</span>, <span class="hljs-keyword">this</span>._attr.origin, <span class="hljs-keyword">this</span>.container, <span class="hljs-literal">false</span>);

                    <span class="hljs-keyword">this</span>.timeLine.play();
                },

                <span class="hljs-comment">/**
                * Assigns a new origin to the SubPanel.
                *
                * @method changeOrigin
                * @param  {String} newOrigin The new origin of the SubPanel.
                */</span>
                changeOrigin: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">newOrigin</span>) </span>{
                    <span class="hljs-keyword">this</span>._attr.origin = newOrigin;
                },

                <span class="hljs-comment">/**
                * Shifts the SubPanel to the new node in the DOM.
                *
                * @method shiftTarget
                * @param  {jObject} newTarget A node in the DOM to shift the SubPanel to
                */</span>
                shiftTarget: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">newTarget</span>) </span>{
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.target !== newTarget) {</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>remove animation class to prevent flickering of data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">this</span>._subPanelContentDiv.find(<span class="hljs-string">".fadeInDown"</span>).removeClass(<span class="hljs-string">"fadeInDown"</span>);
                        newTarget.after(<span class="hljs-keyword">this</span>.container);
                        <span class="hljs-keyword">this</span>._attr.target = newTarget;
                    }
                },

                <span class="hljs-comment">/**
                * Creates a new instance of SubPanel.
                *
                * @method create
                * @param  {SubPanelSettings} a Settings for the SubPanel
                */</span>
                create: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a</span>) </span>{
                    <span class="hljs-keyword">var</span> <span class="hljs-comment">//subPanelContent,</span>
                        subPanelString,
                        parsedContent;

                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"create panel, "</span>, a.origin);

                    a.guid = a.guid || UtilMisc.guid();

                    dojoLang.mixin(<span class="hljs-keyword">this</span>._attr, a);

                    subPanelString = TmplHelper.template(<span class="hljs-keyword">this</span>._attr.templateKey,
                        dojoLang.mixin(
                            <span class="hljs-keyword">this</span>._attr,
                            {
                                closeTitle: i18n.t(<span class="hljs-string">'gui.actions.close'</span>)
                            }
                        ),
                        subPanelTemplate);

                    <span class="hljs-keyword">this</span>.container = $(subPanelString).insertAfter(<span class="hljs-keyword">this</span>._attr.target);
                    <span class="hljs-keyword">this</span>.panel = <span class="hljs-keyword">this</span>.container.find(<span class="hljs-string">".sub-panel"</span>);

                    <span class="hljs-keyword">this</span>._subPanelContentDiv = <span class="hljs-keyword">this</span>.panel.find(<span class="hljs-string">".sub-panel-content"</span>);
                    <span class="hljs-keyword">this</span>._panelTitle = <span class="hljs-keyword">this</span>.panel.find(<span class="hljs-string">".panel-title"</span>);
                    <span class="hljs-keyword">this</span>._panelContentDiv = <span class="hljs-keyword">this</span>.panel.find(<span class="hljs-string">".panel-content-div"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>set panel content</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    parsedContent = <span class="hljs-keyword">this</span>.parseContent(<span class="hljs-keyword">this</span>._attr.content);
                    <span class="hljs-keyword">this</span>._panelContentDiv.empty().append(parsedContent);

                    <span class="hljs-keyword">this</span>.timeLine = <span class="hljs-keyword">new</span> TimelineLite(
                        {
                            paused: <span class="hljs-literal">true</span>,
                            onComplete: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doAfterOpen) {
                                    <span class="hljs-keyword">this</span>._attr.doAfterOpen();
                                }

                                layoutController.subPanelChange(<span class="hljs-literal">true</span>, <span class="hljs-keyword">this</span>._attr.origin, <span class="hljs-keyword">this</span>.container, <span class="hljs-literal">true</span>);
                            },
                            onCompleteScope: <span class="hljs-keyword">this</span>
                        })
                        .to(<span class="hljs-keyword">this</span>.panel, <span class="hljs-keyword">this</span>._animatePanelDuration, { left: <span class="hljs-number">0</span>, ease: <span class="hljs-string">"easeOutCirc"</span> })
                        .to(loadIndicator, <span class="hljs-keyword">this</span>._animatePanelDuration, { right: <span class="hljs-keyword">this</span>.panel.width() + <span class="hljs-number">6</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>); <span class="hljs-comment">// 6 is double border width</span>

                    Theme.tooltipster(<span class="hljs-keyword">this</span>.container);

                    <span class="hljs-keyword">this</span>.update(<span class="hljs-keyword">this</span>._attr);
                },

                <span class="hljs-comment">/**
                * Performs an update of the content and title of the SubPanel, running appropriate animation and `doOn-` / `doAfter-` functions.
                *
                * @method update
                * @param  {SubPanelSettings} a New settings for the SubPanel
                */</span>
                update: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>helper functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> animateContentDuration = <span class="hljs-number">300</span>,
                        that = <span class="hljs-keyword">this</span>,

                        updateDefered = [<span class="hljs-keyword">new</span> Deferred(), <span class="hljs-keyword">new</span> Deferred()],

                        animateContent = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node, newData, d</span>) </span>{
                            <span class="hljs-keyword">if</span> (newData) {
                                node.addClass(<span class="hljs-string">'animated fadeOutDown'</span>);
                                <span class="hljs-built_in">window</span>.setTimeout(
                                        <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                                            node</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>.html(newData)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                            .empty().append(newData)
                                                .removeClass(<span class="hljs-string">"fadeOutDown"</span>)
                                                .addClass(<span class="hljs-string">'animated fadeInDown'</span>); <span class="hljs-comment">//.find(".shorten-candidate").shorten();</span>

                                            d.resolve();
                                        },
                                    animateContentDuration);
                            }
                        },

                        setContent = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node, oldData, newData, parsedData, visible, d</span>) </span>{
                            newData = (newData === <span class="hljs-literal">null</span>) ? parsedData = subPanelLoadingAnimation : newData;
                            <span class="hljs-keyword">if</span> (newData) {
                                <span class="hljs-keyword">if</span> (newData !== oldData) {
                                    <span class="hljs-keyword">if</span> (visible) {</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>ideally, need to wait until the animation completes before proceeding?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                        animateContent(node, parsedData, d);
                                    } <span class="hljs-keyword">else</span> {
                                        node.empty().append(parsedData);
                                        d.resolve();
                                    }
                                } <span class="hljs-keyword">else</span> {
                                    d.resolve();
                                }
                            } <span class="hljs-keyword">else</span> {
                                d.resolve();
                            }
                        },

                        updateContent = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>if the content in the subpanel is scrolled down, scroll back to the top</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                TweenLite.to(that._subPanelContentDiv, animateContentDuration / <span class="hljs-number">1000</span>,
                                    { scrollTop: <span class="hljs-number">0</span>, ease: <span class="hljs-string">"easeOutCirc"</span> });

                                setContent(that._panelTitle, that._attr.title, a.title, a.title, that._visible, updateDefered[<span class="hljs-number">0</span>]);
                                setContent(that._panelContentDiv, that._attr.content, a.content, that.parseContent(a.content), that._visible, updateDefered[<span class="hljs-number">1</span>]);

                                dojoLang.mixin(that._attr, a);
                            };</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>doAfterUpdate should be called AFTER update (animation) completesâ¦</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    UtilMisc.afterAll(updateDefered, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">if</span> (a.doAfterUpdate) {
                            a.doAfterUpdate();
                        }
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>panel is closing; new data is not an update</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._closing &amp;&amp; !a.update) {</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.guid !== a.guid) {
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doOnHide) {
                                <span class="hljs-keyword">this</span>._attr.doOnHide();
                            }
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doAfterHide) {
                                <span class="hljs-keyword">this</span>._attr.doAfterHide();
                            }</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>move panel to the new target</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            a.target.after(<span class="hljs-keyword">this</span>.container);
                            updateContent(a);
                        }

                        <span class="hljs-keyword">this</span>.reopen();</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>panel is not closing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._closing) {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>data is not an update</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (!a.update &amp;&amp; <span class="hljs-keyword">this</span>._attr.guid !== a.guid) {
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doOnHide) {
                                <span class="hljs-keyword">this</span>._attr.doOnHide();
                            }
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doAfterHide) {
                                <span class="hljs-keyword">this</span>._attr.doAfterHide();
                            }</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>move panel to the new target</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            a.target.after(<span class="hljs-keyword">this</span>.container);
                            updateContent(a);

                            <span class="hljs-keyword">if</span> (a.doOnOpen) {
                                a.doOnOpen();
                            }
                            <span class="hljs-keyword">if</span> (a.doAfterOpen) {
                                a.doAfterOpen();
                            }
                        }</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>guid is the same - data can update or not (should be an update)
if (a.update &amp;&amp; attr.guid === a.guid) {</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.guid === a.guid) {
                            updateContent(a);
                        }
                    }
                }
            },

            helpToggle = $(<span class="hljs-string">"#helpToggle"</span>),
            helpSectionContainer = $(<span class="hljs-string">"#help-section-container"</span>),
            helpSection = $(<span class="hljs-string">"#help-section"</span>),

            cssButtonPressedClass = <span class="hljs-string">"button-pressed"</span>,
            cssExpandedClass = <span class="hljs-string">"state-expanded"</span>,

            helpPanelPopup,
            
            transitionDuration = <span class="hljs-number">0.5</span>,

            toolbarController,
            layoutController;

        toolbarController = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> mapToolbar,
                mapTools,

                toolbarWidth,
                toolsWidth,

                toolsTimeline = <span class="hljs-keyword">new</span> TimelineLite(),

                isTooltipsSet = <span class="hljs-literal">false</span>;

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateToolbarStats</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (!layoutController.isFullData()) {
                    toolbarWidth = mapToolbar.width();

                    <span class="hljs-keyword">if</span> (!isTooltipsSet) {
                        toolsWidth = mapTools
                            .map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">i, n</span>) </span>{ <span class="hljs-keyword">return</span> $(n).outerWidth(); })
                            .get() <span class="hljs-comment">// need to use get() as jquery.map doesn't return a true array</span>
                            .reduce(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">total, width</span>) </span>{ <span class="hljs-keyword">return</span> total + width; })
                        ;
                    }

                    <span class="hljs-keyword">if</span> (!isToolbarWideEnough()) {
                        setToolbarTooltips();
                    } <span class="hljs-keyword">else</span> {
                        removeToolbarTooltips();
                    }
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isToolbarWideEnough</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> toolbarWidth &gt; toolsWidth;
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setToolbarTooltips</span>(<span class="hljs-params"></span>) </span>{
                toolsTimeline.invalidate();

                <span class="hljs-keyword">if</span> (!isTooltipsSet) {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>set tooltips on the collapsed toolbar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    mapToolbar.addClass(<span class="hljs-string">"compact"</span>);

                    mapTools
                        .filter(<span class="hljs-string">":not(.tooltipstered)"</span>)
                        .map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">i, node</span>) </span>{
                            node = $(node);
                            node
                                .addClass(<span class="hljs-string">"_tooltip tooltip-temp"</span>)
                                .attr(
                                    <span class="hljs-string">"title"</span>,
                                    node.find(<span class="hljs-string">"span"</span>).text()
                                );
                        });

                    Theme.tooltipster(mapToolbar);

                    isTooltipsSet = <span class="hljs-literal">true</span>;
                }

            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeToolbarTooltips</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (isTooltipsSet &amp;&amp; isToolbarWideEnough()) {</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>remove tooltips from the restored toolbar and only from the buttons with a temporary tooltip</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    Theme.tooltipster(
                        mapTools
                            .filter(<span class="hljs-string">".tooltip-temp"</span>)
                            .parent(),
                        <span class="hljs-literal">null</span>, <span class="hljs-string">"destroy"</span>);

                    mapToolbar
                        .removeClass(<span class="hljs-string">"compact"</span>);
                    mapTools
                        .filter(<span class="hljs-string">".tooltip-temp"</span>)
                        .removeClass(<span class="hljs-string">"_tooltip"</span>)
                        .removeAttr(<span class="hljs-string">"title"</span>);

                    isTooltipsSet = <span class="hljs-literal">false</span>;
                }
            }

            <span class="hljs-keyword">return</span> {
                init: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    mapToolbar = $(<span class="hljs-string">"#map-toolbar"</span>);
                    mapTools = mapToolbar.find(<span class="hljs-string">"&gt; .map-toolbar-item &gt; .map-toolbar-item-button"</span>);

                    updateToolbarStats();

                    jWindow.on(<span class="hljs-string">"resize"</span>, updateToolbarStats);

                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
                },

                mapTools: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> mapTools;
                },

                toolsTimeline: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> toolsTimeline;
                },

                update: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    updateToolbarStats();

                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
                },

                setTooltips: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    setToolbarTooltips();

                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
                },

                removeTooltips: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    removeToolbarTooltips();

                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
                }

            };

        }());

        <span class="hljs-comment">/**
        * Controls layout transition such as full-data and full-screen modes, opening and closing of the side panel, adjusts layout when resizing the browser window.
        *
        * @class LayoutController
        * @static
        * @for GUI
        */</span>
        layoutController = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> viewport = $(<span class="hljs-string">".viewport"</span>),
                mapDiv = $(<span class="hljs-string">"#map-div"</span>),
                mapContent = $(<span class="hljs-string">"#mapContent"</span>),
                fullScreenToggle = $(<span class="hljs-string">"#fullScreenToggle"</span>),
                fullScreenPopup,

                mapToolbar = $(<span class="hljs-string">"#map-toolbar"</span>),
                basemapControls = $(<span class="hljs-string">"#basemapControls"</span>),

                panelDiv = $(<span class="hljs-string">"#panel-div"</span>),
                panelToggle = $(<span class="hljs-string">"#panel-toggle"</span>),
                panelPopup,
                panelWidthDefault, <span class="hljs-comment">// default width of the SidePanel.</span>
                layoutWidthThreshold = <span class="hljs-number">1200</span>, <span class="hljs-comment">// minimum width of the wide layout</span>

                dataTabNode,
                dataTabUpdateNotice,

                windowWidth,

                layoutChange,

                _isFullData = <span class="hljs-literal">false</span>,
                fullDataTimeLine = <span class="hljs-keyword">new</span> TimelineLite({
                    paused: <span class="hljs-literal">true</span>,
                    onComplete: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        adjustHeight();
                        layoutChange();

                        toolbarController.setTooltips();</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>console.log(âfinishedâ, EventManager.Datagrid.APPLY_EXTENT_FILTER);
topic.publish(EventManager.Datagrid.APPLY_EXTENT_FILTER);</p>

            </div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>kill key events to stop tab switching when the other tab is hidden</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        panelDiv.on(<span class="hljs-string">"keydown"</span>, <span class="hljs-string">".wb-tabs &gt; ul &gt; li &gt; a"</span>, stopEventPropagation);
                    },
                    onReverseComplete: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        viewport.removeClass(<span class="hljs-string">"full-data-mode"</span>);

                        adjustHeight();
                        layoutChange();

                        toolbarController
                            .update()
                            .removeTooltips();</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>console.log(âreverse finishedâ, EventManager.Datagrid.APPLY_EXTENT_FILTER);
topic.publish(EventManager.Datagrid.APPLY_EXTENT_FILTER);
restore key events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        panelDiv.off(<span class="hljs-string">"keydown"</span>, <span class="hljs-string">".wb-tabs &gt; ul &gt; li &gt; a"</span>, stopEventPropagation);
                    }
                }),
                panelToggleTimeLine = <span class="hljs-keyword">new</span> TimelineLite({ paused: <span class="hljs-literal">true</span> }),
                fullDataSubpanelChangeTimeLine = <span class="hljs-keyword">new</span> TimelineLite({ paused: <span class="hljs-literal">true</span> }),
                noDataTimeLine = <span class="hljs-keyword">new</span> TimelineLite({
                    paused: <span class="hljs-literal">true</span>,
                    onComplete: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>kill key events to stop tab switching when the other tab is hidden</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        panelDiv.on(<span class="hljs-string">"keydown"</span>, <span class="hljs-string">".wb-tabs &gt; ul &gt; li &gt; a"</span>, stopEventPropagation);
                    },
                    onReverseComplete: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>restore key events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        panelDiv.off(<span class="hljs-string">"keydown"</span>, <span class="hljs-string">".wb-tabs &gt; ul &gt; li &gt; a"</span>, stopEventPropagation);
                    }
                }),</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>timeline generating functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                createFullDataTL,
                createPanelToggleTL,
                createFullDataSubpanelChangeTL,

                timeLines;

            createFullDataTL = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (panelDiv.find(<span class="hljs-string">".wb-tabs &gt; ul li"</span>).length === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">return</span>;
                }

                fullDataTimeLine
                    .fromTo(mapDiv, transitionDuration, { width: <span class="hljs-string">"auto"</span> }, { width: <span class="hljs-number">35</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)

                    .fromTo(mapContent, transitionDuration, { opacity: <span class="hljs-number">1</span> }, { opacity: <span class="hljs-number">0</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)
                    .set(mapContent, { top: <span class="hljs-string">"500px"</span> })

                    .to(panelToggle, transitionDuration, { right: -<span class="hljs-number">13</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)
                    .set(panelToggle, { display: <span class="hljs-string">"none"</span> })

                    .to(basemapControls, transitionDuration / <span class="hljs-number">2</span>, { opacity: <span class="hljs-number">0</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)
                    .to(basemapControls, <span class="hljs-number">0</span>, { display: <span class="hljs-string">"none"</span> }, transitionDuration / <span class="hljs-number">2</span>)
                    .fromTo(mapToolbar, transitionDuration / <span class="hljs-number">2</span>,
                        { width: <span class="hljs-string">"100%"</span>, height: <span class="hljs-string">"32px"</span> },
                        { width: <span class="hljs-string">"32px"</span>, height: $(<span class="hljs-string">"#map-div"</span>).height(), ease: <span class="hljs-string">"easeOutCirc"</span> }, transitionDuration / <span class="hljs-number">2</span>)

                    .add(toolbarController.toolsTimeline(), <span class="hljs-number">0</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>.fromTo(toolbarController.mapTools().find(â&gt; spanâ), transitionDuration / 2, { width: âautoâ }, { width: 0, ease: âeaseOutCircâ }, 0)
.fromTo(toolbarController.mapTools().find(â&gt; spanâ), 0, { display: âinline-blockâ }, { display: ânoneâ }, transitionDuration / 2)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                    .fromTo(panelDiv.find(<span class="hljs-string">".wb-tabs &gt; ul li:first"</span>), transitionDuration, { width: <span class="hljs-string">"50%"</span> }, { width: <span class="hljs-string">"0%"</span>, display: <span class="hljs-string">"none"</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)
                    .fromTo(panelDiv.find(<span class="hljs-string">".wb-tabs &gt; ul li:last"</span>), transitionDuration, { width: <span class="hljs-string">"50%"</span> }, { width: <span class="hljs-string">"100%"</span>, className: <span class="hljs-string">"+=h5"</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)

                    .fromTo(panelDiv, transitionDuration,
                        { width: panelWidthDefault, left: <span class="hljs-string">"auto"</span> },
                        { left: <span class="hljs-number">35</span>, width: <span class="hljs-string">"auto"</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>);
            };

            createPanelToggleTL = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                panelToggleTimeLine
                    .fromTo(panelDiv, transitionDuration, { right: <span class="hljs-number">0</span> }, { right: -panelWidthDefault, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)
                    .set(panelDiv, { display: <span class="hljs-string">"none"</span> }, transitionDuration)

                    .fromTo(mapDiv, transitionDuration, { right: panelWidthDefault }, { right: <span class="hljs-number">0</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>);
            };

            createFullDataSubpanelChangeTL = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                fullDataSubpanelChangeTimeLine
                    .fromTo(panelDiv, transitionDuration,
                        { right: <span class="hljs-number">0</span> },
                        { right: panelWidthDefault, ease: <span class="hljs-string">"easeOutCirc"</span> });
            };

            timeLines = [
                {
                    timeLine: fullDataTimeLine,
                    generator: createFullDataTL
                },
                {
                    timeLine: panelToggleTimeLine,
                    generator: createPanelToggleTL
                },
                {
                    timeLine: fullDataSubpanelChangeTimeLine,
                    generator: createFullDataSubpanelChangeTL
                }
            ];

            <span class="hljs-comment">/**
            * Fires an event when the layout of the page changes.
            *
            * @method layoutChange
            * @private
            * @for LayoutController
            */</span>
            layoutChange = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (!_isFullData) {
                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"GUI --&gt; EventManager.GUI.LAYOUT_CHANGE"</span>);
                    topic.publish(EventManager.GUI.LAYOUT_CHANGE);
                }
            };

            <span class="hljs-comment">/**
            * Adjusts the height of the help section based on the height of the window.
            *
            * @method adjustHeight
            * @private
            */</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">adjustHeight</span>(<span class="hljs-params"></span>) </span>{
                helpSection.css({
                    <span class="hljs-string">"max-height"</span>: jWindow.height() - (_isFullData ? jWindow.height() * <span class="hljs-number">0.2</span> : mapToolbar.offset().top) - <span class="hljs-number">90</span> <span class="hljs-comment">// 90 is an arbitrary-wide gap between the help panel and the upper toolbar</span>
                });
            }

            <span class="hljs-comment">/**
            * Executed after full-screen mode transition is complete.
            *
            * @method onFullScreenComplete
            * @private
            */</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onFullScreenComplete</span>(<span class="hljs-params"></span>) </span>{
                adjustHeight();
                layoutChange();

                topic.publish(EventManager.GUI.FULLSCREEN_CHANGE, {
                    visible: Theme.isFullScreen()
                });
            }

            <span class="hljs-comment">/**
            * Publishes `PANEL_CHANGE` event when the visibility of the SidePanel changes.
            *
            * @method panelChange
            * @param  {Boolean} visible Indicates whether the SidePanel is visible or not
            * @private
            */</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">panelChange</span>(<span class="hljs-params">visible</span>) </span>{
                topic.publish(EventManager.GUI.PANEL_CHANGE, {
                    visible: visible
                });
            }

            <span class="hljs-comment">/**
            * Slides the SidePanel open.
            *
            * @method openPanel
            * @private
            * @param  {Deferred} d A deferred to be resolved upon completion of the animation
            */</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openPanel</span>(<span class="hljs-params">d</span>) </span>{
                <span class="hljs-comment">/*jshint validthis: true */</span>
                panelToggleTimeLine.eventCallback(<span class="hljs-string">"onReverseComplete"</span>,
                        <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                            layoutChange();
                            panelChange(<span class="hljs-literal">true</span>);

                            toolbarController.update();</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>update close button tooltips</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            panelToggle
                                .tooltipster(<span class="hljs-string">"content"</span>, i18n.t(<span class="hljs-string">"gui.actions.close"</span>))
                                .find(<span class="hljs-string">"span.wb-invisible"</span>).text(i18n.t(<span class="hljs-string">"gui.actions.close"</span>));

                            d.resolve();
                        }, [], <span class="hljs-keyword">this</span>);

                viewport.removeClass(<span class="hljs-string">"no-sidepanel-mode"</span>);
                panelToggleTimeLine.reverse();
            }

            <span class="hljs-comment">/**
            * Slide the SidePanel close
            *
            * @method closePanel
            * @private
            * @param  {Deferred} d A deferred to be resolved upon completion of the animation
            */</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closePanel</span>(<span class="hljs-params">d</span>) </span>{
                <span class="hljs-comment">/*jshint validthis: true */</span>
                panelToggleTimeLine.eventCallback(<span class="hljs-string">"onComplete"</span>,
                        <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"GUI &lt;-- map/update-end from gui"</span>);
                            layoutChange();
                            panelChange(<span class="hljs-literal">false</span>);

                            toolbarController.update();</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>update open button tooltips</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            panelToggle
                                .tooltipster(<span class="hljs-string">"content"</span>, i18n.t(<span class="hljs-string">"gui.actions.open"</span>))
                                .find(<span class="hljs-string">"span.wb-invisible"</span>).text(i18n.t(<span class="hljs-string">"gui.actions.open"</span>));

                            viewport.addClass(<span class="hljs-string">"no-sidepanel-mode"</span>);

                            d.resolve();
                        }, [], <span class="hljs-keyword">this</span>);

                panelToggleTimeLine.play();
            }

            <span class="hljs-comment">/**
            * Toggles the full-data mode on and off.
            *
            * @method _toggleFullDataMode
            * @param {Boolean} [fullData] if true, switches to full-data mode; if false, switches to summary mode; if undefined, toggle mode based on the current state
            * @private
            */</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_toggleFullDataMode</span>(<span class="hljs-params">fullData</span>) </span>{
                _isFullData = <span class="hljs-keyword">typeof</span> fullData === <span class="hljs-string">'boolean'</span> ? fullData : !_isFullData;</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>if the timeline duration is 0, reset it
itâs to work-around IE bug where itâs so slow, it canât pick up nodes created by WET scripts when creating timelines</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (fullDataTimeLine.totalDuration() === <span class="hljs-number">0</span>) {
                    UtilMisc.resetTimelines([timeLines[<span class="hljs-number">0</span>]]);
                }

                <span class="hljs-keyword">if</span> (_isFullData) {
                    viewport.addClass(<span class="hljs-string">"full-data-mode"</span>); <span class="hljs-comment">// set full-data-mode css class BEFORE animation; remove it after it finishes - on onReverseComplete callback</span>
                    fullDataTimeLine.play();
                } <span class="hljs-keyword">else</span> {
                    fullDataSubpanelChangeTimeLine.reverse(); <span class="hljs-comment">// play this animation to readjust the sidepanel if the details panel was opened and not closed in full data mode</span>
                    fullDataTimeLine.reverse();
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>close subpanels</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                utilDict.forEachEntry(subPanels, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{
                    hideSubPanel({
                        origin: key
                    });
                });
            }

            <span class="hljs-comment">/**
            * Changes internal panel width reference based on the window width.
            *
            * @method updatePanelWidth
            * @private
            */</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updatePanelWidth</span>(<span class="hljs-params"></span>) </span>{
                panelWidthDefault = windowWidth &lt; layoutWidthThreshold ? <span class="hljs-number">340</span> : <span class="hljs-number">430</span>;
            }

            <span class="hljs-comment">/**
            * Optimizes layout based on the window width
            *
            * @method optimizeLayout
            * @private
            */</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">optimizeLayout</span>(<span class="hljs-params"></span>) </span>{

                <span class="hljs-keyword">if</span> ((windowWidth &lt; layoutWidthThreshold &amp;&amp; jWindow.width() &gt; layoutWidthThreshold) ||
                    (windowWidth &gt; layoutWidthThreshold &amp;&amp; jWindow.width() &lt; layoutWidthThreshold)) {
                    windowWidth = jWindow.width();
                    updatePanelWidth();

                    UtilMisc.resetTimelines(timeLines, <span class="hljs-literal">true</span>);
                }
            }

            <span class="hljs-comment">/**
             * Setup noDataTimeLine for data tab animation
             * 
             * @method setupNoDataTimeLine
             * @private
             */</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setupNoDataTimeLine</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>timeline that hides Data tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                noDataTimeLine
                    .fromTo(panelDiv.find(<span class="hljs-string">".wb-tabs &gt; ul li:first"</span>), transitionDuration, { width: <span class="hljs-string">"50%"</span> }, { width: <span class="hljs-string">"100%"</span>, className: <span class="hljs-string">"+=h5"</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)
                    .to(panelDiv.find(<span class="hljs-string">".wb-tabs &gt; ul li:first"</span>), transitionDuration, { lineHeight: <span class="hljs-string">'20px'</span> }, <span class="hljs-number">0</span>)
                    .fromTo(panelDiv.find(<span class="hljs-string">".wb-tabs &gt; ul li:last"</span>), transitionDuration, { width: <span class="hljs-string">"50%"</span> }, { width: <span class="hljs-string">"0%"</span>, display: <span class="hljs-string">"none"</span>, ease: <span class="hljs-string">"easeOutCirc"</span> }, <span class="hljs-number">0</span>)
                ;
            }

            <span class="hljs-keyword">return</span> {
                <span class="hljs-comment">/**
                * Initializes layout controller.
                *
                * @method init
                */</span>
                init: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    windowWidth = jWindow.width();
                    jWindow.on(<span class="hljs-string">"resize"</span>, optimizeLayout);
                    updatePanelWidth();

                    toolbarController.init();

                    UtilMisc.resetTimelines(timeLines);

                    Theme
                        .fullScreenCallback(<span class="hljs-string">"onComplete"</span>, onFullScreenComplete)
                        .fullScreenCallback(<span class="hljs-string">"onReverseComplete"</span>, onFullScreenComplete);</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>initialize the panel popup</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    panelPopup = popupManager.registerPopup(panelToggle, <span class="hljs-string">"click"</span>,
                        openPanel, {
                            activeClass: cssExpandedClass,
                            closeHandler: closePanel
                        }
                    );</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>set listener to the panel toggle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    topic.subscribe(EventManager.GUI.PANEL_TOGGLE, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
                        panelPopup.toggle(<span class="hljs-literal">null</span>, event.visible);
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>set listener to the full-screen toggle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    fullScreenPopup = popupManager.registerPopup(fullScreenToggle, <span class="hljs-string">"click"</span>,
                        <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{
                            Theme.toggleFullScreenMode();
                            d.resolve();
                        }, {
                            activeClass: <span class="hljs-string">"button-pressed"</span>,
                            setClassBefore: <span class="hljs-literal">true</span>
                        }
                    );</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>if the vertical space is too small, trigger the full-screen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (mapContent.height() &lt; jWindow.height() * <span class="hljs-number">0.6</span>) {
                        fullScreenPopup.open();
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>find a Data tab append an update notice to it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    dataTabUpdateNotice = $(TmplHelper.template(<span class="hljs-string">'datagrid_notice_update'</span>, {}, datagridTemplate));
                    dataTabNode = panelDiv.find(<span class="hljs-string">".wb-tabs &gt; ul li:last"</span>);
                    dataTabNode.append(dataTabUpdateNotice);

                    topic.subscribe(EventManager.Datagrid.UPDATING, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
                        dataTabUpdateNotice.toggle(event);
                    });

                    adjustHeight();</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>setup noDataTimeLine here to allow IE9 to have enough time to 
create the tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    setupNoDataTimeLine();
                },

                <span class="hljs-comment">/**
                * Toggles the FullScreen mode of the application
                *
                * @method toggleFullScreenMode
                * @param  {Boolean} fullscreen true - expand; false - collapse; undefined - toggle;
                */</span>
                toggleFullScreenMode: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fullscreen</span>) </span>{
                    fullScreenPopup.toggle(<span class="hljs-literal">null</span>, fullscreen);
                },

                <span class="hljs-comment">/**
                 * Toggles the visibility of Data tab in the side panel
                 * 
                 * @method toggleDataTab
                 * @param  {Boolean} open true - show; false - hide;
                 */</span>
                toggleDataTab: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">open</span>) </span>{
                    <span class="hljs-keyword">if</span> (open) {
                        noDataTimeLine.reverse();
                    } <span class="hljs-keyword">else</span> {
                        noDataTimeLine.play();
                    }
                },

                <span class="hljs-comment">/**
                * Returns the state of the full-data mode.
                *
                * @method isFullData
                * @return {Boolean} True is full-data mode on; false otherwise
                */</span>
                isFullData: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> _isFullData;
                },

                <span class="hljs-comment">/**
                * Toggles the full-data mode on and off.
                *
                * @method toggleFullDataMode
                * @param {Boolean} [fullData] if true, switches to full-data mode; if false, switches to summary mode; if undefined, toggle mode based on the current state
                */</span>
                toggleFullDataMode: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fullData</span>) </span>{
                    _toggleFullDataMode(fullData);
                },

                <span class="hljs-comment">/**
                * Fires an event when the subpanel closes or opens.
                *
                * @method subPanelChange
                * @param {Boolean} visible indicates whether the subpanel is visible or not (the panel is considered invisible when it's being destroyed, starts closing)
                * @param {String} origin origin of the subpanel
                * @param {JObject} container subpanel container
                * @param {Boolean} isComplete indicates if subPanel transition has completed or just started
                */</span>
                subPanelChange: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">visible, origin, container, isComplete</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>check if the fullData transition is already underway</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (!fullDataTimeLine.isActive() &amp;&amp; _isFullData &amp;&amp; !isComplete) {</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>adjust the sidePanel position shifting the right edge to the left, making space for the subpanel to open at</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (visible) {
                            fullDataSubpanelChangeTimeLine.play();
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!visible) {
                            fullDataSubpanelChangeTimeLine.reverse();
                        }
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>hide the sidepanel toggle when a subpanel is opened to prevent the user from closing sidepanel with subpanel still opened</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (!isComplete) {
                        <span class="hljs-keyword">if</span> (visible) {
                            panelToggle.hide();
                        } <span class="hljs-keyword">else</span> {
                            panelToggle.show();
                        }
                    }

                    topic.publish(EventManager.GUI.SUBPANEL_CHANGE, {
                        visible: visible,
                        origin: origin,
                        container: container,
                        offsetLeft: (container) ? container.width() + <span class="hljs-number">25</span> + layoutController.getPanelWidth() : layoutController.getPanelWidth(),
                        isComplete: isComplete
                    });
                },

                <span class="hljs-comment">/**
                * Returns the outer most `div` of this SidePanel.
                *
                * @method getContainer
                * @return {jObject} The outer most `div` of this SidePanel
                */</span>
                getPanelContainer: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> panelDiv;
                },

                <span class="hljs-comment">/**
                * Gets the width of this SidePanel.
                *
                * @method width
                * @return {Number} The width of this SidePanel
                * @for LayoutController
                */</span>
                getPanelWidth: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> panelDiv.filter(<span class="hljs-string">":visible"</span>).width();
                }
            };
        }());

        <span class="hljs-comment">/**
        * Create a new SubPanel with the settings provided.
        *
        * @private
        * @method newSubPanel
        * @param  {SubPanelSettings} attr SubPanel settings
        * @return {SubPanel}      A newly created SubPanel
        * @for GUI
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newSubPanel</span>(<span class="hljs-params">attr</span>) </span>{
            <span class="hljs-keyword">var</span> subPanel = <span class="hljs-built_in">Object</span>.create(subPanelPrototype);
            subPanel._attr = <span class="hljs-built_in">Object</span>.create(subPanelAttr);
            subPanel.create(attr);</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>adjutSubPanelDimensions(subPanel);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">return</span> subPanel;
        }

        <span class="hljs-comment">/**
        * Creates and opens a new SubPanel with given settings.
        * If the SubPanel with the requested `origin` is already present, updates its content.
        *
        * @method showSubPanel
        * @private
        * @param  {SubPanelSettings} attr Settings for the SubPanel instance
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showSubPanel</span>(<span class="hljs-params">attr</span>) </span>{
            <span class="hljs-keyword">var</span> deferred = <span class="hljs-keyword">new</span> Deferred(),
                subPanel;

            deferred.then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                attr = subPanel.getAttributes();
                subPanel = subPanels[attr.origin];

                subPanel.open();
                subPanel.getPanel().find(<span class="hljs-string">".sub-panel-toggle"</span>)
                    .on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        hideSubPanel(attr);</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>reset focus back to link where the subpanel was created from</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (attr.target.selector !== <span class="hljs-string">"#map-div"</span>) {
                            $(attr.target).find(<span class="hljs-string">":tabbable"</span>).first().focus();
                        }
                    });
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>take over the panel spawned by other components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (attr.consumeOrigin &amp;&amp; subPanels[attr.consumeOrigin]) {
                subPanel = subPanels[attr.consumeOrigin];
                subPanel.changeOrigin(attr.origin);
                subPanel.shiftTarget(attr.target);

                <span class="hljs-keyword">delete</span> subPanels[attr.consumeOrigin];
                subPanels[attr.origin] = subPanel;
            }

            <span class="hljs-keyword">if</span> (subPanels[attr.origin]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>if the panel exists, just update it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                subPanels[attr.origin].update(attr);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!attr.update) {</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>create if doesnât</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                subPanel = newSubPanel(attr);
                subPanels[attr.origin] = subPanel;</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>close all other panels; and open the newly created one after all others are closed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                UtilMisc.executeOnDone(subPanels,
                    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">p, d</span>) </span>{
                        <span class="hljs-keyword">if</span> (p &amp;&amp; p.getOrigin() !== attr.origin) {
                            hideSubPanel({
                                origin: p.getOrigin()
                            }, <span class="hljs-number">200</span>, d);
                        } <span class="hljs-keyword">else</span> {
                            d.resolve(<span class="hljs-literal">true</span>);
                        }
                    },
                    deferred);
            }
        }

        <span class="hljs-comment">/**
        * Closes the SubPanel whose `origin` is specified in the `attr` parameter.
        *
        * @method hideSubPanel
        * @private
        * @param  {SubPanelSettings} attr  only `origin` attribute is required here
        * @param  {Number} speed Duration of the closing animation
        * @param  {Deferred} d     The deferred object to be resolved upon successful closing of the panel
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hideSubPanel</span>(<span class="hljs-params">attr, speed, d</span>) </span>{
            <span class="hljs-keyword">var</span> deferred = <span class="hljs-keyword">new</span> Deferred(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (d) {
                    d.cancel();
                }
            });

            deferred.then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>remove the panel from the object after it closes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">delete</span> subPanels[attr.origin]; <span class="hljs-comment">// more on delete: http://perfectionkills.com/understanding-delete/</span>
                <span class="hljs-keyword">if</span> (d) {
                    d.resolve(<span class="hljs-literal">true</span>);
                }
            });

            <span class="hljs-keyword">if</span> (subPanels[attr.origin]) {
                subPanels[attr.origin].destroy(speed, deferred);
            }
        }

        <span class="hljs-comment">/**
        * Moves the SubPanel with the specified `origin` in the DOM hierarchy to the new specified `target`; if `target` is not specified, the SubPanel is attached to the SidePanel.
        *
        * @method dockSubPanel
        * @private
        * @param  {SubPanelSettings} attr Settings for the SubPanel; only `target` and `origin` are required here
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dockSubPanel</span>(<span class="hljs-params">attr</span>) </span>{
            <span class="hljs-keyword">var</span> target = attr.target || layoutController.getPanelContainer(),
                subPanel = subPanels[attr.origin];

            <span class="hljs-keyword">if</span> (subPanel) {</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>console.log(âdocking subpanelâ);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                subPanel.shiftTarget(target);
            }
        }

        <span class="hljs-comment">/**
        * Finds a SubPanel with `origin` equal to the supplied `consumeOrigin` and
        * + changes its `origin` to the supplied `origin`
        * + moves the SubPanel in the DOM hierarchy and attaches it to the specified target
        *
        * @method captureSubPanel
        * @private
        * @param  {SubPanelSettings} attr Settings for the SubPanel; only `origin`, `consumeOrigin` and `target` are required here
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">captureSubPanel</span>(<span class="hljs-params">attr</span>) </span>{
            <span class="hljs-keyword">var</span> subPanel;

            <span class="hljs-keyword">if</span> (attr.consumeOrigin === attr.origin &amp;&amp; subPanels[attr.consumeOrigin]) {
                subPanel = subPanels[attr.origin];
                subPanel.shiftTarget(attr.target);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (attr.consumeOrigin &amp;&amp; subPanels[attr.consumeOrigin]) {
                subPanel = subPanels[attr.consumeOrigin];
                subPanel.changeOrigin(attr.origin);
                subPanel.shiftTarget(attr.target);

                <span class="hljs-keyword">delete</span> subPanels[attr.consumeOrigin];
                subPanels[attr.origin] = subPanel;
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>TODO: notify bookmark module that layer query toggle has changed its state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        
        <span class="hljs-comment">/**
         * Stops event propagation.
         * 
         * @method stopEventPropagation
         * @private
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stopEventPropagation</span>(<span class="hljs-params">event</span>) </span>{
            event.stopPropagation();
        }

        <span class="hljs-comment">/**
         * A helper function that shows/hides Data tab if there some/none feature layers in the layer selector.
         * 
         * @method autoHideDataTab
         * @private
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">autoHideDataTab</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>initialize to the correct state (this might be happening after some layers have already loaded)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (RAMP.layerCounts &amp;&amp; RAMP.layerCounts.feature === <span class="hljs-number">0</span>) {
                layoutController.toggleDataTab();
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>subscribe to Layer added event which is fired every time a layer is added to the map through layer loader</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            topic.subscribe(EventManager.LayerLoader.LAYER_ADDED, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) </span>{
                layoutController.toggleDataTab(args.layerCounts.feature &gt; <span class="hljs-number">0</span>);
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>on each remove check if there are still feature layers in the layer list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            topic.subscribe(EventManager.LayerLoader.LAYER_REMOVED, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) </span>{
                layoutController.toggleDataTab(args.layerCounts.feature &gt; <span class="hljs-number">0</span>);
            });
        }

        <span class="hljs-keyword">return</span> {
            <span class="hljs-comment">/**
            * Call load to initialize the GUI module.
            *
            * @method load
            * @param  {Number} id   ID of this module
            * @param  {Object} req  dojo required, can be used to require additional modules, etc.
            * @param  {Function} load The callback function to be called as the very last thing in load
            */</span>
            load: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">id, req, load</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>measure available space on every page resize</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                subPanelTemplate = <span class="hljs-built_in">JSON</span>.parse(TmplHelper.stringifyTemplate(subPanelTemplate));
                subPanelLoadingAnimation = TmplHelper.template(<span class="hljs-string">'loading_simple'</span>, <span class="hljs-literal">null</span>, subPanelTemplate);
                datagridTemplate = <span class="hljs-built_in">JSON</span>.parse(TmplHelper.stringifyTemplate(datagridTemplate));

                layoutController.init();</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>registering help popup</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                helpPanelPopup = popupManager.registerPopup(helpToggle, <span class="hljs-string">"click"</span>,
                    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{
                        topic.publish(EventManager.GUI.HELP_PANEL_CHANGE, { visible: <span class="hljs-literal">true</span> });
                        topic.publish(EventManager.GUI.TOOLBAR_SECTION_OPEN, { id: <span class="hljs-string">"help-section"</span> });
                        <span class="hljs-built_in">console</span>.log(EventManager.GUI.HELP_PANEL_CHANGE + <span class="hljs-string">"; visible:"</span>, <span class="hljs-literal">true</span>);

                        <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>close this panel if any other panel is opened</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        UtilMisc.subscribeOnce(EventManager.GUI.TOOLBAR_SECTION_OPEN,
                            <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                                <span class="hljs-keyword">if</span> (that.isOpen()) {
                                    that.close();
                                }
                            });

                        helpSectionContainer.slideToggle(<span class="hljs-string">"fast"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                            d.resolve();
                        });
                    }, {
                        activeClass: cssButtonPressedClass,
                        target: helpSectionContainer,
                        closeHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{
                            topic.publish(EventManager.GUI.HELP_PANEL_CHANGE, { visible: <span class="hljs-literal">false</span> });
                            topic.publish(EventManager.GUI.TOOLBAR_SECTION_CLOSE, { id: <span class="hljs-string">"help-section"</span> });
                            <span class="hljs-built_in">console</span>.log(EventManager.GUI.HELP_PANEL_CHANGE + <span class="hljs-string">"; visible:"</span>, <span class="hljs-literal">false</span>);

                            helpSectionContainer.slideToggle(<span class="hljs-string">"fast"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                                d.resolve();
                            });
                        },
                        resetFocusOnClose: <span class="hljs-literal">true</span>
                    }
                );</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>TODO: remove mapQueryToggle.autoHide from config schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                autoHideDataTab();</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>start extended grid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                topic.subscribe(EventManager.GUI.DATAGRID_EXPAND, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    layoutController.toggleFullDataMode();
                });</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>end extended grid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                topic.subscribe(EventManager.GUI.TOGGLE_FULLSCREEN, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>{
                    layoutController.toggleFullScreenMode(evt.expand);
                });

                topic.subscribe(EventManager.GUI.SUBPANEL_OPEN, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">attr</span>) </span>{
                    showSubPanel(attr);
                });

                topic.subscribe(EventManager.GUI.SUBPANEL_CLOSE, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">attr</span>) </span>{
                    <span class="hljs-keyword">if</span> (attr.origin === <span class="hljs-string">"all"</span>) {
                        utilDict.forEachEntry(subPanels, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>attr.origin = key;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            hideSubPanel({
                                origin: key
                            });
                        });
                    } <span class="hljs-keyword">else</span> {
                        attr.origin.split(<span class="hljs-string">","</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">element</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>attr.origin = element;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            hideSubPanel({
                                origin: element
                            });
                        });
                    }
                });

                topic.subscribe(EventManager.GUI.SUBPANEL_DOCK, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">attr</span>) </span>{
                    <span class="hljs-keyword">var</span> na;
                    <span class="hljs-keyword">if</span> (attr.origin === <span class="hljs-string">"all"</span>) {
                        utilDict.forEachEntry(subPanels, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{
                            na = <span class="hljs-built_in">Object</span>.create(attr);
                            na.origin = key;
                            dockSubPanel(na);
                        });
                    } <span class="hljs-keyword">else</span> {
                        attr.origin.split(<span class="hljs-string">","</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">element</span>) </span>{
                            na = <span class="hljs-built_in">Object</span>.create(attr);
                            na.origin = element;
                            dockSubPanel(na);
                        });
                    }
                    <span class="hljs-built_in">console</span>.log(EventManager.GUI.SUBPANEL_DOCK, attr);
                });

                topic.subscribe(EventManager.GUI.SUBPANEL_CAPTURE, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">attr</span>) </span>{
                    <span class="hljs-keyword">var</span> na;
                    <span class="hljs-keyword">if</span> (attr.consumeOrigin === <span class="hljs-string">"all"</span>) {
                        utilDict.forEachEntry(subPanels, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{
                            na = <span class="hljs-built_in">Object</span>.create(attr);
                            na.consumeOrigin = key;
                            captureSubPanel(na);
                        });
                    } <span class="hljs-keyword">else</span> {
                        attr.consumeOrigin.split(<span class="hljs-string">","</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">element</span>) </span>{
                            na = <span class="hljs-built_in">Object</span>.create(attr);
                            na.consumeOrigin = element;
                            captureSubPanel(na);
                        });
                    }
                });</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>since basemap toggle may differ in width based on the basemap name, check if everything still fits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                topic.subscribe(EventManager.BasemapSelector.UI_COMPLETE, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    toolbarController.update();
                });

                topic.subscribe(EventManager.BasemapSelector.BASEMAP_CHANGED, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    toolbarController.update();
                });

                sidePanelTabList.find(<span class="hljs-string">"li a"</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"inside side panel tab list on click"</span>);
                    <span class="hljs-keyword">var</span> selectedPanelId = $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">"href"</span>).substr(<span class="hljs-number">1</span>);

                    sidePanelTabPanels.find(<span class="hljs-string">"details[id="</span> + selectedPanelId + <span class="hljs-string">"]"</span>).each(
                        <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                            topic.publish(EventManager.GUI.TAB_SELECTED, {
                                id: <span class="hljs-keyword">this</span>.id,
                                tabName: $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">"panel-name"</span>)
                            });
                        });</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>the panel currently open is being deselected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    sidePanelTabPanels.find(<span class="hljs-string">"details[aria-expanded=true]"</span>).each(
                        <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                            topic.publish(EventManager.GUI.TAB_DESELECTED, {
                                id: <span class="hljs-keyword">this</span>.id,
                                tabName: $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">"panel-name"</span>)
                            });
                        });
                });</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>List of objects containing an event name and an event argument. The events should
be anything to wait for before publishing a map extent change, it should include
anything that will change the size of the map (e.g. fullscreen, closing the panel).
If the map extent change occurs BEFORE something that changes the size of the map (e.g. fullscreen)
then the map extent will change again.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> waitList = [];

                <span class="hljs-keyword">if</span> (!RAMP.state.ui.sidePanelOpened) {</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>NOTE: panel change not triggered here (see map extent change below)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    waitList.push({
                        publishName: EventManager.GUI.PANEL_TOGGLE,
                        eventArg: {
                            origin: <span class="hljs-string">"bootstrapper"</span>,
                            visible: RAMP.state.ui.sidePanelOpened
                        },
                        subscribeName: EventManager.GUI.PANEL_CHANGE
                    });
                }

                <span class="hljs-keyword">if</span> (RAMP.state.ui.fullscreen) {</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>NOTE: fullscreen not triggered here (see map extent change below)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    waitList.push({
                        publishName: EventManager.GUI.TOGGLE_FULLSCREEN,
                        eventArg: {
                            expand: <span class="hljs-literal">true</span>
                        },
                        subscribeName: EventManager.GUI.FULLSCREEN_CHANGE
                    });
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>return the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                load();</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>This should be the last thing that happens</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (waitList.isEmpty()) {
                    topic.publish(EventManager.GUI.UPDATE_COMPLETE);
                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Wait for things such as fullscreen or panel collapse
to finish before publishing the UPDATE_COMPLETE.</p>

            </div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Note itâs important to subscribe to the events, then
publish them, thatâs why it was done in such an obscure way
using the waitList (otherwise if we just publish the
event like above, then subscribe to it here, the event
might have completed before reaching this point)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> eventNames = waitList.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{
                        <span class="hljs-keyword">return</span> obj.subscribeName;
                    });

                    UtilMisc.subscribeAll(eventNames, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        topic.publish(EventManager.GUI.UPDATE_COMPLETE);
                    });

                    waitList.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{
                        topic.publish(obj.publishName, obj.eventArg);
                    });
                }
            }
        };
    }
);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
