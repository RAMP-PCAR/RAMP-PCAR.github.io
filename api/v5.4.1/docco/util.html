<!DOCTYPE html>

<html>
<head>
  <title>util.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="advancedToolbar.html">
                advancedToolbar.js
              </a>
            
              
              <a class="source" href="attributeLoader.html">
                attributeLoader.js
              </a>
            
              
              <a class="source" href="basemapSelector.html">
                basemapSelector.js
              </a>
            
              
              <a class="source" href="bookmarkLink.html">
                bookmarkLink.js
              </a>
            
              
              <a class="source" href="dataLoader.html">
                dataLoader.js
              </a>
            
              
              <a class="source" href="dataLoaderGui.html">
                dataLoaderGui.js
              </a>
            
              
              <a class="source" href="datagrid.html">
                datagrid.js
              </a>
            
              
              <a class="source" href="datagridClickHandler.html">
                datagridClickHandler.js
              </a>
            
              
              <a class="source" href="eventManager.html">
                eventManager.js
              </a>
            
              
              <a class="source" href="featureClickHandler.html">
                featureClickHandler.js
              </a>
            
              
              <a class="source" href="featureHighlighter.html">
                featureHighlighter.js
              </a>
            
              
              <a class="source" href="filterManager.html">
                filterManager.js
              </a>
            
              
              <a class="source" href="geoSearch.html">
                geoSearch.js
              </a>
            
              
              <a class="source" href="globalStorage.html">
                globalStorage.js
              </a>
            
              
              <a class="source" href="graphicExtension.html">
                graphicExtension.js
              </a>
            
              
              <a class="source" href="gui.html">
                gui.js
              </a>
            
              
              <a class="source" href="imageExport.html">
                imageExport.js
              </a>
            
              
              <a class="source" href="layerGroup.html">
                layerGroup.js
              </a>
            
              
              <a class="source" href="layerItem.html">
                layerItem.js
              </a>
            
              
              <a class="source" href="layerLoader.html">
                layerLoader.js
              </a>
            
              
              <a class="source" href="map.html">
                map.js
              </a>
            
              
              <a class="source" href="mapClickHandler.html">
                mapClickHandler.js
              </a>
            
              
              <a class="source" href="maptips.html">
                maptips.js
              </a>
            
              
              <a class="source" href="metadataHandler.html">
                metadataHandler.js
              </a>
            
              
              <a class="source" href="navigation.html">
                navigation.js
              </a>
            
              
              <a class="source" href="quickzoom.html">
                quickzoom.js
              </a>
            
              
              <a class="source" href="stepItem.html">
                stepItem.js
              </a>
            
              
              <a class="source" href="theme.html">
                theme.js
              </a>
            
              
              <a class="source" href="RAMP-starter.html">
                RAMP-starter.js
              </a>
            
              
              <a class="source" href="areaTool.html">
                areaTool.js
              </a>
            
              
              <a class="source" href="baseTool.html">
                baseTool.js
              </a>
            
              
              <a class="source" href="bufferTool.html">
                bufferTool.js
              </a>
            
              
              <a class="source" href="distanceTool.html">
                distanceTool.js
              </a>
            
              
              <a class="source" href="populationTool.html">
                populationTool.js
              </a>
            
              
              <a class="source" href="array.html">
                array.js
              </a>
            
              
              <a class="source" href="bricks.html">
                bricks.js
              </a>
            
              
              <a class="source" href="checkbox.html">
                checkbox.js
              </a>
            
              
              <a class="source" href="checkboxGroup.html">
                checkboxGroup.js
              </a>
            
              
              <a class="source" href="decorator.html">
                decorator.js
              </a>
            
              
              <a class="source" href="dictionary.html">
                dictionary.js
              </a>
            
              
              <a class="source" href="functionMangler.html">
                functionMangler.js
              </a>
            
              
              <a class="source" href="popupManager.html">
                popupManager.js
              </a>
            
              
              <a class="source" href="prototype.html">
                prototype.js
              </a>
            
              
              <a class="source" href="tmplHelper.html">
                tmplHelper.js
              </a>
            
              
              <a class="source" href="tmplUtil.html">
                tmplUtil.js
              </a>
            
              
              <a class="source" href="url.html">
                url.js
              </a>
            
              
              <a class="source" href="util.html">
                util.js
              </a>
            
              
              <a class="source" href="bootstrapper.html">
                bootstrapper.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>util.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>ï»¿<span class="hljs-comment">/* global define, window, XMLHttpRequest, ActiveXObject, XSLTProcessor, console, $, document, jQuery, FileReader, Btoa */</span>
<span class="hljs-comment">/* jshint bitwise:false  */</span>

<span class="hljs-comment">/**
* Utility module containing useful static classes.
*
* @module Utils
* @main Utils
*/</span>

<span class="hljs-comment">/**
* A set of functions used by at least one module in this project. The functions
* are generic enough that they may become useful for other modules later or functions
* that are shared amongst multiple modules should be added here.
*
* *__NOTE__: None of these functions require the global configuration object. (i.e. they
* are not exclusive to RAMP). For functions that depend on the global configuration
* object, place them in ramp.js.*
*
* @class Util
* @static
* @uses dojo/_base/array
* @uses dojo/_base/lang
* @uses dojo/topic
* @uses dojo/Deferred
* @uses esri/geometry/Extent
* @uses esri/graphic
*/</span>
define([<span class="hljs-string">"dojo/_base/lang"</span>, <span class="hljs-string">"dojo/topic"</span>, <span class="hljs-string">"dojo/Deferred"</span>, <span class="hljs-string">"esri/geometry/Extent"</span>, <span class="hljs-string">"esri/graphic"</span>],
    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dojoLang, topic, Deferred, Extent, Graphic</span>) </span>{
<span class="hljs-pi">        "use strict"</span>;

        <span class="hljs-comment">/**
        * Helper function for wrapping File API calls in Promise objects.  Used for building a series of helpers which
        * call different file read methods.
        *
        * @method _wrapFileCallInPromise
        * @private
        * @param {String} readMethod a string indicating the FileReader method to call
        * @return {Function} a function which accepts a {File} object and returns a Promise
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_wrapFileCallInPromise</span>(<span class="hljs-params">readMethod</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">file</span>) </span>{
                <span class="hljs-keyword">var</span> reader = <span class="hljs-keyword">new</span> FileReader(),
                    def = <span class="hljs-keyword">new</span> Deferred();

                reader.onloadend = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{ def.resolve(e.target.result); };
                reader.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{ def.reject(e.target.error); };
                <span class="hljs-keyword">try</span> {
                    reader[readMethod](file);
                } <span class="hljs-keyword">catch</span> (e) {
                    def.reject(e);
                }

                <span class="hljs-keyword">return</span> def.promise;
            };
        }

        <span class="hljs-keyword">return</span> {
            <span class="hljs-comment">/**
            * Checks if the console exists, if not, redefine the console and all console methods to
            * a function that does nothing. Useful for IE which does not have the console until the
            * debugger is opened.
            *
            * @method checkConsole
            * @static
            */</span>
            checkConsole: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> noop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ },
                    methods = [
                        <span class="hljs-string">'assert'</span>, <span class="hljs-string">'clear'</span>, <span class="hljs-string">'count'</span>, <span class="hljs-string">'debug'</span>, <span class="hljs-string">'dir'</span>, <span class="hljs-string">'dirxml'</span>, <span class="hljs-string">'error'</span>,
                        <span class="hljs-string">'exception'</span>, <span class="hljs-string">'group'</span>, <span class="hljs-string">'groupCollapsed'</span>, <span class="hljs-string">'groupEnd'</span>, <span class="hljs-string">'info'</span>, <span class="hljs-string">'log'</span>,
                        <span class="hljs-string">'markTimeline'</span>, <span class="hljs-string">'profile'</span>, <span class="hljs-string">'profileEnd'</span>, <span class="hljs-string">'table'</span>, <span class="hljs-string">'time'</span>, <span class="hljs-string">'timeEnd'</span>,
                        <span class="hljs-string">'timeStamp'</span>, <span class="hljs-string">'trace'</span>, <span class="hljs-string">'warn'</span>
                    ],
                    length = methods.length,
                    <span class="hljs-built_in">console</span> = (<span class="hljs-built_in">window</span>.console = <span class="hljs-built_in">window</span>.console || {}),
                    method;

                <span class="hljs-keyword">while</span> (length--) {
                    method = methods[length];</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Only stub undefined methods.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">console</span>[method]) {
                        <span class="hljs-built_in">console</span>[method] = noop;
                    }
                }
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>String Functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-comment">/**
            * Returns an String that has it's angle brackets ('&lt;' and '&gt;') escaped (replaced by '&amp;lt;' and '&amp;gt;').
            * This will effectively cause the String to be displayed in plain text when embedded in an HTML page.
            *
            * @method escapeHtml
            * @static
            * @param {String} html String to escape
            * @return {String} escapeHtml Escaped string
            */</span>
            escapeHtml: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">html</span>) </span>{
                <span class="hljs-keyword">return</span> html.replaceAll(<span class="hljs-string">"&lt;"</span>, <span class="hljs-string">"&amp;lt;"</span>).replaceAll(<span class="hljs-string">"&gt;"</span>, <span class="hljs-string">"&amp;gt;"</span>);
            },

            <span class="hljs-comment">/**
            * Returns true if the given String is a number
            *
            * @method isNumber
            * @static
            * @param {String} input The string to check
            * @return {boolean} True if number
            */</span>
            isNumber: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">input</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">isFinite</span>(<span class="hljs-built_in">String</span>(input).trim() || <span class="hljs-literal">NaN</span>);
            },

            <span class="hljs-comment">/**
            * Parse the given String into a boolean. Returns true if the String
            * is the word "true" (case insensitive). False otherwise.
            *
            * @method parseBool
            * @static
            * @param {String} str The string to check
            * @return {boolean} True if `true`
            */</span>
            parseBool: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">str</span>) </span>{
                <span class="hljs-keyword">return</span> (str.toLowerCase() === <span class="hljs-string">'true'</span>);
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Deferred</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-comment">/**
            * Executes the callback function only after all the deferred Objects in the
            * given deferredList has resolved.
            *
            * @method afterAll
            * @static
            * @param {array} deferredList A list of Deferred objects
            * @param {function} callback The callback to be executed
            */</span>
            afterAll: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">deferredList, callback, context</span>) </span>{
                <span class="hljs-keyword">if</span> (deferredList.length === <span class="hljs-number">0</span>) {
                    callback();
                    <span class="hljs-keyword">return</span>;
                }

                <span class="hljs-keyword">var</span> completed = <span class="hljs-number">0</span>; <span class="hljs-comment">// Keeps track of the number of deferred that has resolved</span>
                deferredList.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">deferred</span>) </span>{
                    deferred.then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        completed++;
                        <span class="hljs-keyword">if</span> (completed === deferredList.length) {
                            callback.call(context);
                        }
                    });
                });
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Serialization</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-comment">/**
            * Converts an array into a '+' separated String that can be used as
            * the query parameter of a URL.
            *
            *      arrayToQuery(["abc", 123, "efg"]) -&gt; "abc+123+efg"
            *
            * *__NOTE:__ the array should only contain primitives, objects will not be serialized
            * properly.*
            *
            * @method arrayToQuery
            * @static
            * @param {array} array An array of primitives to be serialized
            * @return {String} A serialized representation of the given array
            */</span>
            arrayToQuery: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">array</span>) </span>{
                <span class="hljs-keyword">return</span> array.join(<span class="hljs-string">"+"</span>);
            },

            <span class="hljs-comment">/**
            * Converts a query String generated by arrayToQuery into an array object.
            * The array object will only contain Strings.
            *
            *      queryToArray("abc+123+efg") -&gt; ["abc", "123", "efg"]
            *
            * @method queryToArray
            * @static
            * @param {String} query A query string to be converted
            * @return {String} A resulting array of strings
            */</span>
            queryToArray: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">query</span>) </span>{
                <span class="hljs-keyword">return</span> query.split(<span class="hljs-string">"+"</span>);
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Event handling</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-comment">/**
            * A convenience method that wraps around Dojo's subscribe method to allow
            * a scope to hitched to the given callback function.
            *
            * @method subscribe
            * @static
            * @param {String} name Event name
            * @param {function} callback The callback to be executed
            * @param {object} scope Scope of the callback
            */</span>
            subscribe: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, callback, scope</span>) </span>{
                <span class="hljs-keyword">if</span> (scope) {
                    topic.subscribe(name, callback.call(scope));
                } <span class="hljs-keyword">else</span> {
                    topic.subscribe(name, callback);
                }
            },

            <span class="hljs-comment">/**
            * Subscribes to an event, after the event has occurred, the handle is
            * removed.
            *
            * @method subscribeOnce
            * @static
            * @param {String} name Event name
            * @param {function} callback The callback to be executed
            */</span>
            subscribeOnce: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, callback</span>) </span>{
                <span class="hljs-keyword">var</span> handle = <span class="hljs-literal">null</span>,
                    wrapper = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>{
                        handle.remove();
                        callback(evt);
                    };

                <span class="hljs-keyword">return</span> (handle = topic.subscribe(name, wrapper));
            },

            <span class="hljs-comment">/**
            * Subscribes to a set of events, executes the callback when any of the events fire, then removes the handle.
            *
            * @method subscribeOnceAny
            * @static
            * @param  {String} names An array of event names
            * @param  {Function} callback The callback to be executed
            */</span>
            subscribeOnceAny: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">names, callback</span>) </span>{
                <span class="hljs-keyword">var</span> handles = [],
                    that = <span class="hljs-keyword">this</span>;

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wrapper</span>(<span class="hljs-params">evt</span>) </span>{
                    handles.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">handle</span>) </span>{
                        handle.remove();
                    });

                    callback(evt);
                }

                names.forEach(
                    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
                        handles.push(that.subscribeOnce(name, wrapper));
                    });
            },

            <span class="hljs-comment">/**
            * Given an array of event names published by topic.publish, call the given
            * callback function after ALL of the given events have occurred. An array of
            * arguments is passed to the callback function, the arguments are those returned
            * by the events (in the order that the events appear in the array).
            *
            * #####Example
            *
            * Assume somewhere a module publishes a "click" event:
            *
            *      topic.publish("click", { mouseX: 10, mouseY: 50 });
            *
            * and somewhere else another module publishes a "finishLoading" event:
            *
            *      topic.publish("finishLoading", { loadedPictures: [pic1, pic2] });
            *
            * Then if one wants to do something (e.g. display pictures) only after the pictures
            * have been loaded AND the user clicked somewhere, then:
            *
            * - args[0] will be the object returned by the "click" event
            * - which in this case will be: { mouseX: 10, mouseY: 50 }
            * - args[1] will be the object returned by the "finishLoading" event
            * - which in this case will be: { loadedPictures: [pic1, pic2] }
            *
            *
            *      subscribe(["click", "finishLoading"], function(args) {
            *          doSomething();
            *      });
            *
            * *__NOTE:__
            * If one of the events fires multiple times before the other event, the object
            * passed by this function to the callback will be the object returned when the
            * event FIRST fired (subsequent firings of the same event are ignored). Also, if
            * some event do not return an object, it will also be excluded in the arguments to
            * the callback function. So be careful! For example, say you subscribed to the events:
            * "evt1", "evt2", "evt3". "evt1" returns an object (call it "evt1Obj"), "evt2" does not,
            * "evt3" returns two objects (call it "evt3Obj-1" and "evt3Obj-2" respectively).
            * Then the array passed to the callback will be: ["evt1Obj", "evt3Obj-1", "evt3Obj-2"].*
            *
            * @method subscribeAll
            * @static
            * @param {array} nameArray An array of Strings containing the names of events to subscribe to
            * @param {function} callback The callback to be executed
            */</span>
            subscribeAll: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">nameArray, callback</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Keeps track of the status of all the events being subscribed to</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> events = [];

                nameArray.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">eventName, i</span>) </span>{
                    events.push({
                        fired: <span class="hljs-literal">false</span>,
                        args: <span class="hljs-literal">null</span>
                    });

                    topic.subscribe(eventName, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>If this is the fire time the event fired</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (!events[i].fired) {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Mark the event has fired and capture itâs arguments (if any)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            events[i].fired = <span class="hljs-literal">true</span>;
                            events[i].args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Check if all events have fired</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">if</span> (events.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{ <span class="hljs-keyword">return</span> !event.fired; }).length === <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>If so construct an array with arguments from the events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                <span class="hljs-keyword">var</span> eventArgs = events.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{ <span class="hljs-keyword">return</span> event.args; });
                                callback(eventArgs);
                            }
                        }
                    });
                });
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Specialized Variables *</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-comment">/**
            * Creates an object that acts like a lazy variable (i.e. a variable whose value is only
            * resolved the first time it is retrieved, not when it is assigned). The value given to
            * the lazy variable should be the return value of the given initFunc. The returned object
            * has two methods:
            *
            * - get - returns the value of the variable, if it is the first time get is called, the
            * the initFunc will be called to resolve the value of the variable.
            * - reset - forces the variable to call the initFunc again the next time get is called
            *
            * @method createLazyVariable
            * @static
            * @param {function} initFunc A function to call to resolve the variable value
            * @return {Object} The lazy variable
            */</span>
            createLazyVariable: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">initFunc</span>) </span>{
                <span class="hljs-keyword">var</span> value = <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">return</span> {
                    reset: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        value = <span class="hljs-literal">null</span>;
                    },

                    get: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) {
                            value = initFunc();
                        }
                        <span class="hljs-keyword">return</span> value;
                    }
                };
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>FUNCTION DECORATORS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-comment">/**
            * Returns a function that has the same functionality as the given function, but
            * can only be executed once (subsequent execution does nothing).
            *
            * @method once
            * @static
            * @param {function} func Function to be decorated
            * @return {function} Decorated function that can be executed once
            */</span>
            once: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">func</span>) </span>{
                <span class="hljs-keyword">var</span> ran = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (!ran) {
                        func();
                        ran = <span class="hljs-literal">true</span>;
                    }
                };
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>MISCELLANEOUS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-comment">/**
            * Returns true if the given obj is undefined, false otherwise.
            *
            * @method isUndefined
            * @static
            * @param {object} obj Object to be checked
            * @return {boolean} True if the given object is undefined, false otherwise
            */</span>
            isUndefined: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{
                <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">'Think twice about using isDefined: consider checking explicitly or using a falsy test instead'</span>);
                <span class="hljs-keyword">return</span> (<span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">'undefined'</span>);
            },

            <span class="hljs-comment">/**
            * Compares two graphic objects.
            *
            * @method compareGraphics
            * @static
            * @param  {Object} one Graphic object
            * @param  {Object} two Graphic object
            * @return {boolean} True if the objects represent the same feature
            */</span>
            compareGraphics: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">one, two</span>) </span>{
                <span class="hljs-keyword">var</span> oneKey = <span class="hljs-string">"0"</span>,
                    twoKey = <span class="hljs-string">"1"</span>,
                    objectIdField,
                    oneLayer,
                    twoLayer;

                <span class="hljs-keyword">if</span> (one &amp;&amp; two &amp;&amp;
                    $.isFunction(one.getLayer) &amp;&amp; $.isFunction(two.getLayer)) {
                    oneLayer = one.getLayer();
                    twoLayer = two.getLayer();
                    objectIdField = oneLayer.objectIdField;
                    oneKey = oneLayer.sourceLayerId + one.attributes[objectIdField];
                    twoKey = twoLayer.sourceLayerId + two.attributes[objectIdField];
                }

                <span class="hljs-keyword">return</span> oneKey === twoKey;
            },

            <span class="hljs-comment">/**
            * Returns the width of the scrollbar in pixels. Since different browsers render scrollbars differently, the width may vary.
            *
            * @method scrollbarWidth
            * @static
            * @return {int} The width of the scrollbar in pixels
            * @for Util
            */</span>
            scrollbarWidth: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> $inner = jQuery(<span class="hljs-string">'&lt;div style="width: 100%; height:200px;"&gt;test&lt;/div&gt;'</span>),
                    $outer = jQuery(<span class="hljs-string">'&lt;div style="width:200px;height:150px; position: absolute; top: 0; left: 0; visibility: hidden; overflow:hidden;"&gt;&lt;/div&gt;'</span>).append($inner),
                    inner = $inner[<span class="hljs-number">0</span>],
                    outer = $outer[<span class="hljs-number">0</span>],
                    width1, width2;

                jQuery(<span class="hljs-string">'body'</span>).append(outer);
                width1 = inner.offsetWidth;
                $outer.css(<span class="hljs-string">'overflow'</span>, <span class="hljs-string">'scroll'</span>);
                width2 = outer.clientWidth;
                $outer.remove();

                <span class="hljs-keyword">return</span> (width1 - width2);
            },

            <span class="hljs-comment">/**
            * Checks if the height of the scrollable content of the body is taller than its height;
            * if so, offset the content horizontally to accommodate for the scrollbar assuming target's width is
            * set to "100%".
            *
            * @method adjustWidthForSrollbar
            * @static
            * @param {jObject} body A DOM node with a scrollbar (or not)
            * @param {jObject} targets An array of jObjects to add the offset to
            */</span>
            adjustWidthForSrollbar: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">body, targets</span>) </span>{
                <span class="hljs-keyword">var</span> offset = body.innerHeight() &lt; body[<span class="hljs-number">0</span>].scrollHeight ? <span class="hljs-keyword">this</span>.scrollbarWidth() : <span class="hljs-number">0</span>;

                targets.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">target</span>) </span>{
                    target.css({
                        right: offset
                    });
                });
            },

            <span class="hljs-comment">/**
            * Waits until a given function is available and executes a callback function.
            *
            * @method executeOnLoad
            * @static
            * @param {Object} target an object on which to wait for function to appear
            * @param {function} func A function whose availability in question
            * @param {function} callback The callback function to be executed after func is available
            */</span>
            executeOnLoad: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">target, func, callback</span>) </span>{
                <span class="hljs-keyword">var</span> deferred = <span class="hljs-keyword">new</span> Deferred(),
                    handle;

                deferred.then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-built_in">window</span>.clearInterval(handle);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>console.log(âdeferred resolvedâ);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                    callback();
                });

                handle = <span class="hljs-built_in">window</span>.setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> ($.isFunction(target[func])) {
                        deferred.resolve(<span class="hljs-literal">true</span>);
                    }
                }, <span class="hljs-number">500</span>);
            },

            <span class="hljs-comment">/**
            * Loops through all object properties and applies a given function to each. Resolves the given deferred when done.
            *
            * @method executeOnDone
            * @static
            * @param {object} o Object to look through
            * @param {function} func A function to be executed with each object propety. Accepts two parameters: property and deferred to be resolved when it's done.
            * @param {object} d A deferred to be resolved when all properties have been processed.
            */</span>
            executeOnDone: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">o, func, d</span>) </span>{
                <span class="hljs-keyword">var</span> counter = <span class="hljs-number">0</span>,
                    arr = [],
                    deferred;

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fnOnDeferredCancel</span>(<span class="hljs-params"></span>) </span>{
                    d.cancel();
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fnOnDeferredThen</span>(<span class="hljs-params"></span>) </span>{
                    counter--;
                    <span class="hljs-keyword">if</span> (counter === <span class="hljs-number">0</span>) {
                        d.resolve(<span class="hljs-literal">true</span>);
                    }
                }

                d = d || <span class="hljs-keyword">new</span> Deferred();

                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> q <span class="hljs-keyword">in</span> o) {
                    <span class="hljs-keyword">if</span> (o.hasOwnProperty(q)) {
                        arr.push(o[q]);
                    }
                }

                counter = arr.length;

                arr.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">p</span>) </span>{
                    deferred = <span class="hljs-keyword">new</span> Deferred(fnOnDeferredCancel);

                    deferred.then(fnOnDeferredThen);

                    func(p, deferred);
                });

                <span class="hljs-keyword">if</span> (counter === <span class="hljs-number">0</span>) {
                    d.resolve(<span class="hljs-literal">true</span>);
                }
            },

            <span class="hljs-comment">/**
            * Generates an rfc4122 version 4 compliant guid.
            * Taken from here: http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript
            *
            * @method guid
            * @static
            * @return {String} The generated guid string
            */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>TODO: check if there is new/better code for guid generation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            guid: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-string">'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'</span>.replace(<span class="hljs-regexp">/[xy]/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">c</span>) </span>{
                    <span class="hljs-keyword">var</span> r = <span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">16</span> | <span class="hljs-number">0</span>,
                        v = c === <span class="hljs-string">'x'</span> ? r : (r &amp; <span class="hljs-number">0x3</span> | <span class="hljs-number">0x8</span>);
                    <span class="hljs-keyword">return</span> v.toString(<span class="hljs-number">16</span>);
                });
            },

            <span class="hljs-comment">/**
            * Returns an appropriate where clause depending on whether the query
            * is a String (returns a where clause with CASE INSENSITIVE comparison)
            * or an integer.
            *
            * @method getWhereClause
            * @static
            * @param {String} varName ???
            * @param {String | Number} query A query string
            * @return {String} The generated "where" clause
            */</span>
            getWhereClause: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">varName, query</span>) </span>{
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isNumber(query)) {
                    <span class="hljs-keyword">return</span> <span class="hljs-built_in">String</span>.format(<span class="hljs-string">"{0}={1}"</span>, varName, query);
                }
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">String</span>.format(<span class="hljs-string">"Upper({0})=Upper(\'{1}\')"</span>, varName, query);
            },

            <span class="hljs-comment">/**
            * Converts html into text by replacing
            * all html tags with their appropriate special characters
            *
            * @method stripHtml
            * @static
            * @param {String} html HTML to be converted to text
            * @return {String} The HTML in text form
            */</span>
            stripHtml: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">html</span>) </span>{
                <span class="hljs-keyword">var</span> tmp = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"DIV"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>jquery .text function converts html into text by replacing
all html tags with their appropriate special characters</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $(tmp).text(html);
                <span class="hljs-keyword">return</span> tmp.textContent || tmp.innerText || <span class="hljs-string">""</span>;
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Query geometry</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-comment">/*
            * Create a new extent based on the current map size, a point (X/Y coordinates), and a pixel tolerance value.
            * @method pointToExtent
            * @static
            * @param {Object} map The map control
            * @param {Object} point The location on screen (X/Y coordinates)
            * @param {Number} toleranceInPixel A value indicating how many screen pixels the extent should be from the point
            * @returns {Object} a new extent calculated from the given parameters
            *
            */</span>
            pointToExtent: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">map, point, toleranceInPixel</span>) </span>{
                <span class="hljs-keyword">var</span> pixelWidth = map.extent.getWidth() / map.width,
                    toleraceInMapCoords = toleranceInPixel * pixelWidth;

                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Extent(point.x - toleraceInMapCoords,
                              point.y - toleraceInMapCoords,
                              point.x + toleraceInMapCoords,
                              point.y + toleraceInMapCoords,
                              map.spatialReference);
            },

            <span class="hljs-comment">/**
            * Create boudingbox graphic for a bounding box extent
            *
            * @method createGraphic
            * @static
            * @param  {esri/geometry/Extent} extent of a bounding box
            * @return {esri/Graphic}        An ESRI graphic object represents a bouding box
            */</span>
            createGraphic: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">extent</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Graphic({
                    geometry: extent,
                    symbol: {
                        color: [<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">64</span>],
                        outline: {
                            color: [<span class="hljs-number">240</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">255</span>],
                            width: <span class="hljs-number">1</span>,
                            type: <span class="hljs-string">"esriSLS"</span>,
                            style: <span class="hljs-string">"esriSLSSolid"</span>
                        },
                        type: <span class="hljs-string">"esriSFS"</span>,
                        style: <span class="hljs-string">"esriSFSSolid"</span>
                    }
                });
            },

            <span class="hljs-comment">/**
            * Checks if the string ends with the supplied suffix.
            *
            * @method endsWith
            * @static
            * @param {String} str String to be evaluated
            * @param {String} suffix Ending string to be matched
            * @return {boolean} True if suffix matches
            */</span>
            endsWith: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">str, suffix</span>) </span>{
                <span class="hljs-keyword">return</span> str.indexOf(suffix, str.length - suffix.length) !== -<span class="hljs-number">1</span>;
            },

            <span class="hljs-comment">/**
            * Recursively merge JSON objects into a target object.
            * The merge will also merge array elements.
            *
            * @method mergeRecursive
            * @static
            */</span>
            mergeRecursive: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isDOMNode</span>(<span class="hljs-params">v</span>) </span>{
                    <span class="hljs-keyword">if</span> (v === <span class="hljs-literal">null</span>) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    }
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> v !== <span class="hljs-string">'object'</span>) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    }
                    <span class="hljs-keyword">if</span> (!(<span class="hljs-string">'nodeName'</span> <span class="hljs-keyword">in</span> v)) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    }
                    <span class="hljs-keyword">var</span> nn = v.nodeName;
                    <span class="hljs-keyword">try</span> {
                        v.nodeName = <span class="hljs-string">'is readonly?'</span>;
                    } <span class="hljs-keyword">catch</span> (e) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                    }
                    <span class="hljs-keyword">if</span> (v.nodeName === nn) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                    }
                    v.nodeName = nn;
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>_mergeRecursive does the actual job with two arguments.
@param {Object} destination JSON object to have other objects merged into.  Parameter is modified by the function.
@param {Object} sourceArray Param array of JSON objects to merge into the source
@return {Ojbect} merged result object (points to destination variable)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> _mergeRecursive = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dst, src</span>) </span>{
                    <span class="hljs-keyword">if</span> (isDOMNode(src) || <span class="hljs-keyword">typeof</span> src !== <span class="hljs-string">'object'</span> || src === <span class="hljs-literal">null</span>) {
                        <span class="hljs-keyword">return</span> dst;
                    }

                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p <span class="hljs-keyword">in</span> src) {
                        <span class="hljs-keyword">if</span> (src.hasOwnProperty(p)) {
                            <span class="hljs-keyword">if</span> ($.isArray(src[p])) {
                                <span class="hljs-keyword">if</span> (dst[p] === <span class="hljs-literal">undefined</span>) {
                                    dst[p] = [];
                                }
                                $.merge(dst[p], src[p]);
                                <span class="hljs-keyword">continue</span>;
                            }

                            <span class="hljs-keyword">if</span> (src[p] === <span class="hljs-literal">undefined</span>) {
                                <span class="hljs-keyword">continue</span>;
                            }
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> src[p] !== <span class="hljs-string">'object'</span> || src[p] === <span class="hljs-literal">null</span>) {
                                dst[p] = src[p];
                            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> dst[p] !== <span class="hljs-string">'object'</span> || dst[p] === <span class="hljs-literal">null</span>) {
                                dst[p] = _mergeRecursive(src[p].constructor === <span class="hljs-built_in">Array</span> ? [] : {}, src[p]);
                            } <span class="hljs-keyword">else</span> {
                                _mergeRecursive(dst[p], src[p]);
                            }
                        }
                    }
                    <span class="hljs-keyword">return</span> dst;
                }, out;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Loop through arguments and merge them into the first argument.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                out = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> out !== <span class="hljs-string">'object'</span> || out === <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">return</span> out;
                }
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>, il = <span class="hljs-built_in">arguments</span>.length; i &lt; il; i++) {
                    _mergeRecursive(out, <span class="hljs-built_in">arguments</span>[i]);
                }
                <span class="hljs-keyword">return</span> out;
            },

            <span class="hljs-comment">/**
            * Applies supplied xslt to supplied xml. IE always returns a String; others may return a documentFragment or a jObject.
            *
            * @method transformXML
            * @static
            * @param {String} xmlurl Location of the xml file
            * @param {String} xslurl Location of the xslt file
            * @param {Function} callback The callback to be executed
            * @param {Boolean} returnFragment True if you want a document fragment returned (doesn't work in IE)}
            */</span>
            transformXML: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">xmlurl, xslurl, callback, returnFragment, params</span>) </span>{
                <span class="hljs-keyword">var</span> xmld = <span class="hljs-keyword">new</span> Deferred(),
                    xsld = <span class="hljs-keyword">new</span> Deferred(),
                    xml, xsl,
                    dlist = [xmld, xsld],
                    result,
                    error,
                    that = <span class="hljs-keyword">this</span>;

                that.afterAll(dlist, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (!error) {
                        result = applyXSLT(xml, xsl);
                    }
                    callback(error, result);
                });</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Transform XML using XSLT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">applyXSLT</span>(<span class="hljs-params">xmlString, xslString</span>) </span>{
                    <span class="hljs-keyword">var</span> output, i;
                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.ActiveXObject || <span class="hljs-built_in">window</span>.hasOwnProperty(<span class="hljs-string">"ActiveXObject"</span>)) { <span class="hljs-comment">// IE</span>
                        <span class="hljs-keyword">var</span> xslt = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">"Msxml2.XSLTemplate"</span>),
                            xmlDoc = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">"Msxml2.DOMDocument"</span>),
                            xslDoc = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">"Msxml2.FreeThreadedDOMDocument"</span>),
                            xslProc;

                        xmlDoc.loadXML(xmlString);
                        xslDoc.loadXML(xslString);
                        xslt.stylesheet = xslDoc;
                        xslProc = xslt.createProcessor();
                        xslProc.input = xmlDoc;</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>[patched from ECDMP] Add parameters to xsl document (addParameter = ie only)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (params) {
                            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; params.length; i++) {
                                xslProc.addParameter(params[i].key, params[i].value, <span class="hljs-string">""</span>);
                            }
                        }
                        xslProc.transform();
                        output = xslProc.output;
                    } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// Chrome/FF/Others</span>
                        <span class="hljs-keyword">var</span> xsltProcessor = <span class="hljs-keyword">new</span> XSLTProcessor();
                        xsltProcessor.importStylesheet(xslString);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>[patched from ECDMP] Add parameters to xsl document (setParameter = Chrome/FF/Others)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (params) {
                            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; params.length; i++) {
                                xsltProcessor.setParameter(<span class="hljs-literal">null</span>, params[i].key, params[i].value || <span class="hljs-string">""</span>);
                            }
                        }
                        output = xsltProcessor.transformToFragment(xmlString, <span class="hljs-built_in">document</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>turn a document fragment into a proper jQuery object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (!returnFragment) {
                            output = ($(<span class="hljs-string">'body'</span>)
                                .append(output)
                                .children().last())
                                .detach();
                        }
                    }
                    <span class="hljs-keyword">return</span> output;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Distinguish between XML/XSL deferred objects to resolve and set response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolveDeferred</span>(<span class="hljs-params">filename, responseObj</span>) </span>{
                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'resolving'</span>);
                    <span class="hljs-built_in">console</span>.log(filename);
                    <span class="hljs-built_in">console</span>.log(responseObj.responseText);
                    <span class="hljs-keyword">if</span> (filename.endsWith(<span class="hljs-string">".xsl"</span>)) {
                        xsl = responseObj.responseText;
                        xsld.resolve();
                    } <span class="hljs-keyword">else</span> {
                        xml = responseObj.responseText;
                        xmld.resolve();
                    }
                }
                    
                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadXMLFileIE9</span>(<span class="hljs-params">filename</span>) </span>{
                    <span class="hljs-keyword">var</span> xdr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">window</span>.XDomainRequest();
                    xdr.open(<span class="hljs-string">"GET"</span>, filename);
                    xdr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ resolveDeferred(filename, xdr); };
                    xdr.ontimeout = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'xdr timeout'</span>); };
                    xdr.onprogress = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'xdr progress'</span>); };
                    xdr.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
                        <span class="hljs-built_in">console</span>.log(e);
                        error = <span class="hljs-literal">true</span>;
                        resolveDeferred(filename, xdr);
                    };
                    <span class="hljs-built_in">window</span>.setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ xdr.send(); }, <span class="hljs-number">0</span>);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>IE10+</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadXMLFileIE</span>(<span class="hljs-params">filename</span>) </span>{
                    <span class="hljs-keyword">var</span> xhttp = <span class="hljs-keyword">new</span> XMLHttpRequest();
                    xhttp.open(<span class="hljs-string">"GET"</span>, filename);
                    <span class="hljs-keyword">try</span> {
                        xhttp.responseType = <span class="hljs-string">"msxml-document"</span>;
                    } <span class="hljs-keyword">catch</span> (err) { } <span class="hljs-comment">// Helping IE11</span>
                    xhttp.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">if</span> (xhttp.readyState === <span class="hljs-number">4</span>) {
                            <span class="hljs-keyword">if</span> (xhttp.status !== <span class="hljs-number">200</span>) {
                                error = <span class="hljs-literal">true</span>;
                            }
                            resolveDeferred(filename, xhttp);
                        }
                    };
                    xhttp.send(<span class="hljs-string">""</span>);
                }

                <span class="hljs-keyword">if</span> (<span class="hljs-string">'withCredentials'</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">new</span> XMLHttpRequest() &amp;&amp; <span class="hljs-string">"ActiveXObject"</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">window</span>) { <span class="hljs-comment">// IE10 and above</span>
                    loadXMLFileIE(xmlurl);
                    loadXMLFileIE(xslurl);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.XDomainRequest) {</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>for IE9 use loadXMLFileIE9 for the metadata XML â uses XDomainRequest internally and allows cross domain requests
use regular XHR for the XSLT as that should be located on the same server as RAMP
XDR will break on same origin requests unless the same response headers are set allowing cross domain
FIXME: delete all this as soon as IE9 is off the support list as it is fragile and unpleasant to maintain</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    loadXMLFileIE9(xmlurl);
                    loadXMLFileIE(xslurl);
                } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// Good browsers (Chrome/FF)</span>
                    $.ajax({
                        type: <span class="hljs-string">"GET"</span>,
                        url: xmlurl,
                        dataType: <span class="hljs-string">"xml"</span>,
                        cache: <span class="hljs-literal">false</span>,
                        success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
                            xml = data;
                            xmld.resolve();
                        },
                        error: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                            error = <span class="hljs-literal">true</span>;
                            xmld.resolve();
                        }
                    });

                    $.ajax({
                        type: <span class="hljs-string">"GET"</span>,
                        url: xslurl,
                        dataType: <span class="hljs-string">"xml"</span>,
                        cache: <span class="hljs-literal">false</span>,
                        success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
                            xsl = data;
                            xsld.resolve();
                        },
                        error: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                            error = <span class="hljs-literal">true</span>;
                            xsld.resolve();
                        }
                    });
                }
            },

            <span class="hljs-comment">/**
            * Parses a file using the FileReader API.  Wraps readAsText and returns a promise.
            *
            * @method readFileAsText
            * @static
            * @param {File} file a dom file object to be read
            * @return {Object} a promise which sends a string containing the file output if successful
            */</span>
            readFileAsText: _wrapFileCallInPromise(<span class="hljs-string">'readAsText'</span>),

            <span class="hljs-comment">/**
            * Parses a file using the FileReader API.  Wraps readAsBinaryString and returns a promise.
            *
            * @method readFileAsBinary
            * @static
            * @param {File} file a dom file object to be read
            * @return {Object} a promise which sends a string containing the file output if successful
            */</span>
            readFileAsBinary: _wrapFileCallInPromise(<span class="hljs-string">'readAsBinary'</span>),

            <span class="hljs-comment">/**
            * Parses a file using the FileReader API.  Wraps readAsArrayBuffer and returns a promise.
            *
            * @method readFileAsArrayBuffer
            * @static
            * @param {File} file a dom file object to be read
            * @return {Object} a promise which sends an ArrayBuffer containing the file output if successful
            */</span>
            readFileAsArrayBuffer: _wrapFileCallInPromise(<span class="hljs-string">'readAsArrayBuffer'</span>),

            <span class="hljs-comment">/**
            * Augments lists of items to be sortable using keyboard.
            * 
            * @method keyboardSortable
            * @param {Array} ulNodes An array of &lt;ul&gt; tags containing a number of &lt;li&gt; tags to be made keyboard sortable.
            * @param {Object} [settings] Additional settings
            * @param {Object} [settings.linkLists] Indicates if the supplied lists (if more than one) should be linked - items could be moved from one to another; Update: this is wrong - items can't be moved from list to list right now, but the keyboard focus can be moved between lists - need to fix.
            * @param {Object} [settings.onStart] A callback function to be called when the user initiates sorting process
            * @param {Object} [settings.onUpdate] A callback function to be called when the user moves the item around
            * @param {Object} [settings.onStop] A callback function to be called when the user commits the item to its new place ending the sorting process
            * @static
            */</span>
            keyboardSortable: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ulNodes, settings</span>) </span>{
                settings = dojoLang.mixin({
                    linkLists: <span class="hljs-literal">false</span>,

                    onStart: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ },
                    onUpdate: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ },
                    onStop: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ }
                }, settings);

                ulNodes.each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index, _ulNode</span>) </span>{
                    <span class="hljs-keyword">var</span> ulNode = $(_ulNode),
                        liNodes = ulNode.find(<span class="hljs-string">"&gt; li"</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>sortHandleNodes = liNodes.find(â.sort-handleâ),</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        isReordering = <span class="hljs-literal">false</span>,
                        grabbed;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Reset focus, set aria attributes, and styling</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reorderReset</span>(<span class="hljs-params">handle, liNodes, liNode</span>) </span>{
                        handle.focus();
                        liNodes.attr(<span class="hljs-string">"aria-dropeffect"</span>, <span class="hljs-string">"move"</span>);
                        liNode.attr(<span class="hljs-string">"aria-grabbed"</span>, <span class="hljs-string">"true"</span>).removeAttr(<span class="hljs-string">"aria-dropeffect"</span>);
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>try to remove event handlers to prevent double initialization</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    ulNode
                        .off(<span class="hljs-string">"focusout"</span>, <span class="hljs-string">".sort-handle"</span>)
                        .off(<span class="hljs-string">"keyup"</span>, <span class="hljs-string">".sort-handle"</span>);

                    ulNode
                        .on(<span class="hljs-string">"focusout"</span>, <span class="hljs-string">".sort-handle"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
                            <span class="hljs-keyword">var</span> node = $(<span class="hljs-keyword">this</span>).closest(<span class="hljs-string">"li"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>if the list is not being reordered right now, release list item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">if</span> (node.hasClass(<span class="hljs-string">"list-item-grabbed"</span>) &amp;&amp; !isReordering) {
                                liNodes.removeAttr(<span class="hljs-string">"aria-dropeffect"</span>);
                                node
                                    .removeClass(<span class="hljs-string">"list-item-grabbed"</span>)
                                    .attr({ <span class="hljs-string">"aria-selected"</span>: <span class="hljs-literal">false</span>, <span class="hljs-string">"aria-grabbed"</span>: <span class="hljs-literal">false</span> });

                                grabbed = <span class="hljs-literal">false</span>;

                                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Keyboard Sortable: OnStop -&gt; "</span>, event);
                                settings.onStop.call(<span class="hljs-literal">null</span>, event, { item: <span class="hljs-literal">null</span> });
                            }
                        })
                        .on(<span class="hljs-string">"keyup"</span>, <span class="hljs-string">".sort-handle"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
                            <span class="hljs-keyword">var</span> liNode = $(<span class="hljs-keyword">this</span>).closest(<span class="hljs-string">"li"</span>),
                                liId = liNode[<span class="hljs-number">0</span>].id,
                                liIdArray = ulNode.sortable(<span class="hljs-string">"toArray"</span>),
                                liIndex = liIdArray.indexOf(liId);</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Toggle grabbed state and aria attributes (13 = enter, 32 = space bar)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">if</span> (event.which === <span class="hljs-number">13</span> || event.which === <span class="hljs-number">32</span>) {
                                <span class="hljs-keyword">if</span> (grabbed) {
                                    liNodes.removeAttr(<span class="hljs-string">"aria-dropeffect"</span>);
                                    liNode
                                        .attr(<span class="hljs-string">"aria-grabbed"</span>, <span class="hljs-string">"false"</span>)
                                        .removeClass(<span class="hljs-string">"list-item-grabbed"</span>);

                                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Keyboard Sortable: OnStop -&gt; "</span>, liNode);
                                    settings.onStop.call(<span class="hljs-literal">null</span>, event, { item: liNode });

                                    grabbed = <span class="hljs-literal">false</span>;
                                } <span class="hljs-keyword">else</span> {
                                    liNodes.attr(<span class="hljs-string">"aria-dropeffect"</span>, <span class="hljs-string">"move"</span>);
                                    liNode
                                        .attr(<span class="hljs-string">"aria-grabbed"</span>, <span class="hljs-string">"true"</span>)
                                        .removeAttr(<span class="hljs-string">"aria-dropeffect"</span>)
                                        .addClass(<span class="hljs-string">"list-item-grabbed"</span>);

                                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Keyboard Sortable: OnStart -&gt; "</span>, liNode);
                                    settings.onStart.call(<span class="hljs-literal">null</span>, event, { item: liNode });

                                    grabbed = <span class="hljs-literal">true</span>;
                                }</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Keyboard up (38) and down (40)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.which === <span class="hljs-number">38</span>) {
                                <span class="hljs-keyword">if</span> (grabbed) {</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Donât move up if first layer in list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    <span class="hljs-keyword">if</span> (liIndex &gt; <span class="hljs-number">0</span>) {
                                        isReordering = <span class="hljs-literal">true</span>;

                                        liNode.prev().before(liNode);

                                        reorderReset($(<span class="hljs-keyword">this</span>), liNodes, liNode);

                                        grabbed = <span class="hljs-literal">true</span>;
                                        liIndex -= <span class="hljs-number">1</span>;

                                        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Keyboard Sortable: OnUpdate -&gt; "</span>, liNode);
                                        settings.onUpdate.call(<span class="hljs-literal">null</span>, event, { item: liNode });

                                        isReordering = <span class="hljs-literal">false</span>;
                                    }
                                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>if lists are linked, jump to the last item of the previous list, if any</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    <span class="hljs-keyword">if</span> (settings.linkLists &amp;&amp;
                                        liIndex === <span class="hljs-number">0</span> &amp;&amp;
                                        index !== <span class="hljs-number">0</span>) {
                                        liNode = $(ulNodes[index - <span class="hljs-number">1</span>]).find(<span class="hljs-string">"&gt; li:last"</span>);
                                    } <span class="hljs-keyword">else</span> {
                                        liNode = liNode.prev();
                                    }

                                    liNode.find(<span class="hljs-string">":tabbable:first"</span>).focus();
                                }
                            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.which === <span class="hljs-number">40</span>) {
                                <span class="hljs-keyword">if</span> (grabbed) {</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Donât move down if last layer in list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    <span class="hljs-keyword">if</span> (liIndex &lt; liNodes.length - <span class="hljs-number">1</span>) {
                                        isReordering = <span class="hljs-literal">true</span>;

                                        liNode.next().after(liNode);

                                        reorderReset($(<span class="hljs-keyword">this</span>), liNodes, liNode);

                                        grabbed = <span class="hljs-literal">true</span>;
                                        liIndex += <span class="hljs-number">1</span>;

                                        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Keyboard Sortable: OnUpdate -&gt; "</span>, liNode);
                                        settings.onUpdate.call(<span class="hljs-literal">null</span>, event, { item: liNode });

                                        isReordering = <span class="hljs-literal">false</span>;
                                    }
                                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>if lists are linked, jump to the first item of the next list, if any</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    <span class="hljs-keyword">if</span> (settings.linkLists &amp;&amp;
                                        liIndex === liNodes.length - <span class="hljs-number">1</span> &amp;&amp;
                                        index &lt; ulNodes.length - <span class="hljs-number">1</span>) {
                                        liNode = $(ulNodes[index + <span class="hljs-number">1</span>]).find(<span class="hljs-string">"&gt; li:first"</span>);
                                    } <span class="hljs-keyword">else</span> {
                                        liNode = liNode.next();
                                    }

                                    liNode.find(<span class="hljs-string">":tabbable:first"</span>).focus();
                                }
                            }
                        });
                });
            },

            <span class="hljs-comment">/**
             * Takes an array of timelines and their generator functions, clear and recreates timelines optionally preserving the play position.
             * ####Example of tls parameter
             * 
             *      [
             *          {
             *              timeline: {timeline},
             *              generator: {function}
             *          }
             *      ]
             *      
             * 
             * @method resetTimelines
             * @static
             * @param {Array} tls An array of objects containing timeline objects and their respective generator functions
             * @param {Boolean} keepPosition Indicates if the timeline should be set in the play position it was in before the reset
             */</span>
            resetTimelines: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tls, keepPosition</span>) </span>{
                <span class="hljs-keyword">var</span> position;

                tls.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tl</span>) </span>{
                    position = tl.timeLine.time(); <span class="hljs-comment">// preserve timeline position</span>
                    tl.timeLine.seek(<span class="hljs-number">0</span>).clear();

                    tl.generator.call();

                    <span class="hljs-keyword">if</span> (keepPosition) {
                        tl.timeLine.seek(position);
                    }
                });
            },

            <span class="hljs-comment">/**
            * Checks if two spatial reference objects are equivalent.  Handles both wkid and wkt definitions
            *
            * @method isSpatialRefEqual
            * @static
            * @param {Esri/SpatialReference} sr1 First {{#crossLink "Esri/SpatialReference"}}{{/crossLink}} to compare
            * @param {Esri/SpatialReference} sr2 Second {{#crossLink "Esri/SpatialReference"}}{{/crossLink}} to compare
            * @return {Boolean} true if the two spatial references are equivalent.  False otherwise.
            */</span>
            isSpatialRefEqual: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">sr1, sr2</span>) </span>{
                <span class="hljs-keyword">if</span> ((sr1.wkid) &amp;&amp; (sr2.wkid)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>both SRs have wkids</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">return</span> sr1.wkid === sr2.wkid;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((sr1.wkt) &amp;&amp; (sr2.wkt)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>both SRs have wktâs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">return</span> sr1.wkt === sr2.wkt;
                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>not enough info provided or mismatch between wkid and wkt.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
            },

            <span class="hljs-comment">/**
            * Checks if the given dom node is present in the dom.
            *
            * @method containsInDom
            * @static
            * @param {Object} el DOM node to check
            * @return {Boolean} true if the given node is in the dom
            */</span>
            containsInDom: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">el</span>) </span>{
                <span class="hljs-keyword">return</span> $.contains(<span class="hljs-built_in">document</span>.documentElement, el);
            },

            styleBrowseFilesButton: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">nodes</span>) </span>{
                <span class="hljs-keyword">var</span> input,
                    button;

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">focusIn</span>(<span class="hljs-params">event</span>) </span>{
                    event.data.button.not(<span class="hljs-string">".disabled"</span>).addClass(<span class="hljs-string">"btn-focus btn-hover"</span>);
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">focusOut</span>(<span class="hljs-params">event</span>) </span>{
                    event.data.button.removeClass(<span class="hljs-string">"btn-focus btn-hover btn-active"</span>);
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mouseEnter</span>(<span class="hljs-params">event</span>) </span>{
                    event.data.button.not(<span class="hljs-string">".disabled"</span>).addClass(<span class="hljs-string">"btn-hover"</span>);
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mouseLeave</span>(<span class="hljs-params">event</span>) </span>{
                    event.data.button.removeClass(<span class="hljs-string">"btn-hover btn-active"</span>);
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mouseDown</span>(<span class="hljs-params">event</span>) </span>{
                    event.data.button.not(<span class="hljs-string">".disabled"</span>).addClass(<span class="hljs-string">"btn-focus btn-hover btn-active"</span>);
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mouseUp</span>(<span class="hljs-params">event</span>) </span>{
                    event.data.button.removeClass(<span class="hljs-string">"btn-active"</span>);
                }

                nodes.each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">i, node</span>) </span>{
                    node = $(node);
                    input = node.find(<span class="hljs-string">"input[type='file']"</span>);
                    button = node.find(<span class="hljs-string">".browse-button"</span>);

                    input
                        .on(<span class="hljs-string">"focusin"</span>, { button: button }, focusIn)
                        .on(<span class="hljs-string">"focusout"</span>, { button: button }, focusOut)

                        .on(<span class="hljs-string">"mouseenter"</span>, { button: button }, mouseEnter)
                        .on(<span class="hljs-string">"mouseleave"</span>, { button: button }, mouseLeave)

                        .on(<span class="hljs-string">"mousedown"</span>, { button: button }, mouseDown)
                        .on(<span class="hljs-string">"mouseup"</span>, { button: button }, mouseUp)
                    ;
                });
            },

            <span class="hljs-comment">/**
            * Detects either cell or line delimiter in a given csv data.
            *
            * @method detectDelimiter
            * @static
            * @param {String} data csv content
            * @param {String} [type] Type of the delimiter to detect. Possible values "cell" or "line". Defaults to "cell".
            * @return {String} Detected delimiter
            */</span>
            detectDelimiter: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data, type</span>) </span>{
                <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>,
                    detected,

                    escapeDelimiters = [<span class="hljs-string">'|'</span>, <span class="hljs-string">'^'</span>],
                    delimiters = {
                        cell: [<span class="hljs-string">','</span>, <span class="hljs-string">';'</span>, <span class="hljs-string">'\t'</span>, <span class="hljs-string">'|'</span>, <span class="hljs-string">'^'</span>],
                        line: [<span class="hljs-string">'\r\n'</span>, <span class="hljs-string">'\r'</span>, <span class="hljs-string">'\n'</span>]
                    };

                type = type !== <span class="hljs-string">"cell"</span> &amp;&amp; type !== <span class="hljs-string">"line"</span> ? <span class="hljs-string">"cell"</span> : type;

                delimiters[type].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">delimiter</span>) </span>{
                    <span class="hljs-keyword">var</span> needle = delimiter,
                        matches;

                    <span class="hljs-keyword">if</span> (escapeDelimiters.indexOf(delimiter) !== -<span class="hljs-number">1</span>) {
                        needle = <span class="hljs-string">'\\'</span> + needle;
                    }

                    matches = data.match(<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(needle, <span class="hljs-string">'g'</span>));
                    <span class="hljs-keyword">if</span> (matches &amp;&amp; matches.length &gt; count) {
                        count = matches.length;
                        detected = delimiter;
                    }
                });

                <span class="hljs-built_in">console</span>.log(type + <span class="hljs-string">" delimiter detected: '"</span> + (detected || delimiters[type][<span class="hljs-number">0</span>]) + <span class="hljs-string">"'"</span>);

                <span class="hljs-keyword">return</span> (detected || delimiters[type][<span class="hljs-number">0</span>]);
            },

            <span class="hljs-comment">/**
            * Converts HEX colour to RGB.
            * http://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb/5624139#5624139
            *
            * @method hexToRgb
            * @static
            * @param {String} hex hex colour code
            * @return {Object} object containing r, g, and b components of the supplied colour
            */</span>
            hexToRgb: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">hex</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Expand shorthand form (e.g. â03Fâ) to full form (e.g. â0033FFâ)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> shorthandRegex = <span class="hljs-regexp">/^#?([a-f\d])([a-f\d])([a-f\d])$/i</span>;
                hex = hex.replace(shorthandRegex, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">m, r, g, b</span>) </span>{
                    <span class="hljs-keyword">return</span> r + r + g + g + b + b;
                });

                <span class="hljs-keyword">var</span> result = <span class="hljs-regexp">/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i</span>.exec(hex);
                <span class="hljs-keyword">return</span> result ? {
                    r: <span class="hljs-built_in">parseInt</span>(result[<span class="hljs-number">1</span>], <span class="hljs-number">16</span>),
                    g: <span class="hljs-built_in">parseInt</span>(result[<span class="hljs-number">2</span>], <span class="hljs-number">16</span>),
                    b: <span class="hljs-built_in">parseInt</span>(result[<span class="hljs-number">3</span>], <span class="hljs-number">16</span>)
                } : <span class="hljs-literal">null</span>;
            },

            <span class="hljs-comment">/**
            * Converts RGB colour to HEX.
            * http://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb/5624139#5624139
            *
            * @method rgbToHex
            * @static 
            * @param {Number} r r component
            * @param {Number} g g component
            * @param {Number} b b component
            * @return {Object} hex colour code 
            */</span>
            rgbToHex: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">r, g, b</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-string">"#"</span> + ((<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">24</span>) + (r &lt;&lt; <span class="hljs-number">16</span>) + (g &lt;&lt; <span class="hljs-number">8</span>) + b).toString(<span class="hljs-number">16</span>).slice(<span class="hljs-number">1</span>);
            },

            resetFormElement: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
                e.wrap(<span class="hljs-string">'&lt;form&gt;'</span>).closest(<span class="hljs-string">'form'</span>).get(<span class="hljs-number">0</span>).reset();
                e.unwrap();
            },

            setSelectOptions: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">select, options, append</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>var optionsNode;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                <span class="hljs-keyword">if</span> (!append) {
                    select.empty();</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>select.append(optionsNode);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                }

                options.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">option</span>) </span>{
                    select.append($(<span class="hljs-string">"&lt;option/&gt;"</span>, {
                        value: option.value,
                        text: option.text
                    }));
                });
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_.22Unicode_Problem.22">https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_.22Unicode_Problem.22</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-comment">/**
             * Base64 encoding for unicode text.
             * 
             * @method b64EncodeUnicode
             * @param {String} str a string to encode
             * @return {String} encoded string
             */</span>
            b64EncodeUnicode: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">str</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Btoa(<span class="hljs-built_in">encodeURIComponent</span>(str).replace(<span class="hljs-regexp">/%([0-9A-F]{2})/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">match, p1</span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-built_in">String</span>.fromCharCode(<span class="hljs-string">'0x'</span> + p1);
                })).a;
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Converts image to canvas; returns new canvas element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            convertImageToCanvas: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">image</span>) </span>{
                <span class="hljs-keyword">var</span> canvas = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"canvas"</span>);
                canvas.width = image.width;
                canvas.height = image.height;
                canvas.getContext(<span class="hljs-string">"2d"</span>).drawImage(image, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

                <span class="hljs-keyword">return</span> canvas;
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Converts canvas to an image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            convertCanvasToDataURL: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">canvas, type</span>) </span>{
                <span class="hljs-keyword">var</span> data;
                type = type || <span class="hljs-string">"image/png"</span>;

                data = canvas.toDataURL(type);
                <span class="hljs-keyword">return</span> data;
            }
        };
    });</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
