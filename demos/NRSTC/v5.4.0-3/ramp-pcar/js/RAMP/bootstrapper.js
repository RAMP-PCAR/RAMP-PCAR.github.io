/*! ramp-pcar 14-05-2015 14:42:13 : v. 5.4.0-3 
 * 
 * RAMP GIS viewer - Elk; Sample of an implementation of RAMP 
 **/
require(["dojo/parser","dojo/topic","dojo/request/script","dojo/request/xhr","esri/config","esri/urlUtils","ramp/map","ramp/basemapSelector","ramp/maptips","ramp/datagrid","ramp/navigation","ramp/filterManager","ramp/imageExport","ramp/bookmarkLink","utils/url","ramp/featureHighlighter","ramp/globalStorage","ramp/gui","ramp/eventManager","ramp/advancedToolbar","ramp/geoSearch","ramp/theme","ramp/layerLoader","ramp/dataLoaderGui","utils/util","utils/prototype!","utils/functionMangler!","dojo/domReady!"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){"use strict";function z(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("script");c.type="text/javascript",c.src=dojoConfig.fullPluginPath+a,b.appendChild(c)}function A(){function a(){l.init(),RAMP.config.advancedToolbar.enabled&&t.init(),j.init(),v.tooltipster(),RAMP.startupLayers.forEach(function(a){w.loadLayer(a)})}b.subscribe(s.Map.INITIAL_BASEMAP_LOADED,function(){y.subscribeAll([s.BasemapSelector.UI_COMPLETE,s.FilterManager.UI_COMPLETE],function(){n.subscribeAndUpdate(),m.init(),x.init()});var b=g.getMap().__LOD.level?g.getMap().__LOD.level:0;k.init(b),p.init(),i.init(),h.init(),RAMP.flags.brokenWebBrowser||RAMP.flags.ie10client?window.setTimeout(a,2e3):a()}),g.init(),k.construct(),v.tooltipster()}function B(a){var c,d=$("li.map-toolbar-item #advanced-toggle").parent(),h=document.getElementsByTagName("html")[0].className.indexOf("dj_ie9")>-1,i=document.getElementsByTagName("html")[0].className.indexOf("dj_ie10")>-1;q.init(a),q.defineProjections(window.proj4),u.init(),e.defaults.io.proxyUrl=RAMP.config.proxyUrl,e.defaults.io.corsDetection=!h,h&&void 0!==RAMP.config.exportProxyUrl&&f.addProxyRule({proxyUrl:RAMP.config.exportProxyUrl,urlPrefix:RAMP.config.exportMapUrl}),RAMP.flags.brokenWebBrowser=h,RAMP.flags.ie10client=i,RAMP.config.advancedToolbar.enabled?d.removeClass("wb-invisible"):d.remove(),c=RAMP.config.plugins,c&&c.map(function(a){z(a)}),g.applyExtentDefaulting(),n.updateConfig(window.location.pathname.split("/").last()),b.subscribe(s.Map.EXTENTS_REPROJECTED,function(){b.subscribe(s.GUI.UPDATE_COMPLETE,function(){n.createUI(),w.init(),A()}),r.load(null,null,function(){})}),g.projectConfigExtents()}y.checkConsole(),a.parse();var C,D,E=$("html").attr("lang");"en"!==E&&"fr"!==E&&(E="en"),RAMP.locale=E,i18n.init({lng:E+"-CA",load:"current",fallbackLng:!1}),C="fr"===E?"config.fr.json":"config.en.json",D=d(C,{handleAs:"json"}),D.then(function(a){if(RAMP.configServiceURL){var b=new o(require.toUrl(document.location)),d=b.queryObject.keys;if(d&&""!==d){var e=RAMP.configServiceURL+"docs/"+$("html").attr("lang")+"/"+d,f=c.get(e,{jsonp:"callback",timeout:2e3});f.then(function(b){b.forEach(function(b){y.mergeRecursive(a,b)}),B(a)},function(a){})}else B(a)}else B(a)},function(a){})});