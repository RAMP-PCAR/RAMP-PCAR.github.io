/*! ramp-gis-viewer 03-07-2014 : v. 1.0.42-7 

 * RAMP GIS viewer - ArcticFox; Sample of an implementation of RAMP 
 **/
define(["ramp/graphicExtension","ramp/eventManager","ramp/globalStorage","dojo/topic","dojo/dom-construct","utils/util"],function(a,b,c,d,e,f){"use strict";function g(){d.publish(b.FeatureHighlighter.ZOOMLIGHT_HIDE),d.publish("datagrid/zoomlightrow-hide")}var h;return{onDetailSelect:function(e,g,h){var i=e.data("guid")||e.data("guid",f.guid()).data("guid"),j=a.getTextContent(g),k=a.getGraphicTitle(g),l=e.parents(".record-row").parent();"summary"===h?d.publish(b.GUI.SUBPANEL_OPEN,{panelName:c.config.stringResources.txtGrid_details,title:k,content:j,target:l.find(".record-controls"),origin:"datagrid",consumeOrigin:"rampPopup",guid:i,doOnOpen:function(){f.subscribeOnce(b.Maptips.EXTENT_CHANGE,function(a){var c=a.scroll;d.publish(b.Datagrid.HIGHLIGHTROW_SHOW,{graphic:g,scroll:c})}),d.publish(b.FeatureHighlighter.HIGHLIGHT_SHOW,{graphic:g})},doOnHide:function(){d.publish(b.Datagrid.HIGHLIGHTROW_HIDE)},doOnDestroy:function(){g=null,d.publish(b.FeatureHighlighter.HIGHLIGHT_HIDE)}}):(l=e,d.publish(b.GUI.SUBPANEL_OPEN,{panelName:c.config.stringResources.txtGrid_details,title:k,content:j,target:l,origin:"ex-datagrid",templateKey:"full_sub_panel_container",guid:i,doAfterUpdate:function(){d.publish(b.Datagrid.HIGHLIGHTROW_SHOW,{graphic:g,scroll:!0})},doOnHide:function(){d.publish(b.Datagrid.HIGHLIGHTROW_HIDE)},doOnDestroy:function(){g=null,d.publish(b.FeatureHighlighter.HIGHLIGHT_HIDE)}}))},onDetailDeselect:function(a){"summary"===a?d.publish(b.GUI.SUBPANEL_CLOSE,{origin:"rampPopup,datagrid"}):d.publish(b.GUI.SUBPANEL_CLOSE,{origin:"ex-datagrid"})},onZoomTo:function(a,c){function e(){d.publish(b.FeatureHighlighter.ZOOMLIGHT_SHOW,{graphic:c}),f.subscribeOnceAny(["map/pan-start","map/zoom-start"],g)}switch(h=a,c.geometry.type){case"point":d.publish(b.Map.CENTER_AND_ZOOM,{graphic:c,level:9,callback:e});break;case"polygon":d.publish(b.Map.SET_EXTENT,{extent:c._extent.expand(1.5),callback:e});break;default:d.publish(b.Map.SET_EXTENT,{extent:c._extent.expand(1.5),callback:e})}d.publish(b.Datagrid.ZOOMLIGHTROW_SHOW,{graphic:c})},onZoomBack:function(){d.publish(b.Map.SET_EXTENT,{extent:h}),d.publish(b.FeatureHighlighter.ZOOMLIGHT_HIDE),d.publish(b.Datagrid.ZOOMLIGHTROW_HIDE)},onZoomCancel:function(){g()}}});